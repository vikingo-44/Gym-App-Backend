{"version":3,"file":"static/js/main.af436ef4.js","mappings":"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","sources":["ThemeContext.js","screens/ProfessorScreen.js","screens/CustomLoginScreen.js","screens/RoutineCreationScreen.js","screens/ChangePasswordScreen.js","screens/StudentDetailsScreen.js","screens/AddStudentScreen.js","screens/ExercisesAdd.js","screens/RoutineEditScreen.js","screens/StudentRoutineScreen.js","screens/ForgotPasswordScreen.js","App.js","index.js","webpack/bootstrap","webpack/runtime/chunk loaded","webpack/runtime/compat get default export","webpack/runtime/define property getters","webpack/runtime/global","webpack/runtime/hasOwnProperty shorthand","webpack/runtime/make namespace object","webpack/runtime/publicPath","webpack/runtime/jsonp chunk loading","webpack/startup"],"sourcesContent":["import React, { createContext, useContext, useState, useMemo } from 'react';\r\nimport { useColorScheme } from 'react-native';\r\n\r\n// --- Definicin de Temas ---\r\nconst LightTheme = {\r\n    isDark: false,\r\n    colors: {\r\n        background: '#F0F4F8',     // Fondo principal\r\n        card: '#FFFFFF',           // Fondo de tarjetas/contenedores\r\n        textPrimary: '#1F2937',    // Texto oscuro principal\r\n        textSecondary: '#6B7280',  // Texto secundario (Gris medio)\r\n        inputBackground: '#FFFFFF',// Fondo de inputs\r\n        inputBorder: '#D1D5DB',    // Borde de input (Gris claro)\r\n        primary: '#007AFF',        // Azul iOS (Botones, encabezados, acento principal)\r\n        primaryDark: '#005ACF',    // Azul ms oscuro\r\n        success: '#10B981',        // Verde (Guardar, Activo)\r\n        danger: '#FF3B30',         // Rojo (Eliminar, Error)\r\n        warning: '#FF9500',        // Naranja/Amarillo (Advertencia, Inactivo)\r\n        divider: '#E5E7EB',        // Lneas divisorias\r\n        highlight: '#D1E7FF',      // Fondo de seleccin/highlight\r\n    },\r\n};\r\n\r\nconst DarkTheme = {\r\n    isDark: true,\r\n    colors: {\r\n        background: '#121212',     // Fondo principal oscuro\r\n        card: '#1F2937',           // Fondo de tarjetas/contenedores (Gris oscuro)\r\n        textPrimary: '#F9FAFB',    // Texto claro principal\r\n        textSecondary: '#D1D5DB',  // Texto secundario (Gris claro)\r\n        inputBackground: '#374151',// Fondo de inputs oscuro\r\n        inputBorder: '#4B5563',    // Borde de input\r\n        primary: '#60A5FA',        // Azul claro\r\n        primaryDark: '#3B82F6',    // Azul medio\r\n        success: '#34D399',        // Verde claro\r\n        danger: '#F87171',         // Rojo claro\r\n        warning: '#FDE047',        // Amarillo claro\r\n        divider: '#374151',        // Lneas divisorias oscuras\r\n        highlight: '#3B4D63',      // Fondo de seleccin/highlight\r\n    },\r\n};\r\n\r\n// 1. Crear el Contexto, incluyendo toggleTheme\r\nconst ThemeContext = createContext({\r\n    ...DarkTheme, //  AJUSTE: El contexto por defecto ahora es DarkTheme\r\n    toggleTheme: () => {}, // Funcin placeholder\r\n});\r\n\r\n// 2. Hook personalizado para usar el tema\r\nexport const useTheme = () => useContext(ThemeContext);\r\n\r\n// 3. Proveedor del Tema\r\nexport const ThemeProvider = ({ children }) => {\r\n    // Detecta el esquema de color del sistema operativo\r\n    const systemScheme = useColorScheme();\r\n    \r\n    // Estado para permitir la anulacin manual: 'light', 'dark', o 'system'\r\n    //  MODIFICACIN CLAVE: Inicializa a 'dark' para forzar el modo oscuro\r\n    const [manualScheme, setManualScheme] = useState('dark'); \r\n\r\n    // Determina el esquema actual: manual o del sistema\r\n    // El esquema del sistema ya no importa para el inicio, pero se mantiene la lgica de alternar por si se necesita\r\n    const currentScheme = manualScheme === 'system' ? systemScheme : manualScheme;\r\n    \r\n    // El tema activo se basa en el esquema actual\r\n    const activeTheme = currentScheme === 'dark' ? DarkTheme : LightTheme;\r\n\r\n    // Funcin para alternar el esquema (Si ya no necesitas esta funcin, podras eliminarla y dejar manualScheme siempre en 'dark')\r\n    const toggleTheme = () => {\r\n        setManualScheme(prevScheme => {\r\n            if (prevScheme === 'system') {\r\n                // Si estaba en sistema, lo forzamos al opuesto del sistema\r\n                return systemScheme === 'dark' ? 'light' : 'dark';\r\n            } else {\r\n                // Si estaba forzado, lo alternamos\r\n                return prevScheme === 'dark' ? 'light' : 'dark';\r\n            }\r\n        });\r\n    };\r\n    \r\n    // El valor que se pasa al contexto\r\n    const contextValue = useMemo(() => ({\r\n        ...activeTheme,\r\n        toggleTheme,\r\n        manualScheme, // Para saber si estamos forzando el tema\r\n    }), [activeTheme, toggleTheme, manualScheme]);\r\n\r\n\r\n    return (\r\n        <ThemeContext.Provider value={contextValue}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n};","import React, { useState, useEffect, useContext, useMemo, useRef } from 'react'; \nimport { \n    StyleSheet, Text, View, ScrollView, SafeAreaView, Button, \n    ActivityIndicator, FlatList, TouchableOpacity, Alert, Modal,\n    TextInput, Animated, Platform, Image // Aadimos Image para el logo\n} from 'react-native';\nimport axios from 'axios';\nimport { AuthContext } from '../App'; \nimport { useTheme } from '../ThemeContext'; \n// Importamos TODOS los iconos necesarios (Lucide)\nimport { Trash2, Edit, RefreshCcw, Menu, User, Key, LogOut, Minus, Plus, ChevronDown, ChevronUp, UserPlus, CheckCircle, Weight, Calendar, XCircle } from 'lucide-react-native'; \n\n// ----------------------------------------------------------------------\n// URL de la API (DEBE COINCIDIR con la de App.js)\n// ----------------------------------------------------------------------\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \n// ----------------------------------------------------------------------\n\n// ----------------------------------------------------------------------\n// URIs de Imagenes (Si se necesitan en el futuro)\n// ----------------------------------------------------------------------\nconst LOGO_SOURCE = require('../assets/logoND.jpg'); \n// ----------------------------------------------------------------------\n\n// ----------------------------------------------------------------------\n// FUNCIONES DE FECHA (Ajustadas para DD/MM/YYYY)\n// ----------------------------------------------------------------------\n\n/**\n * Convierte DD/MM/YYYY o YYYY-MM-DD a un objeto Date (CRTICO para validacin y formato)\n * NOTA: Esta funcin devuelve una fecha en la hora local del dispositivo.\n */\nconst parseDateToJS = (dateString) => {\n    if (!dateString) return null;\n    const parts = dateString.split(/[-\\/]/); // Soporta tanto - como /\n    if (parts.length === 3) {\n        let year, month, day;\n        if (parts[0].length === 4) { // Asume YYYY-MM-DD (API format)\n            [year, month, day] = parts;\n        } else { // Asume DD/MM/YYYY (Display format)\n            [day, month, year] = parts;\n        }\n        \n        // Se usa el constructor Date(year, monthIndex, day) que usa el Huso Horario Local \n        const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n        return date;\n    }\n    return null;\n};\n\n/**\n * Formatea un objeto Date (o una cadena ISO) a DD/MM/YYYY para la UI.\n */\nconst formatDisplayDate = (dateInput) => {\n    if (!dateInput) return 'N/A';\n    \n    let date = dateInput instanceof Date ? dateInput : parseDateToJS(dateInput);\n\n    if (date && !isNaN(date.getTime())) {\n        // Usamos Intl.DateTimeFormat para el formato local DD/MM/YYYY\n        return new Intl.DateTimeFormat('es-AR', {\n            year: 'numeric',\n            month: '2-digit',\n            day: '2-digit',\n        }).format(date);\n    }\n    return 'Invlida';\n};\n\n/**\n * Convierte DD/MM/YYYY o DD-MM-YYYY a YYYY-MM-DD (Formato requerido por la API)\n */\nconst formatAPIDate = (dateInput) => {\n    if (!dateInput) return '';\n    \n    // Si es un objeto Date, lo formateamos (nuevo)\n    if (dateInput instanceof Date) {\n        const year = dateInput.getFullYear();\n        const month = String(dateInput.getMonth() + 1).padStart(2, '0');\n        const day = String(dateInput.getDate()).padStart(2, '0');\n        return `${year}-${month}-${day}`;\n    }\n\n    // Si es una cadena, intentamos parsear y luego formatear\n    const date = parseDateToJS(dateInput); \n    if (date && !isNaN(date.getTime())) {\n        const year = date.getFullYear();\n        const month = String(date.getMonth() + 1).padStart(2, '0');\n        const day = String(date.getDate()).padStart(2, '0');\n        return `${year}-${month}-${day}`;\n    }\n    return '';\n};\n// ----------------------------------------------------------------------\n\n\n// ----------------------------------------------------------------------\n// GENERADOR DE ESTILOS PARA ASIGNACION (AssignmentView) - ESTILO PEAKFIT\n// ----------------------------------------------------------------------\nconst getAssignmentStyles = (colors) => StyleSheet.create({\n    scrollContainer: { flex: 1, backgroundColor: 'black', },\n    container: { flex: 1, padding: 20, backgroundColor: 'black', alignItems: 'center', },\n    title: { fontSize: 22, fontWeight: 'bold', marginBottom: 20, color: '#3ABFBC', width: '100%', textAlign: 'center' },\n    \n    // Subttulo de seccin (Rutinas Asignadas Actualmente)\n    subtitle: { \n        fontSize: 18, \n        fontWeight: '600', \n        color: 'white', // Blanco\n        marginTop: 20, \n        marginBottom: 15, \n        width: '100%', \n        borderBottomWidth: 1, \n        borderBottomColor: colors.divider, \n        paddingBottom: 5, \n    },\n    \n    routineListContainer: { width: '100%', marginBottom: 30, },\n    label: { fontSize: 16, fontWeight: '600', color: 'white', marginBottom: 10, },\n    warning: { fontSize: 16, color: colors.warning, textAlign: 'center', padding: 10, },\n    backButtonTop: { width: '100%', marginBottom: 20, alignItems: 'center', },\n    currentAssignmentList: { width: '100%', marginBottom: 20, },\n    \n    // Encabezado del Grupo (Nombre y Detalles)\n    groupHeaderContainer: { \n        width: '100%', paddingBottom: 10, borderBottomWidth: 2, \n        borderBottomColor: '#3ABFBC', // Lnea verde\n        marginBottom: 15, \n    },\n    groupHeader: { fontSize: 18, fontWeight: 'bold', color: 'white', marginBottom: 5, },\n    groupDetails: { fontSize: 14, fontWeight: 'normal', color: '#A9A9A9', marginBottom: 2, },\n    groupActions: { flexDirection: 'row', justifyContent: 'flex-start', gap: 10, marginTop: 10, flexWrap: 'wrap', },\n    groupActionButtonText: { color: 'black', fontWeight: 'bold', fontSize: 12, marginLeft: 5, }, // Texto negro para contraste en botones verde/rojo\n    \n    // Botn de Toggle Activo/Inactivo del Grupo\n    toggleGroupButton: { \n        flexDirection: 'row', alignItems: 'center', paddingVertical: 8, paddingHorizontal: 10, \n        borderRadius: 8, \n    },\n    \n    // Tarjeta Colapsable de Asignacin\n    assignmentCard: {\n        flexDirection: 'row', \n        backgroundColor: '#1C1C1E', // Fondo oscuro\n        borderRadius: 10, \n        marginBottom: 10,\n        shadowColor: '#000', \n        shadowOffset: { width: 0, height: 1 },\n        shadowOpacity: 0.8, \n        shadowRadius: 5, \n        elevation: 4, \n        overflow: 'hidden', \n    },\n    statusBar: { width: 30, justifyContent: 'center', alignItems: 'center', paddingVertical: 10, },\n    statusText: { fontSize: 12, fontWeight: 'bold', color: 'black', transform: [{ rotate: '-90deg' }], width: 100, textAlign: 'center', }, // Texto negro\n    assignmentContent: { flex: 1, },\n    assignmentHeader: { padding: 15, flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', flex: 1, },\n    assignmentDetails: { flex: 1, paddingRight: 10, },\n    assignmentActions: { flexDirection: 'row', alignItems: 'center', justifyContent: 'flex-end', },\n    \n    // Botones de accin individual\n    deleteButton: { padding: 8, backgroundColor: colors.danger, borderRadius: 8, flexDirection: 'row', alignItems: 'center', },\n    editButton: { padding: 8, backgroundColor: '#3ABFBC', borderRadius: 8, flexDirection: 'row', alignItems: 'center', }, // Verde\n    routineName: { fontSize: 18, fontWeight: '600', color: 'white', },\n    \n    // Contenido colapsable (Lista de Ejercicios)\n    exerciseListContainer: {\n        marginTop: 15, paddingTop: 10, paddingHorizontal: 15, paddingBottom: 5, borderTopWidth: 1,\n        borderTopColor: colors.divider, \n        backgroundColor: 'black', // Fondo negro dentro de la tarjeta oscura\n    },\n    exerciseItem: {\n        paddingLeft: 10, paddingVertical: 8, \n        borderLeftWidth: 2, \n        borderLeftColor: '#3ABFBC', // Lnea de acento verde\n        marginBottom: 8, \n        backgroundColor: '#1C1C1E', // Fondo oscuro de la tarjeta\n        borderRadius: 5,\n    },\n    exerciseName: { fontSize: 15, fontWeight: '700', color: 'white', marginBottom: 5, },\n    detailsRow: { flexDirection: 'row', justifyContent: 'flex-start', gap: 15, marginTop: 5, },\n    detailItem: {\n        flexDirection: 'row', alignItems: 'center', \n        backgroundColor: 'black', // Fondo del detalle ms oscuro an\n        borderRadius: 6, paddingHorizontal: 8, paddingVertical: 4,\n    },\n    detailLabel: { fontSize: 12, color: '#A9A9A9', marginRight: 4, fontWeight: '500', }, // Gris claro\n    detailValue: { fontSize: 14, fontWeight: 'bold', color: '#3ABFBC', }, // Verde para el valor\n    \n    // Botones (Estilo Unificado de la Pantalla Principal)\n    customButton: {\n        paddingVertical: 12, paddingHorizontal: 20, borderRadius: 10, alignItems: 'center',\n        justifyContent: 'center', minWidth: 100, shadowColor: \"#000\", shadowOffset: { width: 0, height: 2 },\n        shadowOpacity: 0.5, shadowRadius: 3, elevation: 4,\n    },\n    buttonPrimary: { backgroundColor: '#3ABFBC', },\n    buttonSecondary: { backgroundColor: '#1C1C1E', borderColor: colors.divider, borderWidth: 1, },\n    buttonDanger: { backgroundColor: colors.danger, },\n    buttonText: { fontSize: 16, fontWeight: 'bold', color: 'black', },\n    buttonTextSecondary: { fontSize: 16, fontWeight: 'bold', color: 'white', },\n    \n    // Separador de Grupo\n    groupSeparator: { \n        marginBottom: 30, \n        paddingBottom: 20, \n        borderBottomWidth: 2, \n        borderBottomColor: colors.divider, \n        borderStyle: 'dotted' \n    }, \n});\n\n// ----------------------------------------------------------------------\n// COMPONENTE: Tarjeta Colapsable de Asignacion\n// ----------------------------------------------------------------------\nconst CollapsibleAssignmentCard = ({ \n    assignment, assignmentStyles, themeColors, \n    handleEditAssignment, \n}) => {\n    \n    const [isExpanded, setIsExpanded] = useState(false);\n    const linkCount = assignment.routine.exercise_links ? assignment.routine.exercise_links.length : 0; \n\n    // Define el color y el texto del estado\n    const isPastDue = assignment.routine.routine_group?.fecha_vencimiento && \n                        parseDateToJS(assignment.routine.routine_group.fecha_vencimiento) < new Date();\n\n    // Lgica de color: Verde (Activa) / Amarillo (Inactiva) / Rojo (Vencida)\n    let statusColor;\n    let statusText;\n\n    if (isPastDue) {\n        statusColor = themeColors.danger; // Rojo para VENCIDA\n        statusText = 'VENCIDA';\n    } else if (assignment.is_active) {\n        statusColor = themeColors.success; // Verde para ACTIVA\n        statusText = 'ACTIVA';\n    } else {\n        statusColor = themeColors.warning; // Amarillo/Warning para INACTIVA\n        statusText = 'INACTIVA';\n    }\n    \n    // Renderiza la lista de ejercicios (solo cuando se expande)\n    const renderExercises = () => (\n        <View style={assignmentStyles.exerciseListContainer}>\n            <Text style={{ fontSize: 13, fontWeight: 'bold', color: themeColors.textPrimary, marginBottom: 5 }}>Detalle de Ejercicios:</Text>\n            {assignment.routine.exercise_links\n                .sort((a, b) => a.order - b.order)\n                .map((link, exIndex) => (\n                    link.exercise ? (\n                        <View key={link.id || exIndex} style={assignmentStyles.exerciseItem}>\n                            <Text style={assignmentStyles.exerciseName}>\n                                {link.order}. {link.exercise.nombre}\n                            </Text>\n                            \n                            <View style={assignmentStyles.detailsRow}>\n                                <View style={assignmentStyles.detailItem}>\n                                    <Text style={assignmentStyles.detailLabel}>Sets:</Text>\n                                    <Text style={assignmentStyles.detailValue}>{link.sets}</Text>\n                                </View>\n                                <View style={assignmentStyles.detailItem}>\n                                    <Text style={assignmentStyles.detailLabel}>Reps:</Text>\n                                    <Text style={assignmentStyles.detailValue}>{link.repetitions}</Text>\n                                </View>\n                                <View style={assignmentStyles.detailItem}>\n                                    <Text style={assignmentStyles.detailLabel}>Peso:</Text>\n                                    <Text style={assignmentStyles.detailValue}>{link.peso || '-'}</Text>\n                                </View>\n                            </View>\n                        </View>\n                    ) : (\n                        <Text key={link.id || exIndex} style={{color: themeColors.danger}}>\n                            Error: Ejercicio no cargado.\n                        </Text>\n                    )\n                ))}\n        </View>\n    );\n\n    return (\n        <View style={assignmentStyles.assignmentCard}>\n            \n            {/* 1. BARRA LATERAL DE ESTADO */}\n            <View style={[assignmentStyles.statusBar, { backgroundColor: statusColor }]}>\n                <Text style={[assignmentStyles.statusText, { color: statusText === 'VENCIDA' ? themeColors.card : 'black' }]}>\n                    {statusText}\n                </Text>\n            </View>\n\n            {/* CONTENEDOR PRINCIPAL DEL CONTENIDO */}\n            <View style={assignmentStyles.assignmentContent}>\n                \n                {/* 2. CABECERA: Rutina Name Area */}\n                <View style={assignmentStyles.assignmentHeader}>\n                    <View style={assignmentStyles.assignmentDetails}>\n                        <Text style={assignmentStyles.routineName}>{assignment.routine.nombre}</Text>\n                        <Text style={{ marginTop: 5, color: themeColors.textSecondary, fontSize: 13, fontWeight: '500'}}>\n                            {linkCount} EJERCICIOS\n                        </Text>\n                    </View>\n\n                    {/* 3. ACCIONES DE LA RUTINA INDIVIDUAL Y BOTN DE EXPANSIN */}\n                    <View style={assignmentStyles.assignmentActions}>\n                        \n                        {/* Botn para Editar Rutina Individual */}\n                        <TouchableOpacity \n                            style={[assignmentStyles.editButton, { marginRight: 8 }]} \n                            onPress={() => handleEditAssignment(assignment.routine_id)} \n                        >\n                            <Edit size={20} color={'black'} />\n                        </TouchableOpacity>\n                        \n                        {/* Botn Expansin/Colapso */}\n                        <TouchableOpacity\n                            style={[\n                                assignmentStyles.editButton, \n                                { backgroundColor: isExpanded ? themeColors.textSecondary : '#3ABFBC' }\n                            ]}\n                            onPress={() => setIsExpanded(!isExpanded)}\n                        >\n                            {isExpanded ? \n                                <ChevronUp size={20} color={themeColors.card} /> : \n                                <ChevronDown size={20} color={themeColors.card} />\n                            }\n                        </TouchableOpacity>\n                    </View>\n                </View>\n\n                {/* 4. CONTENIDO COLAPSABLE (Ejercicios) */}\n                {isExpanded && renderExercises()}\n            </View>\n        </View>\n    );\n}\n\n\n// --- COMPONENTE: MODAL DE EDICIN DE GRUPO (NUEVO) ---\nfunction EditGroupWizard({ groupData, onComplete, onCancel, fetchCurrentAssignments }) {\n    const { colors: themeColors } = useTheme();\n    const styles = getMainScreenStyles(themeColors); \n\n    const wizardLabelStyle = {\n        ...styles.label, \n        color: 'white', // Usamos color blanco\n        fontSize: 18, \n        fontWeight: 'bold', \n        marginBottom: 10,\n    };\n\n    const { getToken } = useContext(AuthContext);\n\n    const firstRoutine = groupData.assignments[0];\n    \n    // Inicializar la fecha de vencimiento en formato DD/MM/YYYY para la edicin\n    const initialExpiryDate = groupData.expiryDate ? formatDisplayDate(groupData.expiryDate) : '';\n\n    const [groupName, setGroupName] = useState(groupData.groupName || '');\n    const [routinesCount, setRoutinesCount] = useState(groupData.assignments.length);\n    const [expirationDateInput, setExpirationDateInput] = useState(initialExpiryDate); // Formato DD/MM/YYYY (String)\n    const [isLoading, setIsLoading] = useState(false);\n    \n    const placeholderColor = themeColors.isDark ? themeColors.textSecondary : '#6B7280';\n\n\n    const handleUpdateGroup = async () => {\n        if (!groupName.trim() || !expirationDateInput.trim()) {\n             Alert.alert(\"Error\", \"El nombre y la fecha de vencimiento son obligatorios.\");\n             return;\n        }\n\n        // 1. VALIDACION y CONVERSION DE FECHA\n        // Validar el formato DD/MM/YYYY para el usuario (Permitimos - o /)\n        const displayDateRegex = /^\\d{2}[-/]\\d{2}[-/]\\d{4}$/;\n        if (!displayDateRegex.test(expirationDateInput.trim())) {\n            Alert.alert(\"Error\", \"Debes ingresar una fecha de vencimiento vlida en formato DD/MM/AAAA.\");\n            return;\n        }\n        \n        // Convertir la fecha al formato YYYY-MM-DD para la API\n        const apiFormattedDate = formatAPIDate(expirationDateInput.trim());\n        if (!apiFormattedDate) {\n             Alert.alert(\"Error\", \"No se pudo convertir la fecha a un formato vlido para la API.\");\n             return;\n        }\n        \n        // Validar fecha futura\n        const expiry = parseDateToJS(expirationDateInput.trim());\n        const today = new Date();\n        today.setHours(0,0,0,0);\n        if(expiry) expiry.setHours(0,0,0,0); \n        \n        if (!expiry || expiry <= today) {\n            Alert.alert(\"Error\", \"La fecha de vencimiento debe ser una fecha futura.\");\n            return;\n        }\n        // FIN VALIDACION\n\n        setIsLoading(true);\n        try {\n            const token = await getToken();\n            const headers = { 'Authorization': `Bearer ${token}` };\n            const routineGroupId = groupData.routineGroupId;\n            const currentCount = groupData.assignments.length;\n            \n            // 1. PATCH: Actualizar el grupo de rutinas (Nombre y Fecha)\n            await axios.patch(\n                `${API_URL}/routine_groups/${routineGroupId}`, \n                { \n                    nombre: groupName.trim(), \n                    fecha_vencimiento: apiFormattedDate, // Usamos el formato YYYY-MM-DD\n                },\n                { headers }\n            );\n\n            // 2. Manejar la lgica de cambio de das (rutinas)\n            if (routinesCount > currentCount) {\n                // Agregar nuevas rutinas (Da N)\n                const routinesToAdd = routinesCount - currentCount;\n                \n                for (let i = 1; i <= routinesToAdd; i++) {\n                    const newDayNumber = currentCount + i;\n                    \n                    // Llamada al endpoint para crear una nueva rutina en el grupo\n                    await axios.post(\n                        `${API_URL}/routines/group/${routineGroupId}/day/${newDayNumber}/student/${firstRoutine.student_id}`, \n                        { \n                            nombre: `${groupName.trim()} - Da ${newDayNumber}`,\n                            descripcion: `Rutina Da ${newDayNumber} generada por edicin.`,\n                        },\n                        { headers }\n                    );\n                }\n                \n            } else if (routinesCount < currentCount) {\n                // Eliminar rutinas (Da N)\n                const routinesToDeleteCount = currentCount - routinesCount;\n                \n                // Obtenemos los IDs de las asignaciones y rutinas, ordenadas DESCENDENTEMENTE por el da de la rutina.\n                const routinesSortedByDay = groupData.assignments.sort((a, b) => {\n                    const aMatch = a.routine.nombre.match(/ - Dia (\\d+)$/i) || a.routine.nombre.match(/ - Da (\\d+)$/i);\n                    const bMatch = b.routine.nombre.match(/ - Dia (\\d+)$/i) || b.routine.nombre.match(/ - Da (\\d+)$/i);\n                    const aDay = aMatch ? parseInt(aMatch[1]) : 0;\n                    const bDay = bMatch ? parseInt(bMatch[1]) : 0;\n                    return bDay - aDay; // Orden descendente: [Da 3, Da 2, Da 1]\n                });\n\n                const deletionPromises = [];\n                // Tomamos las ltimas 'routinesToDeleteCount'\n                for (let i = 0; i < routinesToDeleteCount; i++) {\n                    const routineToDelete = routinesSortedByDay[i];\n                    if (routineToDelete) {\n                        // Eliminamos la rutina maestra (que debe eliminar asignacin y enlaces en cascada en el backend)\n                        deletionPromises.push(\n                            axios.delete(`${API_URL}/routines/${routineToDelete.routine_id}`, { headers })\n                        );\n                    }\n                }\n                \n                await Promise.all(deletionPromises);\n            }\n\n            Alert.alert(\"xito\", \"Grupo actualizado correctamente. Recuerda recargar si editaste las rutinas individuales!\");\n            fetchCurrentAssignments(); // Refresca los datos en la vista de asignaciones\n            onComplete();\n\n        } catch (e) {\n            console.error(\"Error actualizando grupo:\", e.response ? e.response.data : e.message);\n            Alert.alert(\"Error\", `Fallo al actualizar el grupo. Detalle: ${e.response?.data?.detail || \"Error de red/servidor.\"}`);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <SafeAreaView style={[styles.container, {backgroundColor: 'black'}]}>\n            <View style={styles.headerSelection}>\n                <Text style={styles.wizardTitle}>Editar Grupo: {groupData.groupName}</Text>\n                {/* BOTN CANCELAR */}\n                <TouchableOpacity \n                    style={[styles.customButton, styles.buttonDanger, {minWidth: 80}]} \n                    onPress={onCancel}\n                >\n                    <Text style={styles.buttonText}>Cancelar</Text>\n                </TouchableOpacity>\n            </View>\n            \n            <ScrollView contentContainerStyle={styles.wizardContainer}>\n                <Text style={styles.stepText}>Detalles del Grupo</Text>\n                \n                {/* Nombre de la Agrupacion */}\n                <Text style={wizardLabelStyle}>Nombre de la Agrupacin:</Text>\n                <TextInput\n                    style={styles.wizardInput}\n                    placeholder=\"Ej: Rutina Bloque B\"\n                    placeholderTextColor={placeholderColor}\n                    value={groupName}\n                    onChangeText={setGroupName}\n                />\n                \n                {/* Cantidad de Rutinas */}\n                <Text style={[wizardLabelStyle, {marginTop: 20}]}>Cantidad de Rutinas (Das):</Text>\n                <Text style={styles.warningTextCenter}>\n                    Si se aumenta, se crearn rutinas vacas. Si se reduce, se eliminarn las rutinas con el da ms alto.\n                </Text>\n                <View style={styles.routineCounter}>\n                    <TouchableOpacity \n                        style={[styles.counterButton, { backgroundColor: themeColors.danger }]}\n                        onPress={() => setRoutinesCount(prev => Math.max(1, prev - 1))}\n                        disabled={routinesCount <= 1 || isLoading}\n                    >\n                        <Minus size={24} color={'black'} />\n                    </TouchableOpacity>\n\n                    <Text style={styles.counterCountText}>{routinesCount}</Text>\n\n                    <TouchableOpacity \n                        style={[styles.counterButton, { backgroundColor: '#3ABFBC' }]}\n                        onPress={() => setRoutinesCount(prev => Math.min(5, prev + 1))} // Maximo 5\n                        disabled={routinesCount >= 5 || isLoading}\n                    >\n                        <Plus size={24} color={'black'} />\n                    </TouchableOpacity>\n                </View>\n                \n                {/* Fecha de Vencimiento (Input de texto simple para edicin) */}\n                <Text style={[wizardLabelStyle, {marginTop: 20}]}>Fecha de Vencimiento (DD/MM/AAAA):</Text>\n                <TextInput\n                    style={styles.wizardInput}\n                    placeholder=\"DD/MM/AAAA\" \n                    placeholderTextColor={placeholderColor}\n                    value={expirationDateInput}\n                    onChangeText={setExpirationDateInput}\n                    keyboardType=\"default\"\n                    editable={!isLoading}\n                />\n                <Text style={styles.warningTextCenter}>\n                    Formato DD/MM/AAAA requerido.\n                </Text>\n                \n                <View style={[styles.wizardActions, {justifyContent: 'center'}]}>\n                    {/* BOTN GUARDAR CAMBIOS */}\n                    <TouchableOpacity \n                        style={[styles.customButton, styles.buttonPrimary, { opacity: isLoading ? 0.5 : 1, minWidth: 160 }]} \n                        onPress={handleUpdateGroup} \n                        disabled={isLoading || !groupName.trim() || !expirationDateInput.trim()}\n                    >\n                        <Text style={styles.buttonText}>{isLoading ? \"Guardando...\" : \"Guardar Cambios\"}</Text>\n                    </TouchableOpacity>\n                </View>\n            </ScrollView>\n        </SafeAreaView>\n    );\n}\n\n// --- Sub-componente para Asignar y Gestionar Rutinas ---\nfunction AssignmentView({ student, routines, onAssignmentComplete, onCancel, navigation }) {\n    \n    const { colors: themeColors, isDark } = useTheme(); \n    const assignmentStyles = getAssignmentStyles(themeColors);\n\n    // Estado para editar grupo (Nuevo)\n    const [editingGroup, setEditingGroup] = useState(null); \n    \n    const [currentAssignments, setCurrentAssignments] = useState([]);\n    const [isAssignmentsLoading, setIsAssignmentsLoading] = useState(true);\n\n    const { getToken } = useContext(AuthContext);\n\n    // ----------------------------------------------------------------\n    // FUNCION 1: CARGAR ASIGNACIONES ACTUALES DEL ALUMNO (TODAS)\n    // ----------------------------------------------------------------\n    const fetchCurrentAssignments = async () => {\n        setIsAssignmentsLoading(true);\n        try {\n            const token = await getToken();\n            const headers = { 'Authorization': `Bearer ${token}` };\n\n            const response = await axios.get(\n                `${API_URL}/professor/assignments/student/${student.id}`, \n                { headers }\n            );\n            \n            const sortedAssignments = Array.isArray(response.data) ? response.data : [];\n            setCurrentAssignments(sortedAssignments); \n\n        } catch (e) {\n            if (e.response && e.response.status === 404) {\n                setCurrentAssignments([]);\n            } else {\n                 console.error(\"Error al cargar asignaciones (Ruta Profesor):\", e.response ? e.response.data : e.message);\n                 Alert.alert(\"Error de Conexin\", `No se pudieron cargar las asignaciones. ${e.message}`);\n            }\n        } finally {\n            setIsAssignmentsLoading(false);\n        }\n    };\n    \n    // ----------------------------------------------------------------\n    // FUNCION: NAVEGAR A EDICION DE RUTINA ASIGNADA\n    // ----------------------------------------------------------------\n    const handleEditAssignment = (routineId) => {\n        if (navigation) {\n            // Aseguramos que la navegacin apunte a 'RoutineEditScreen'\n            navigation.navigate('RoutineEditScreen', { \n                routineId: routineId\n            });\n        } else {\n            Alert.alert(\"Error de Navegacion\", \"No se pudo acceder a la pantalla de edicion.\");\n        }\n    };\n\n    // ----------------------------------------------------------------\n    // NUEVA FUNCION: Iniciar Edicin de Grupo\n    // ----------------------------------------------------------------\n    const handleEditGroup = (groupData) => {\n        setEditingGroup(groupData);\n    };\n\n    // ----------------------------------------------------------------\n    // FUNCION 2B: ELIMINAR ASIGNACION DE GRUPO COMPLETO\n    // ----------------------------------------------------------------\n    const handleDeleteRoutineGroup = (routineGroupId, groupName) => {\n        if (!routineGroupId) return;\n        \n        Alert.alert(\n            \"ELIMINAR ASIGNACIONES DE GRUPO\", \n            `Ests seguro de que quieres eliminar TODAS las asignaciones (Da 1, Da 2, etc.) del grupo: ${groupName} para ESTE ALUMNO?`,\n            [\n                { text: \"Cancelar\", style: \"cancel\" },\n                {\n                    text: \"Eliminar Asignaciones\", \n                    style: \"destructive\",\n                    onPress: async () => {\n                        try {\n                            const token = await getToken();\n                            // Endpoint de eliminacion de grupo de asignaciones para un alumno\n                            await axios.delete(`${API_URL}/assignments/group/${routineGroupId}/student/${student.id}`, { \n                                headers: { 'Authorization': `Bearer ${token}` } \n                            });\n                            Alert.alert(\"xito\", \"Grupo de asignaciones eliminado correctamente.\");\n                            fetchCurrentAssignments();\n                        } catch (e) {\n                            console.error(\"Error eliminando grupo:\", e.response ? e.response.data : e.message);\n                            Alert.alert(\"Error\", `Fallo al eliminar el grupo. Detalle: ${e.response?.data?.detail || \"Error de red/servidor.\"}`);\n                        }\n                    }\n                }\n            ]\n        );\n    };\n\n    // ----------------------------------------------------------------\n    // FUNCION 3B: CAMBIAR ESTADO ACTIVO/INACTIVO DE GRUPO COMPLETO\n    // ----------------------------------------------------------------\n    const handleToggleGroupActive = async (assignments, isGroupCurrentlyActive) => {\n        const newStatus = !isGroupCurrentlyActive;\n        \n        try {\n            const token = await getToken();\n            const headers = { 'Authorization': `Bearer ${token}` };\n            \n            // PATCH: Cambia el estado de TODAS las rutinas del grupo.\n            await Promise.all(assignments.map(assignment =>\n                axios.patch(\n                    `${API_URL}/assignments/${assignment.id}`, \n                    { is_active: newStatus }, \n                    { headers }\n                )\n            ));\n\n            Alert.alert(\"xito\", `Grupo ${newStatus ? 'activado' : 'inactivado'} correctamente. **Todas las rutinas estn ${newStatus ? 'activas' : 'inactivas'}.**`);\n            fetchCurrentAssignments(); \n\n        } catch (e) {\n            console.error(\"Error cambiando estado del grupo:\", e.response ? e.response.data : e.message);\n            Alert.alert(\"Error\", `Fallo al cambiar el estado del grupo. Detalle: ${e.response?.data?.detail || \"Error de red/servidor.\"}`);\n        }\n    };\n\n\n    // --- EFECTO: Cargar las asignaciones al cambiar de alumno ---\n    useEffect(() => {\n        fetchCurrentAssignments();\n        // Re-fetch cuando volvemos de editar una rutina individual\n        const unsubscribeFocus = navigation.addListener('focus', () => {\n             fetchCurrentAssignments();\n        });\n\n        return unsubscribeFocus;\n\n    }, [student.id, isDark]); \n    \n    \n    // ----------------------------------------------------------------\n    // FUNCION DE AGRUPACION \n    // ----------------------------------------------------------------\n    const getGroupedAssignments = () => {\n        const groups = {};\n        \n        for (const assignment of currentAssignments) {\n            \n            if (!assignment.routine || !assignment.routine.routine_group) continue;\n            \n            let groupName = assignment.routine.routine_group.nombre;\n            let groupExpiryDate = assignment.routine.routine_group.fecha_vencimiento;\n            let groupCreationDate = assignment.routine.routine_group.created_at; \n            let professorCreatorName = assignment.routine.professor?.nombre; \n            let routineGroupId = assignment.routine.routine_group.id;\n            \n            const groupIdKey = `G-${routineGroupId}`;\n\n            if (!groups[groupIdKey]) {\n                groups[groupIdKey] = {\n                    groupName: groupName,\n                    assignments: [],\n                    expiryDate: groupExpiryDate, // YYYY-MM-DD de la API\n                    creationDate: groupCreationDate, // Cadena ISO/Fecha de la API\n                    professorCreatorName: professorCreatorName, // String o null\n                    routineGroupId: routineGroupId, \n                };\n            }\n            groups[groupIdKey].assignments.push(assignment);\n        }\n\n        return groups;\n    };\n\n    const groupedAssignments = getGroupedAssignments();\n    \n    // Si estamos editando un grupo, mostramos el wizard\n    if (editingGroup) {\n        return (\n            <EditGroupWizard \n                groupData={editingGroup} \n                onCancel={() => setEditingGroup(null)}\n                onComplete={() => setEditingGroup(null)}\n                fetchCurrentAssignments={fetchCurrentAssignments}\n            />\n        );\n    }\n    \n    // --- VISTA DE RENDERIZADO ---\n    return (\n        <ScrollView style={assignmentStyles.scrollContainer}>\n            <View style={assignmentStyles.container}>\n                <Text style={assignmentStyles.title}>Gestionar: {student.nombre}</Text>\n\n                {/* BOTN VOLVER AL PANEL */}\n                <View style={assignmentStyles.backButtonTop}>\n                    <TouchableOpacity \n                        style={[assignmentStyles.customButton, assignmentStyles.buttonSecondary, { minWidth: 160 }]} \n                        onPress={onCancel}\n                    >\n                        <Text style={assignmentStyles.buttonTextSecondary}>Volver al Panel</Text>\n                    </TouchableOpacity>\n                </View>\n\n                {/* -------------------- 1. GESTIONAR ASIGNACIONES (AGRUPADAS) -------------------- */}\n                <Text style={assignmentStyles.subtitle}>Rutinas Asignadas Actualmente ({currentAssignments.length})</Text>\n                \n                {isAssignmentsLoading ? (\n                    <ActivityIndicator size=\"small\" color={'#3ABFBC'} style={{marginBottom: 15}}/>\n                ) : (\n                    <View style={assignmentStyles.currentAssignmentList}>\n                        {Object.keys(groupedAssignments).length > 0 ? (\n                            Object.keys(groupedAssignments).map((groupIdKey, index) => { // Agregamos 'index'\n                                const groupData = groupedAssignments[groupIdKey];\n                                const groupAssignments = groupData.assignments;\n                                \n                                const routineGroupId = groupData.routineGroupId;\n                                // Chequea si alguna rutina del grupo est activa (el ancla)\n                                const isGroupActive = groupAssignments.some(a => a.is_active);\n                                \n                                const finalGroupIdForActions = routineGroupId;\n\n                                // Lgica para el separador visual\n                                const isLastGroup = index === Object.keys(groupedAssignments).length - 1;\n                                const groupStyle = isLastGroup ? {} : assignmentStyles.groupSeparator;\n\n                                return (\n                                    // *** APLICACIN DEL ESTILO DE SEPARACIN ***\n                                    <View key={groupIdKey} style={groupStyle}>\n                                        {/* ENCABEZADO Y ACCIONES DEL GRUPO */}\n                                        <View style={assignmentStyles.groupHeaderContainer}>\n                                            <Text style={assignmentStyles.groupHeader}>\n                                                {groupData.groupName} ({groupAssignments.length} Rutinas)\n                                            </Text>\n                                            \n                                            {/* Mostrar Fecha de Creacin (Formateada) */}\n                                            {groupData.creationDate && (\n                                                <Text style={assignmentStyles.groupDetails}>\n                                                    Creado: {formatDisplayDate(groupData.creationDate)}\n                                                </Text>\n                                            )}\n\n                                            {/* Mostrar Profesor Creador (Se muestra N/A si est ausente) */}\n                                            <Text style={assignmentStyles.groupDetails}>\n                                                Profesor: {groupData.professorCreatorName || 'N/A'}\n                                            </Text>\n                                            \n                                            {/* Mostrar Fecha de Vencimiento formateada */}\n                                            <Text style={assignmentStyles.groupDetails}>\n                                                Vence: {formatDisplayDate(groupData.expiryDate)}\n                                            </Text>\n\n                                            {/* ACCIONES DEL GRUPO */}\n                                            {finalGroupIdForActions && (\n                                                <View style={assignmentStyles.groupActions}>\n\n                                                    {/* Botn de Activar/Inactivar Grupo */}\n                                                    <TouchableOpacity \n                                                        style={[\n                                                            assignmentStyles.toggleGroupButton, \n                                                            { backgroundColor: isGroupActive ? themeColors.warning : '#3ABFBC' } \n                                                        ]}\n                                                        onPress={() => handleToggleGroupActive(groupAssignments, isGroupActive)}\n                                                    >\n                                                        {isGroupActive ? \n                                                            <XCircle size={16} color={'black'} /> :\n                                                            <CheckCircle size={16} color={'black'} />\n                                                        }\n                                                        <Text style={[assignmentStyles.groupActionButtonText, {color: 'black'}]}>\n                                                            {isGroupActive ? 'INACTIVAR GRUPO' : 'ACTIVAR GRUPO'}\n                                                        </Text>\n                                                    </TouchableOpacity>\n\n                                                    {/* Botn de Eliminar Asignaciones de Grupo/Rutina */}\n                                                    <TouchableOpacity \n                                                        style={assignmentStyles.deleteButton} \n                                                        onPress={() => handleDeleteRoutineGroup(finalGroupIdForActions, groupData.groupName)}\n                                                    >\n                                                        <Trash2 size={20} color={themeColors.card} />\n                                                        <Text style={assignmentStyles.groupActionButtonText}>ELIMINAR</Text>\n                                                    </TouchableOpacity>\n                                                   </View>\n                                             )}\n                                             {/* Fin Acciones de Grupo */}\n\n                                            </View>\n\n                                            {/* Listado de rutinas dentro del grupo */}\n                                            {groupAssignments\n                                                .sort((a, b) => {\n                                                    const aMatch = a.routine.nombre.match(/ - Dia (\\d+)$/i) || a.routine.nombre.match(/ - Da (\\d+)$/i);\n                                                    const bMatch = b.routine.nombre.match(/ - Dia (\\d+)$/i) || b.routine.nombre.match(/ - Da (\\d+)$/i);\n                                                    const aDay = aMatch ? parseInt(aMatch[1]) : 999;\n                                                    const bDay = bMatch ? parseInt(bMatch[1]) : 999;\n                                                    return aDay - bDay;\n                                                })\n                                                .map((assignment) => (\n                                                    <CollapsibleAssignmentCard \n                                                        key={assignment.id.toString()}\n                                                        assignment={assignment}\n                                                        assignmentStyles={assignmentStyles}\n                                                        themeColors={themeColors}\n                                                        // Esta llamada es la que edita la rutina individual\n                                                        handleEditAssignment={handleEditAssignment} \n                                                    />\n                                                ))}\n                                        </View>\n                                    );\n                                })\n                            ) : (\n                                <Text style={assignmentStyles.warning}>Este alumno no tiene rutinas asignadas.</Text>\n                            )}\n                        </View>\n                    )}\n\n               </View>\n             </ScrollView>\n           );\n}\n\n// ----------------------------------------------------------------------\n// GENERADOR DE ESTILOS PARA LA PANTALLA PRINCIPAL (ProfessorScreen) - ESTILO PEAKFIT\n// ----------------------------------------------------------------------\n\nconst getMainScreenStyles = (colors) => StyleSheet.create({\n    // COLORES PEAKFIT: \n    // - background: Negro ('black')\n    // - card: Gris oscuro para tarjetas e inputs ('#1C1C1E')\n    // - primary/success: Verde brillante ('#3ABFBC')\n    // - textPrimary: Blanco\n    // - textSecondary: Gris claro ('#A9A9A9')\n    \n    container: { flex: 1, backgroundColor: 'black', },\n    loadingContainer: { flex: 1, justifyContent: 'center', alignItems: 'center', backgroundColor: 'black', },\n    \n    // INPUT DE BSQUEDA (Estilo oscuro y redondeado)\n    searchInput: {\n        height: 45, \n        backgroundColor: '#1C1C1E', // Fondo de tarjeta oscuro\n        borderColor: '#1C1C1E',     // Borde invisible/oscuro\n        borderWidth: 1,\n        borderRadius: 10, // Ms redondeado\n        paddingHorizontal: 15, \n        fontSize: 16, \n        color: 'white', // Texto blanco\n        marginHorizontal: 20, \n        marginTop: 15, \n        marginBottom: 20,\n    },\n    \n    // CABECERA (Header y HeaderSelection)\n    header: {\n        flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center',\n        padding: 15, \n        backgroundColor: 'black', // Fondo negro\n        borderBottomWidth: 1,\n        borderBottomColor: colors.divider, // Separador sutil\n        elevation: 0, // Quitamos sombra para el fondo oscuro\n    },\n    headerSelection: { \n        flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center',\n        padding: 20, \n        backgroundColor: '#1C1C1E', // Fondo de tarjeta oscuro\n        borderBottomWidth: 1,\n        borderBottomColor: colors.divider,\n    },\n    headerTitle: { fontSize: 18, fontWeight: 'bold', color: 'white', flex: 1, textAlign: 'center', },\n    titleSelection: { fontSize: 22, fontWeight: 'bold', color: '#3ABFBC', }, // Verde\n    headerButtons: { flexDirection: 'row', gap: 15, },\n    \n    // Iconos de la cabecera\n    iconButton: { \n        padding: 8, \n        borderRadius: 8, \n        justifyContent: 'center', \n        alignItems: 'center', \n        backgroundColor: '#1C1C1E', // Fondo de botn oscuro\n    },\n    \n    // Seccin de Bienvenida/Acciones\n    actionSection: {\n        paddingHorizontal: 20, paddingVertical: 15, \n        backgroundColor: '#1C1C1E', // Fondo de tarjeta oscuro\n        borderBottomWidth: 1, borderBottomColor: colors.divider, \n        alignItems: 'flex-start',\n    },\n    subtitle: { fontSize: 20, fontWeight: 'bold', color: 'white', marginBottom: 10, },\n    listTitle: { \n        fontSize: 18, fontWeight: 'bold', color: 'white', \n        paddingVertical: 10, \n        paddingHorizontal: 20,\n        backgroundColor: 'black', // Ttulo sobre fondo negro\n    },\n    \n    // Tarjeta de Alumno\n    studentCard: {\n        flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center',\n        backgroundColor: '#1F2937', // Fondo de tarjeta oscuro\n        borderRadius: 10, \n        padding: 15, \n        marginBottom: 10, \n        shadowColor: '#000', // Sombra oscura\n        shadowOffset: { width: 0, height: 1 }, \n        shadowOpacity: 0.8,\n        shadowRadius: 5, \n        elevation: 4, \n        width: '100%', \n    },\n    studentName: { fontSize: 18, fontWeight: '600', color: 'white', },\n    studentEmail: { fontSize: 14, color: '#A9A9A9', }, // Gris claro\n    studentCardActions: { flexDirection: 'row', gap: 10, },\n    \n    // Botones de accin en la tarjeta (Rutina, Editar)\n    actionButton: { \n        paddingVertical: 8, paddingHorizontal: 12, borderRadius: 8, \n        alignItems: 'center', justifyContent: 'center', minWidth: 80, \n    },\n    actionButtonText: { fontSize: 13, fontWeight: 'bold', color: 'black', }, // Texto negro para contraste\n    \n    // Botn de Accin Flotante (FAB)\n    fab: {\n        position: 'absolute', width: 60, height: 60, alignItems: 'center', justifyContent: 'center',\n        right: 20, bottom: 20, \n        backgroundColor: '#3ABFBC', // Verde brillante\n        borderRadius: 30, elevation: 8,\n        shadowColor: '#3ABFBC', \n        shadowOpacity: 0.8,\n        shadowOffset: { width: 0, height: 4 }, \n        shadowRadius: 10,\n    },\n    fabIcon: { color: 'black', }, // Icono negro en fondo verde\n    warningTextCenter: { color: colors.warning, textAlign: 'center', padding: 10, },\n    errorView: { flex: 1, justifyContent: 'center', alignItems: 'center', padding: 40, backgroundColor: 'black', },\n    errorTitle: { fontSize: 26, fontWeight: 'bold', color: colors.danger, marginBottom: 10, },\n    errorDetail: { fontSize: 16, color: '#A9A9A9', textAlign: 'center', },\n    \n    // Men Lateral (Drawer)\n    modalOverlay: { flex: 1, backgroundColor: 'rgba(0, 0, 0, 0.7)', justifyContent: 'flex-start', alignItems: 'flex-start', },\n    menuContainer: {\n        width: 280, height: '100%', \n        backgroundColor: '#1C1C1E', // Fondo oscuro del men\n        position: 'absolute', \n        left: 0, top: 0, \n        shadowColor: '#000',\n        shadowOffset: { width: 2, height: 0 }, \n        shadowOpacity: 1,\n        shadowRadius: 5, \n        elevation: 10,\n    },\n    menuTitle: {\n        fontSize: 18, fontWeight: 'bold', paddingVertical: 15, marginBottom: 10,\n        borderBottomWidth: 1, borderBottomColor: colors.divider, \n        color: '#3ABFBC', // Ttulo verde\n        paddingHorizontal: 15, \n    },\n    menuItem: {\n        paddingVertical: 12, borderBottomWidth: 1, borderBottomColor: colors.divider,\n        flexDirection: 'row', alignItems: 'center', gap: 10, paddingHorizontal: 15, \n    },\n    menuItemClose: {\n        position: 'absolute', bottom: 0, left: 0, right: 0, padding: 15,\n        backgroundColor: colors.divider, alignItems: 'center',\n    },\n    menuItemText: { fontSize: 15, color: 'white', fontWeight: '600', },\n    menuItemTextLogout: { fontSize: 15, color: colors.danger, fontWeight: '600', },\n    menuItemTextClose: { fontSize: 15, color: 'white', fontWeight: '600', },\n    \n    // Wizard (Asistente de Creacin/Edicin)\n    wizardContainer: { flexGrow: 1, padding: 20, width: '100%', },\n    wizardTitle: { fontSize: 24, fontWeight: 'bold', color: '#3ABFBC', marginBottom: 20, textAlign: 'center', }, // Verde\n    wizardInput: {\n        height: 50, \n        backgroundColor: '#1C1C1E', // Fondo oscuro\n        borderColor: colors.divider, \n        borderWidth: 1,\n        borderRadius: 10, // Redondeado\n        paddingHorizontal: 15, \n        fontSize: 16, \n        color: 'white',\n        marginBottom: 20, \n        width: '100%',\n    },\n    wizardActions: { flexDirection: 'row', justifyContent: 'space-between', marginTop: 30, },\n    routineCounter: { flexDirection: 'row', justifyContent: 'center', alignItems: 'center', gap: 20, marginBottom: 20, paddingVertical: 10, },\n    counterButton: { \n        padding: 10, \n        backgroundColor: '#3ABFBC', // Verde (Usamos el color directo ya que el primario del tema es dinmico)\n        borderRadius: 8, \n    },\n    counterCountText: { fontSize: 32, fontWeight: 'bold', color: 'white', width: 60, textAlign: 'center', },\n    \n    // Indicador de Progreso\n    progressContainer: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 30, paddingVertical: 15, width: '100%', },\n    progressStep: { flex: 1, alignItems: 'center', position: 'relative', },\n    progressConnectorBackground: { height: 4, backgroundColor: colors.divider, position: 'absolute', top: 20, zIndex: 0, },\n    progressConnectorActive: { backgroundColor: '#3ABFBC', }, // Verde brillante\n    progressCircle: {\n        width: 40, height: 40, borderRadius: 20, \n        backgroundColor: '#1C1C1E', // Fondo oscuro\n        borderWidth: 2,\n        borderColor: colors.divider, \n        justifyContent: 'center', alignItems: 'center', zIndex: 1,\n    },\n    progressCircleActive: { borderColor: '#3ABFBC', }, // Verde\n    progressCircleDone: { backgroundColor: '#3ABFBC', borderColor: '#3ABFBC', }, // Verde\n    progressText: { marginTop: 5, fontSize: 12, color: colors.textSecondary, fontWeight: '500', },\n    \n    // Botones (Estilo Unificado)\n    customButton: {\n        paddingVertical: 12, paddingHorizontal: 20, borderRadius: 10, alignItems: 'center',\n        justifyContent: 'center', minWidth: 100, shadowColor: \"#000\", shadowOffset: { width: 0, height: 2 },\n        shadowOpacity: 0.5, shadowRadius: 3, elevation: 4,\n    },\n    buttonPrimary: { backgroundColor: '#3ABFBC', }, // Verde principal\n    buttonSecondary: { backgroundColor: '#1C1C1E', borderColor: colors.divider, borderWidth: 1, }, // Oscuro secundario\n    buttonDanger: { backgroundColor: colors.danger, },\n    buttonText: { fontSize: 16, fontWeight: 'bold', color: 'black', }, // Texto negro en verde o rojo\n    buttonTextSecondary: { fontSize: 16, fontWeight: 'bold', color: 'white', }, // Texto blanco en secundario oscuro\n    \n    // Input de Fecha (Modal Custom)\n    dateInputContainer: {\n        flexDirection: 'row', alignItems: 'center', height: 50, \n        backgroundColor: '#1C1C1E', // Fondo oscuro\n        borderColor: colors.divider, borderWidth: 1, borderRadius: 10, paddingHorizontal: 15,\n        marginBottom: 20, justifyContent: 'space-between',\n    },\n    dateText: { fontSize: 16, color: 'white', fontWeight: '500', flex: 1, },\n    \n    // Contenido del DatePicker Modal\n    modalContent: {\n        backgroundColor: '#1C1C1E', // Fondo oscuro\n        borderRadius: 10,\n        padding: 20,\n        width: '80%',\n        alignSelf: 'center',\n        marginTop: '30%',\n        shadowColor: '#000',\n        shadowOffset: { width: 0, height: 2 },\n        shadowOpacity: 0.5,\n        shadowRadius: 4,\n        elevation: 5,\n    },\n    datePickerInputGroup: {\n        flexDirection: 'row',\n        justifyContent: 'space-between',\n        marginBottom: 20,\n        gap: 10,\n    },\n    datePickerInput: {\n        flex: 1,\n        height: 50,\n        backgroundColor: 'black', // Fondo ms oscuro para input\n        borderColor: colors.divider,\n        borderWidth: 1,\n        borderRadius: 8,\n        paddingHorizontal: 10,\n        fontSize: 18,\n        color: 'white',\n        textAlign: 'center',\n    },\n    \n    // Estilo de los ttulos de los pasos del Wizard\n    stepText: {\n        fontSize: 20,\n        fontWeight: 'bold',\n        color: 'white', \n        marginBottom: 15,\n        textAlign: 'center',\n        paddingVertical: 5,\n        borderBottomWidth: 1,\n        borderBottomColor: colors.divider,\n    },\n    // Estilo para labels de Wizard (Adaptado)\n    label: { \n        fontSize: 16, \n        fontWeight: '600', \n        color: 'white', \n        marginBottom: 10, \n    },\n});\n\n// ----------------------------------------------------------------------\n// COMPONENTE: INDICADOR DE PROGRESO (Minimalista)\n// ----------------------------------------------------------------------\nconst ProgressIndicator = ({ currentStep, totalSteps, stepNames, themeColors }) => {\n    const styles = getMainScreenStyles(themeColors);\n\n    const steps = Array.from({ length: totalSteps }, (_, i) => i + 1);\n\n    return (\n        <View style={{ width: '100%', paddingHorizontal: 0 }}>\n            <View style={styles.progressContainer}>\n                {steps.map((stepNum, index) => {\n                    const isActive = stepNum === currentStep;\n                    const isDone = stepNum < currentStep;\n\n                    let circleStyle = styles.progressCircle;\n                    \n                    if (isActive) {\n                        circleStyle = { ...circleStyle, ...styles.progressCircleActive };\n                    } else if (isDone) {\n                        circleStyle = { ...circleStyle, ...styles.progressCircleDone };\n                    }\n                    \n                    const isLastStep = index === totalSteps - 1;\n\n                    return (\n                        <View key={stepNum} style={styles.progressStep}>\n                            {/* Conector desde el paso anterior */}\n                            {index > 0 && (\n                                <View style={[\n                                    styles.progressConnectorBackground,\n                                    { width: '100%', right: '50%' }, \n                                ]}>\n                                    <View style={[\n                                        { height: '100%' }, \n                                        styles.progressConnectorActive,\n                                        { width: isDone ? '100%' : (isActive ? '50%' : '0%') }\n                                    ]}/>\n                                </View>\n                            )}\n\n                            {/* Crculo del Paso */}\n                            <View style={circleStyle}>\n                                {isDone ? (\n                                    <CheckCircle size={18} color={'black'} />\n                                ) : (\n                                    <Text style={{ \n                                        color: isActive ? '#3ABFBC' : themeColors.textSecondary, \n                                        fontWeight: 'bold',\n                                        fontSize: 14,\n                                    }}>\n                                        {stepNum}\n                                    </Text>\n                                )}\n                            </View>\n                            \n                            {/* Texto del Paso */}\n                            <Text style={[styles.progressText, { color: isDone ? '#3ABFBC' : (isActive ? '#3ABFBC' : themeColors.textSecondary) }]}>\n                                {stepNames[stepNum - 1]}\n                            </Text>\n\n                            {/* Conector hacia el siguiente */}\n                            {!isLastStep && (\n                                <View style={[\n                                    styles.progressConnectorBackground,\n                                    { width: '100%', left: '50%' },\n                                ]}/>\n                            )}\n                        </View>\n                    );\n                })}\n            </View>\n        </View>\n    );\n};\n\n// ----------------------------------------------------------------------\n//  NUEVO COMPONENTE: MODAL DE SELECCIN DE FECHA CUSTOM\n// ----------------------------------------------------------------------\nfunction DatePickerModal({ isVisible, initialDate, onClose, onDateSelect }) {\n    const { colors: themeColors } = useTheme();\n    const styles = getMainScreenStyles(themeColors);\n    \n    // Inicializa DD/MM/AAAA. Si initialDate es un objeto Date, lo parseamos.\n    let initialDay = '';\n    let initialMonth = '';\n    let initialYear = '';\n    if (initialDate instanceof Date && !isNaN(initialDate.getTime())) {\n        const display = formatDisplayDate(initialDate).split('/');\n        initialDay = display[0];\n        initialMonth = display[1];\n        initialYear = display[2];\n    }\n\n    const [day, setDay] = useState(initialDay);\n    const [month, setMonth] = useState(initialMonth);\n    const [year, setYear] = useState(initialYear);\n\n    // Refs para enfocar al siguiente campo\n    const monthRef = useRef(null);\n    const yearRef = useRef(null);\n\n    const handleConfirm = () => {\n        const d = parseInt(day, 10);\n        const m = parseInt(month, 10);\n        const y = parseInt(year, 10);\n\n        // 1. Validaciones bsicas\n        if (isNaN(d) || isNaN(m) || isNaN(y) || d < 1 || m < 1 || m > 12 || y < 2024 || y > 2100) {\n            Alert.alert(\"Error de Fecha\", \"Por favor, ingrese valores vlidos para Da (1-31), Mes (1-12) y Ao (Mn. 2024).\");\n            return;\n        }\n\n        // 2. Validacin de fecha real (JS Date Object)\n        // Usamos el mes - 1 porque Date usa ndice base 0 (Enero=0)\n        const date = new Date(y, m - 1, d);\n        \n        // Verifica que la fecha construida coincida con los inputs (ej: 31 de Febrero -> 3 de Marzo)\n        if (date.getFullYear() !== y || date.getMonth() !== m - 1 || date.getDate() !== d) {\n             Alert.alert(\"Error de Fecha\", \"Fecha invlida (Ej: Febrero tiene 28/29 das).\");\n             return;\n        }\n        \n        // 3. Validacin de fecha futura (ignora el tiempo)\n        const today = new Date();\n        today.setHours(0, 0, 0, 0); \n        date.setHours(0, 0, 0, 0);\n        \n        if (date <= today) {\n            Alert.alert(\"Error de Fecha\", \"La fecha de vencimiento debe ser una fecha futura.\");\n            return;\n        }\n\n        onDateSelect(date);\n        onClose();\n    };\n\n    return (\n        <Modal\n            animationType=\"fade\"\n            transparent={true}\n            visible={isVisible}\n            onRequestClose={onClose}\n        >\n            <TouchableOpacity \n                style={[styles.modalOverlay, {justifyContent: 'center', alignItems: 'center'}]}\n                activeOpacity={1}\n                onPressOut={onClose}\n            >\n                <View style={styles.modalContent} onStartShouldSetResponder={() => true}>\n                    <Text style={[styles.wizardTitle, {color: 'white', fontSize: 20}]}>Seleccionar Fecha de Vencimiento</Text>\n                    \n                    <View style={styles.datePickerInputGroup}>\n                        <TextInput\n                            style={styles.datePickerInput}\n                            placeholder=\"DD\"\n                            placeholderTextColor={themeColors.textSecondary}\n                            keyboardType=\"numeric\"\n                            maxLength={2}\n                            value={day}\n                            onChangeText={(text) => {\n                                setDay(text.replace(/[^0-9]/g, ''));\n                                if (text.length === 2 && monthRef.current) {\n                                     monthRef.current.focus();\n                                }\n                            }}\n                        />\n                        <TextInput\n                            ref={monthRef}\n                            style={styles.datePickerInput}\n                            placeholder=\"MM\"\n                            placeholderTextColor={themeColors.textSecondary}\n                            keyboardType=\"numeric\"\n                            maxLength={2}\n                            value={month}\n                            onChangeText={(text) => {\n                                setMonth(text.replace(/[^0-9]/g, ''));\n                                if (text.length === 2 && yearRef.current) {\n                                     yearRef.current.focus();\n                                }\n                            }}\n                        />\n                        <TextInput\n                            ref={yearRef}\n                            style={styles.datePickerInput}\n                            placeholder=\"AAAA\"\n                            placeholderTextColor={themeColors.textSecondary}\n                            keyboardType=\"numeric\"\n                            maxLength={4}\n                            value={year}\n                            onChangeText={(text) => setYear(text.replace(/[^0-9]/g, ''))}\n                        />\n                    </View>\n\n                    <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginTop: 10 }}>\n                        <TouchableOpacity\n                            style={[styles.customButton, styles.buttonDanger]}\n                            onPress={onClose}\n                        >\n                            <Text style={styles.buttonText}>Cancelar</Text>\n                        </TouchableOpacity>\n                        <TouchableOpacity\n                            style={[styles.customButton, styles.buttonPrimary]}\n                            onPress={handleConfirm}\n                        >\n                            <Text style={styles.buttonText}>Confirmar</Text>\n                        </TouchableOpacity>\n                    </View>\n                </View>\n            </TouchableOpacity>\n        </Modal>\n    );\n}\n\n// ----------------------------------------------------------------------\n// --- COMPONENTE: Asistente de Creacion Simplificado (3 Pasos) ---\n// ----------------------------------------------------------------------\nfunction CreationWizardSimplified({ students, onCancel, navigation }) {\n    \n    const { colors: themeColors } = useTheme();\n    const styles = getMainScreenStyles(themeColors); \n\n    const [step, setStep] = useState(1);\n    const [routineName, setRoutineName] = useState(''); \n    const [routineDescription, setRoutineDescription] = useState(''); \n    const [routinesCount, setRoutinesCount] = useState(1); \n    \n    // ***************************************************************\n    // ESTADO DE FECHA CON COMPONENTE DATETIMEPICKER\n    // ***************************************************************\n    const [expirationDateObject, setExpirationDateObject] = useState(null); // Objeto Date seleccionado\n    const [showDatePicker, setShowDatePicker] = useState(false); // Visibilidad del picker (Ahora Modal)\n    // ***************************************************************\n\n    const [searchTerm, setSearchTerm] = useState(''); \n\n    const wizardLabelStyle = {\n        ...styles.label, \n        color: 'white', // Usa el color blanco\n        fontSize: 18, \n        fontWeight: 'bold', \n        marginBottom: 10,\n    };\n    \n    const placeholderColor = themeColors.isDark ? themeColors.textSecondary : '#6B7280';\n\n\n    const STEP_NAMES = [\"Nombre\", \"Config\", \"Asignacin\"]; \n    const TOTAL_STEPS = 3;\n\n    const { getToken } = useContext(AuthContext);\n\n    // Funcin para inactivar todas las asignaciones existentes para un alumno\n    const deactivateExistingAssignments = async (studentId) => {\n        try {\n            const token = await getToken();\n            const headers = { 'Authorization': `Bearer ${token}` };\n            \n            const response = await axios.get(\n                `${API_URL}/professor/assignments/student/${studentId}`, \n                { headers }\n            );\n            const assignmentsToDeactivate = Array.isArray(response.data) ? response.data : [];\n\n            const patchPromises = assignmentsToDeactivate.map(assignment => \n                axios.patch(\n                    `${API_URL}/assignments/${assignment.id}`, \n                    { is_active: false }, \n                    { headers }\n                )\n            );\n            \n            await Promise.all(patchPromises);\n            console.log(`Inactivadas ${patchPromises.length} asignaciones anteriores para el alumno ${studentId}.`);\n\n        } catch (e) {\n            console.error(\"Error al inactivar asignaciones anteriores:\", e.response ? e.response.data : e.message);\n        }\n    };\n\n\n    // Filtra los alumnos solo para la seleccion (Step 3)\n    const filteredStudents = useMemo(() => {\n        if (!searchTerm) {\n            return students;\n        }\n        const lowerCaseSearch = searchTerm.toLowerCase();\n        return students.filter(student => \n            student.nombre.toLowerCase().includes(lowerCaseSearch) ||\n            student.email.toLowerCase().includes(lowerCaseSearch)\n        );\n    }, [students, searchTerm]);\n\n    const handleSelectStudent = async (student) => {\n        \n        Alert.alert(\n            \"Confirmacin de Asignacin\",\n            `Al asignar esta nueva rutina, todas las asignaciones **activas** anteriores para **${student.nombre}** sern inactivadas. Continuar?`,\n            [\n                { text: \"Cancelar\", style: \"cancel\" },\n                { \n                    text: \"Crear y Asignar\", \n                    onPress: async () => {\n                        // Inactivar grupos anteriores\n                        await deactivateExistingAssignments(student.id);\n\n                        // 1. Convertir el objeto Date al formato YYYY-MM-DD para la API\n                        const apiFormattedDate = expirationDateObject \n                            ? formatAPIDate(expirationDateObject) \n                            : null;\n                        \n                        // 2. FIN DEL WIZARD: Navegamos a RoutineCreationScreen\n                        navigation.navigate('RoutineCreation', { \n                            studentId: student.id,\n                            studentName: student.nombre,\n                            routineMetadata: {\n                                nombre: routineName.trim(),\n                                descripcion: routineDescription.trim(), \n                                days: routinesCount, \n                                expirationDate: apiFormattedDate \n                            }\n                        });\n                        onCancel(); // Cerramos el wizard en ProfessorScreen\n                    }\n                }\n            ]\n        );\n    };\n    \n    // ***************************************************************\n    // HANDLER DE SELECCIN DE FECHA CUSTOM\n    // ***************************************************************\n    const handleDateSelect = (selectedDate) => {\n        // La validacin de fecha futura ya ocurri en DatePickerModal\n        setExpirationDateObject(selectedDate);\n    };\n\n    // Formatea la fecha para mostrar en el botn\n    const formatDateDisplay = (date) => {\n        if (!date) return \"Toca para Seleccionar Fecha\";\n        // Formato DD/MM/AAAA usando la funcin global para consistencia\n        return formatDisplayDate(date);\n    };\n    // ***************************************************************\n\n\n    const renderStep = () => {\n        switch (step) {\n            case 1:\n                return (\n                    <>\n                        <Text style={styles.stepText}>Paso 1: Nombre y Descripcin del Grupo</Text>\n                        <Text style={wizardLabelStyle}>Nombre de la Agrupacin:</Text>\n                        <TextInput\n                            style={styles.wizardInput}\n                            placeholder=\"Ej: Rutina Bloque A / Mes 1\"\n                            placeholderTextColor={placeholderColor}\n                            value={routineName}\n                            onChangeText={setRoutineName}\n                            autoFocus\n                        />\n                        <Text style={wizardLabelStyle}>Descripcin del Grupo (Opcional):</Text>\n                        <TextInput\n                            style={[styles.wizardInput, { height: 80, textAlignVertical: 'top' }]}\n                            placeholder=\"Ej: Fase de hipertrofia de 4 semanas.\"\n                            placeholderTextColor={placeholderColor}\n                            value={routineDescription}\n                            onChangeText={setRoutineDescription}\n                            multiline\n                        />\n                        <Text style={styles.warningTextCenter}>\n                            Este nombre agrupar las rutinas (Da 1, Da 2, etc.)\n                        </Text>\n                    </>\n                );\n            case 2:\n                return (\n                    <>\n                        <Text style={styles.stepText}>Paso 2: Configuracin de la Agrupacin</Text>\n                        \n                        {/* Cantidad de Rutinas */}\n                        <Text style={[wizardLabelStyle, {marginTop: 20}]}>Cantidad de Rutinas (Das):</Text>\n                        <Text style={styles.warningTextCenter}>\n                            (Mnimo 1, Mximo 5 rutinas)\n                        </Text>\n                        <View style={styles.routineCounter}>\n                            <TouchableOpacity \n                                style={[styles.counterButton, { backgroundColor: themeColors.danger }]}\n                                onPress={() => setRoutinesCount(prev => Math.max(1, prev - 1))}\n                                disabled={routinesCount <= 1}\n                            >\n                                <Minus size={24} color={'black'} />\n                            </TouchableOpacity>\n\n                            <Text style={styles.counterCountText}>{routinesCount}</Text>\n\n                            <TouchableOpacity \n                                style={[styles.counterButton, { backgroundColor: '#3ABFBC' }]}\n                                onPress={() => setRoutinesCount(prev => Math.min(5, prev + 1))} // Maximo 5\n                                disabled={routinesCount >= 5}\n                            >\n                                <Plus size={24} color={'black'} />\n                            </TouchableOpacity>\n                        </View>\n                        \n                        {/* FECHA DE VENCIMIENTO INTERACTIVA (AHORA ES UN BOTN QUE ABRE EL MODAL CUSTOM) */}\n                        <Text style={[wizardLabelStyle, {marginTop: 20}]}>Fecha de Vencimiento:</Text>\n                        <TouchableOpacity \n                            style={styles.dateInputContainer} \n                            onPress={() => setShowDatePicker(true)}\n                        >\n                            <Text style={styles.dateText}>\n                                {formatDateDisplay(expirationDateObject)}\n                            </Text>\n                            <Calendar size={20} color={'#3ABFBC'} />\n                        </TouchableOpacity>\n                        \n                        {/* MODAL DE SELECCIN DE FECHA */}\n                        <DatePickerModal \n                            isVisible={showDatePicker}\n                            initialDate={expirationDateObject}\n                            onClose={() => setShowDatePicker(false)}\n                            onDateSelect={handleDateSelect}\n                        />\n\n                        <Text style={styles.studentEmail}>\n                            Rutinas a crear: {routinesCount} | Vence: {expirationDateObject ? formatDateDisplay(expirationDateObject) : '[Fecha Requerida]'}\n                        </Text>\n                    </>\n                );\n            case 3:\n                return (\n                    <>\n                        <Text style={styles.stepText}>Paso 3: Selecciona el Alumno</Text>\n                        <TextInput\n                            style={styles.searchInput} \n                            placeholder=\"Buscar alumno por nombre o email...\"\n                            placeholderTextColor={placeholderColor}\n                            value={searchTerm}\n                            onChangeText={setSearchTerm}\n                        />\n                        <ScrollView style={{ maxHeight: 400, marginBottom: 20 }}>\n                            {filteredStudents.length > 0 ? (\n                                filteredStudents.map((item) => (\n                                    <TouchableOpacity \n                                        key={item.id.toString()}\n                                        style={styles.studentCard}\n                                        onPress={() => handleSelectStudent(item)}\n                                    >\n                                        <View>\n                                            <Text style={styles.studentName}>{item.nombre}</Text>\n                                            <Text style={styles.studentEmail}>{item.email}</Text>\n                                        </View>\n                                        <Text style={{...styles.actionButtonText, color: '#3ABFBC'}}>CREAR >> </Text>\n                                    </TouchableOpacity>\n                                ))\n                            ) : (\n                                <Text style={styles.warningTextCenter}>No se encontraron alumnos.</Text>\n                            )}\n                        </ScrollView>\n                        <Text style={styles.studentEmail}>\n                             Agrupacin: {routineName.trim()} | Vence: {expirationDateObject ? formatDateDisplay(expirationDateObject) : 'N/A'}\n                        </Text>\n                    </>\n                );\n            default:\n                return null;\n        }\n    };\n\n    const nextStep = () => {\n        if (step === 1) {\n            if (!routineName.trim()) {\n                Alert.alert(\"Error\", \"Debes ingresar un nombre para la agrupacin.\");\n                return;\n            }\n            setStep(2);\n        } else if (step === 2) {\n            if (routinesCount < 1) {\n                Alert.alert(\"Error\", \"Debes seleccionar al menos una rutina para crear.\");\n                return;\n            }\n            \n            if (!expirationDateObject) {\n                Alert.alert(\"Error\", \"Debes seleccionar una fecha de vencimiento.\");\n                return;\n            }\n\n            // Validacin de fecha futura\n            const expiry = new Date(expirationDateObject.setHours(0,0,0,0));\n            const today = new Date(new Date().setHours(0,0,0,0)); \n            \n            if (!expiry || isNaN(expiry.getTime())) {\n                Alert.alert(\"Error\", \"Fecha de vencimiento invlida.\");\n                return;\n            }\n\n            if (expiry <= today) {\n                Alert.alert(\"Error\", \"La fecha de vencimiento debe ser una fecha futura.\");\n                return;\n            }\n\n            setStep(3);\n        }\n    };\n    \n    const isStepTwoValid = routinesCount >= 1 && expirationDateObject;\n    \n    return (\n        <SafeAreaView style={styles.container}>\n            <View style={styles.headerSelection}>\n                <Text style={styles.wizardTitle}>Crear Rutina Agrupada</Text>\n                {/* BOTN CANCELAR */}\n                <TouchableOpacity \n                    style={[styles.customButton, styles.buttonDanger, {minWidth: 80}]} \n                    onPress={onCancel}\n                >\n                    <Text style={styles.buttonText}>Cancelar</Text>\n                </TouchableOpacity>\n            </View>\n            \n            {/* INTEGRACIN DEL INDICADOR DE PROGRESO */}\n            <ProgressIndicator \n                currentStep={step} \n                totalSteps={TOTAL_STEPS} \n                stepNames={STEP_NAMES} \n                themeColors={themeColors}\n            />\n\n            <ScrollView contentContainerStyle={styles.wizardContainer}>\n                {renderStep()}\n\n                <View style={styles.wizardActions}>\n                    {/* BOTN ATRS */}\n                    <TouchableOpacity \n                        style={[styles.customButton, styles.buttonSecondary, { opacity: step === 1 ? 0.5 : 1 }]} \n                        onPress={() => setStep(step - 1)} \n                        disabled={step === 1}\n                    >\n                        <Text style={styles.buttonTextSecondary}>{\"< Atrs\"}</Text>\n                    </TouchableOpacity>\n\n                    {(step === 1 || step === 2) && (\n                        /* BOTN SIGUIENTE */\n                        <TouchableOpacity \n                            style={[styles.customButton, styles.buttonPrimary, { opacity: (step === 1 ? !routineName.trim() : !isStepTwoValid) ? 0.5 : 1 }]} \n                            onPress={nextStep} \n                            disabled={step === 1 ? !routineName.trim() : !isStepTwoValid}\n                        >\n                            <Text style={styles.buttonText}>{\"Siguiente >\"}</Text>\n                        </TouchableOpacity>\n                    )}\n                </View>\n            </ScrollView>\n        </SafeAreaView>\n    );\n}\n\n\n// --- PANTALLA PRINCIPAL DEL PROFESOR ---\nexport default function ProfessorScreen({ navigation }) {\n    \n    const { colors: themeColors, isDark } = useTheme();\n    const styles = getMainScreenStyles(themeColors); // Estilos dinamicos\n\n    const [students, setStudents] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [selectedStudent, setSelectedStudent] = useState(null); // Alumno para asignar/gestionar\n    \n    const [creatingForStudent, setCreatingForStudent] = useState(false); \n    const [dataError, setDataError] = useState(null); \n    const [isMenuVisible, setIsMenuVisible] = useState(false); \n\n    const [searchTerm, setSearchTerm] = useState('');\n\n    const { signOut, getToken, userProfile } = useContext(AuthContext);\n\n    // ----------------------------------------------------------------\n    // LGICA DE ANIMACIN DEL DRAWER (Men Lateral)\n    // ----------------------------------------------------------------\n    const drawerWidth = 280; \n    const menuAnim = useRef(new Animated.Value(-drawerWidth)).current; \n\n    // Funcin para animar la entrada del men\n    const animateIn = () => {\n        setIsMenuVisible(true); \n        Animated.timing(menuAnim, {\n            toValue: 0, \n            duration: 300,\n            useNativeDriver: true,\n        }).start();\n    };\n\n    // Funcin para animar la salida del men\n    const animateOut = (callback) => {\n        Animated.timing(menuAnim, {\n            toValue: -drawerWidth, \n            duration: 300,\n            useNativeDriver: true,\n        }).start(() => {\n            setIsMenuVisible(false); \n            if (callback) callback();\n        });\n    };\n    // ----------------------------------------------------------------\n    \n    // ----------------------------------------------------------------\n    // FUNCION PRINCIPAL: CARGA DATOS\n    // ----------------------------------------------------------------\n    const fetchData = async () => {\n        setIsLoading(true);\n        setDataError(null); \n        try {\n            const token = await getToken();\n            const headers = { 'Authorization': `Bearer ${token}` };\n\n            const studentsResponse = await axios.get(`${API_URL}/users/students`, { headers });\n            setStudents(Array.isArray(studentsResponse.data) ? studentsResponse.data : []);\n\n        } catch (e) {\n            console.error(\"Error cargando datos del profesor:\", e.response ? e.response.data : e.message);\n            \n            let errorMsg;\n            \n            if (e.message === 'Network Error') {\n                errorMsg = \"Error de Red. Verifica la URL de Render o la conexin del servidor.\";\n            } else if (e.response && (e.response.status === 401 || e.response.status === 403)) {\n                errorMsg = \"Sesin invlida o expirada. Saliendo...\";\n                signOut(); \n            } else if (e.response && e.response.status === 500) {\n                errorMsg = \"Error interno del servidor (500) al cargar listas. Base de datos inconsistente.\";\n            } else {\n                errorMsg = \"Error al cargar datos. Token invlido o backend.\";\n            }\n            \n            setDataError(errorMsg); \n        } finally {\n            setIsLoading(false);\n        }\n    };\n    \n    // ----------------------------------------------------------------\n    // FUNCIN: NAVEGAR A EDICIN DE DETALLES DEL ALUMNO\n    // ----------------------------------------------------------------\n    const handleEditStudent = (studentData) => {\n        navigation.navigate('StudentDetails', { student: studentData });\n    };\n\n    // ----------------------------------------------------------------\n    // FUNCIN: ACCIONES DEL MEN LATERAL (DRAWER) - USANDO ANIMATEOUT\n    // ----------------------------------------------------------------\n    const handleViewProfile = () => {\n        animateOut(() => Alert.alert(\"Mi Perfil\", \"Esta seccin navegar a tu pantalla de perfil (an no implementada).\"));\n    };\n\n    const handleChangePassword = () => {\n        animateOut(() => navigation.navigate('ChangePassword')); \n    };\n    \n    const handleAddStudent = () => {\n        animateOut(() => navigation.navigate('AddStudent')); \n    };\n\n    const handleLogout = () => {\n        Alert.alert(\n            \"Cerrar Sesin\",\n            \"Ests seguro de que quieres cerrar sesin?\",\n            [\n                { text: \"Cancelar\", style: \"cancel\" },\n                { text: \"Cerrar\", onPress: () => {\n                    animateOut(signOut); \n                }, style: \"destructive\" },\n            ]\n        );\n    };\n\n    useEffect(() => {\n        const unsubscribe = navigation.addListener('focus', fetchData);\n        fetchData();\n        return unsubscribe;\n    }, [navigation, isDark]);\n    \n    const handleAssignmentComplete = () => {\n        setSelectedStudent(null);\n        fetchData(); \n    };\n    \n    // Logica de filtrado de estudiantes\n    const filteredStudents = useMemo(() => {\n        if (!searchTerm) {\n            return students;\n        }\n        const lowerCaseSearch = searchTerm.toLowerCase();\n        return students.filter(student => \n            student.nombre.toLowerCase().includes(lowerCaseSearch) ||\n            student.email.toLowerCase().includes(lowerCaseSearch)\n        );\n    }, [students, searchTerm]);\n    \n    // --- VISTAS DE ESTADO ---\n    if (dataError && !isLoading && !selectedStudent && !creatingForStudent) {\n        return (\n             <SafeAreaView style={styles.container}>\n                 <View style={styles.errorView}>\n                     <Text style={styles.errorTitle}>!Error de Conexin!</Text>\n                     <Text style={styles.errorDetail}>{dataError}</Text>\n                     <View style={{marginTop: 20}}>\n                         <Button title=\"Intentar de Nuevo\" onPress={fetchData} color={themeColors.primary} />\n                     </View>\n                     {dataError !== \"Sesin invlida o expirada. Saliendo...\" && (\n                         <View style={{marginTop: 10}}>\n                             <Button title=\"Salir\" onPress={signOut} color={themeColors.danger} />\n                         </View>\n                     )}\n                 </View>\n             </SafeAreaView>\n           );\n         }\n\n    if (isLoading) {\n        return (\n            <SafeAreaView style={styles.loadingContainer}>\n                <ActivityIndicator size=\"large\" color={'#3ABFBC'} />\n                <Text style={{ color: themeColors.textSecondary, marginTop: 10 }}>Cargando panel de gestin...</Text>\n            </SafeAreaView>\n        );\n    }\n    \n    // Paso 1: Modo Wizard de Creacion de Rutina (Simplificado)\n    if (creatingForStudent) {\n        return (\n            <CreationWizardSimplified\n                navigation={navigation}\n                students={students}\n                onCancel={() => setCreatingForStudent(false)}\n            />\n        );\n    }\n\n    // Paso 2: Modo Gestionar Asignacion de Alumno existente\n    if (selectedStudent) {\n        return (\n            <SafeAreaView style={styles.container}>\n                <AssignmentView \n                    student={selectedStudent} \n                    routines={[]} \n                    onAssignmentComplete={handleAssignmentComplete} \n                    onCancel={() => setSelectedStudent(null)} \n                    navigation={navigation}\n                />\n            </SafeAreaView>\n        );\n    }\n    \n    // --- VISTA PRINCIPAL ---\n    return (\n        <SafeAreaView style={styles.container}>\n            {/* CABECERA ESTILIZADA CON ICONOS */}\n            <View style={styles.header}>\n                {/* Boton de Menu/Drawer (Izquierda) */}\n                <TouchableOpacity \n                    onPress={animateIn} \n                    style={styles.iconButton}\n                >\n                    <Menu size={22} color={themeColors.textPrimary} /> \n                </TouchableOpacity>\n\n                <Text style={styles.headerTitle}>Gestor de Alumnos</Text>\n                \n                {/* Boton de Actualizar (Derecha) */}\n                <TouchableOpacity \n                    onPress={fetchData} \n                    style={styles.iconButton}\n                    disabled={isLoading}\n                >\n                    <RefreshCcw size={22} color={'#3ABFBC'} />\n                </TouchableOpacity>\n            </View>\n            \n            {/* SCROLLVIEW PRINCIPAL */}\n            <ScrollView style={{ flex: 1 }}>\n                \n                {/* SECCIN DE ACCIONES/SALUDO (Mejora visual) */}\n                <View style={styles.actionSection}>\n                    <Text style={styles.subtitle}>\n                         Bienvenido/a Prof. {userProfile?.nombre?.split(' ')[0] || 'Profesor/a'}\n                    </Text>\n                    <Text style={{ fontSize: 14, color: themeColors.textSecondary }}>\n                        Utiliza el botn flotante (Pesas) para crear una nueva rutina y asignarla.\n                    </Text>\n                </View>\n\n                <Text style={styles.listTitle}>Alumnos Registrados ({filteredStudents.length})</Text> \n                \n                \n                {/* Input de busqueda */}\n                <TextInput\n                    style={styles.searchInput} \n                    placeholder=\"Buscar alumno por nombre o email...\"\n                    placeholderTextColor={themeColors.textSecondary}\n                    value={searchTerm}\n                    onChangeText={setSearchTerm}\n                />\n                \n                <ScrollView contentContainerStyle={{ paddingHorizontal: 20, paddingBottom: 80, paddingTop: 10 }}>\n                    {filteredStudents.length > 0 ? (\n                        filteredStudents.map((item) => (\n                            <View \n                                key={item.id.toString()}\n                                style={styles.studentCard}\n                            >\n                                <View>\n                                    <Text style={styles.studentName}>{item.nombre}</Text>\n                                    <Text style={styles.studentEmail}>{item.email}</Text>\n                                </View>\n                                \n                                {/* BOTONES DE ACCIN */}\n                                <View style={styles.studentCardActions}>\n                                    {/* Botn 1: Gestionar Rutina */}\n                                    <TouchableOpacity \n                                        style={[styles.actionButton, {backgroundColor: themeColors.warning}]}\n                                        onPress={() => setSelectedStudent(item)} // Va a AssignmentView\n                                    >\n                                        <Text style={styles.actionButtonText}>Rutina</Text>\n                                    </TouchableOpacity>\n\n                                    {/* Botn 2: Editar Datos */}\n                                    <TouchableOpacity \n                                        style={[styles.actionButton, {backgroundColor: '#3ABFBC'}]}\n                                        onPress={() => handleEditStudent(item)} // Va a la nueva pantalla de edicin\n                                    >\n                                        <Text style={styles.actionButtonText}>Editar</Text>\n                                    </TouchableOpacity>\n                                </View>\n                                \n                            </View>\n                        ))\n                    ) : (\n                        <View style={{ padding: 20, alignItems: 'center' }}>\n                            <Text style={{ color: themeColors.textSecondary }}>No hay alumnos registrados que coincidan con la busqueda.</Text>\n                        </View>\n                    )}\n                </ScrollView>\n            </ScrollView>\n            \n            {/* BOTN DE ACCIN FLOTANTE (FAB) CON ICONO DE PESAS */}\n            <TouchableOpacity \n                style={styles.fab} \n                onPress={() => setCreatingForStudent(true)}\n            >\n                <Weight size={30} color={'black'} style={styles.fabIcon} />\n            </TouchableOpacity>\n\n            {/* MODAL DE OPCIONES (DRAWER LATERAL IZQUIERDO CON ANIMACIN) */}\n            <Modal \n                animationType=\"none\" \n                transparent={true}\n                visible={isMenuVisible}\n                onRequestClose={() => animateOut()} \n            >\n                {/* Overlay transparente que se cierra al tocar fuera */}\n                <TouchableOpacity \n                    style={styles.modalOverlay} \n                    activeOpacity={1} \n                    onPressOut={() => animateOut()} \n                >\n                    {/* DRAWER CONTENT (Animated.View para el deslizamiento) */}\n                    <Animated.View \n                        style={[\n                            styles.menuContainer, \n                            { transform: [{ translateX: menuAnim }] } \n                        ]}\n                        onStartShouldSetResponder={() => true} \n                    >\n                        \n                        <SafeAreaView style={{ flex: 1 }}> \n                            \n                            <ScrollView contentContainerStyle={{ paddingBottom: 70 }}>\n                                <Text style={styles.menuTitle}>Men Profesor</Text>\n\n                                <TouchableOpacity \n                                    style={styles.menuItem} \n                                    onPress={handleViewProfile}\n                                >\n                                    <User size={18} color={themeColors.textPrimary} /> \n                                    <Text style={styles.menuItemText}>Mi Perfil</Text>\n                                </TouchableOpacity>\n\n                                <TouchableOpacity \n                                    style={styles.menuItem} \n                                    onPress={handleChangePassword}\n                                >\n                                    <Key size={18} color={themeColors.textPrimary} /> \n                                    <Text style={styles.menuItemText}>Cambiar Contrasea</Text>\n                                </TouchableOpacity>\n                                \n                                <TouchableOpacity \n                                    style={styles.menuItem} \n                                    onPress={handleAddStudent}\n                                >\n                                    <UserPlus size={18} color={themeColors.success} /> \n                                    <Text style={[styles.menuItemText, {color: themeColors.success}]}>Registrar Nuevo Alumno</Text>\n                                </TouchableOpacity>\n\n                                <TouchableOpacity \n                                    style={[styles.menuItem, {borderBottomWidth: 0}]} \n                                    onPress={handleLogout}\n                                >\n                                    <LogOut size={18} color={themeColors.danger} />\n                                    <Text style={styles.menuItemTextLogout}>Cerrar Sesin</Text>\n                                </TouchableOpacity>\n                            </ScrollView>\n                        </SafeAreaView>\n                        \n                         {/* Botn de cierre visible dentro del men */}\n                         <TouchableOpacity \n                            style={styles.menuItemClose}\n                            onPress={() => animateOut()}\n                        >\n                            <Text style={styles.menuItemTextClose}>Cerrar Men</Text>\n                        </TouchableOpacity>\n                    </Animated.View>\n                </TouchableOpacity>\n            </Modal>\n        </SafeAreaView>\n    );\n}","import React, { useState, useContext } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, TextInput, Button, SafeAreaView, \r\n    ScrollView, ActivityIndicator, TouchableOpacity, Modal, Alert,\r\n    KeyboardAvoidingView, Platform, \r\n    ImageBackground, Image \r\n} from 'react-native';\r\nimport axios from 'axios';\r\nimport { AuthContext } from '../App'; \r\nimport { useTheme } from '../ThemeContext'; \r\n\r\n// ----------------------------------------------------------------------\r\n// URIs de Imagenes del Gimnasio\r\n// ----------------------------------------------------------------------\r\nconst LOGO_SOURCE = require('../assets/logoND.png'); \r\nconst BACKGROUND_SOURCE = require('../assets/wallpaper.jpg'); \r\n\r\n// ----------------------------------------------------------------------\r\n// Componente de Registro de Alumno (Modal) - SE MANTIENE IGUAL\r\n// ----------------------------------------------------------------------\r\nfunction RegisterModal({ isVisible, onClose, API_URL, themeColors }) {\r\n    const [nombre, setNombre] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [dni, setDni] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    const [success, setSuccess] = useState(false);\r\n\r\n    const styles = getStyles(themeColors); \r\n\r\n    const handleRegister = async () => {\r\n        if (!nombre || !email || !dni || !password) {\r\n            setError(\"Todos los campos son obligatorios.\");\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError(null);\r\n        setSuccess(false);\r\n\r\n        try {\r\n            await axios.post(`${API_URL}/register/student`, {\r\n                nombre, email, dni, password,\r\n                rol: \"Alumno\" \r\n            });\r\n\r\n            setSuccess(true);\r\n            setNombre(''); setEmail(''); setDni(''); setPassword('');\r\n            \r\n        } catch (e) {\r\n            console.error(\"Error en el registro:\", e.response ? e.response.data : e.message);\r\n            const detail = e.response?.data?.detail;\r\n            let msg = detail && typeof detail === 'string' ? detail : \"Fallo desconocido en el servidor.\";\r\n\r\n            if (msg.includes(\"DNI ya esta registrado\")) {\r\n                msg = \"El DNI proporcionado ya se encuentra registrado.\";\r\n            } else if (msg.includes(\"El email ya esta registrado\")) {\r\n                msg = \"El Email proporcionado ya se encuentra registrado.\";\r\n            } else if (e.message === 'Network Error') {\r\n                msg = `Error de Conexion. Asegurate de que el servidor de FastAPI y Ngrok estan activos y que la URL (${API_URL}) es la correcta.`;\r\n            }\r\n\r\n            setError(`Error en el registro: ${msg}`);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Modal\r\n            animationType=\"slide\"\r\n            transparent={false}\r\n            visible={isVisible}\r\n            onRequestClose={onClose}\r\n        >\r\n            <SafeAreaView style={[styles.modalContainer, {backgroundColor: 'black'}]}>\r\n                <ScrollView contentContainerStyle={styles.modalContent}>\r\n                    <Text style={[styles.modalTitle, {color: 'white'}]}>Registro de Alumno</Text>\r\n                    \r\n                    {error && <Text style={[styles.errorText, {color: 'white', backgroundColor: '#B91C1CAB'}]}>{error}</Text>}\r\n                    {success && <Text style={[styles.successText, {color: '#3ABFBC'}]}>Registro exitoso! Ya puedes ingresar con tu DNI y contrasea.</Text>}\r\n\r\n                    <TextInput\r\n                        style={[styles.input, {\r\n                            backgroundColor: '#1C1C1E', \r\n                            color: 'white',\r\n                            borderColor: '#1C1C1E',\r\n                        }]}\r\n                        placeholder=\"Nombre completo\"\r\n                        placeholderTextColor={'#A9A9A9'}\r\n                        value={nombre}\r\n                        onChangeText={setNombre}\r\n                    />\r\n                    <TextInput\r\n                        style={[styles.input, {\r\n                            backgroundColor: '#1C1C1E', \r\n                            color: 'white',\r\n                            borderColor: '#1C1C1E',\r\n                        }]}\r\n                        placeholder=\"Email\"\r\n                        placeholderTextColor={'#A9A9A9'}\r\n                        value={email}\r\n                        onChangeText={setEmail}\r\n                        keyboardType=\"email-address\"\r\n                        autoCapitalize=\"none\"\r\n                    />\r\n                    <TextInput\r\n                        style={[styles.input, {\r\n                            backgroundColor: '#1C1C1E', \r\n                            color: 'white',\r\n                            borderColor: '#1C1C1E',\r\n                        }]}\r\n                        placeholder=\"Numero de Documento (DNI)\"\r\n                        placeholderTextColor={'#A9A9A9'}\r\n                        value={dni}\r\n                        onChangeText={setDni}\r\n                        keyboardType=\"numeric\"\r\n                    />\r\n                    <TextInput\r\n                        style={[styles.input, {\r\n                            backgroundColor: '#1C1C1E', \r\n                            color: 'white',\r\n                            borderColor: '#1C1C1E',\r\n                        }]}\r\n                        placeholder=\"Contrasea\"\r\n                        placeholderTextColor={'#A9A9A9'}\r\n                        value={password}\r\n                        onChangeText={setPassword}\r\n                        secureTextEntry \r\n                    />\r\n                    \r\n                    <TouchableOpacity\r\n                        style={[styles.customButton, styles.buttonSuccess, { opacity: isLoading ? 0.6 : 1, marginTop: 30 }]}\r\n                        onPress={handleRegister}\r\n                        disabled={isLoading}\r\n                    >\r\n                        {isLoading ? (\r\n                            <ActivityIndicator size=\"small\" color={'black'} />\r\n                        ) : (\r\n                            <Text style={styles.buttonText}>REGISTRARSE</Text>\r\n                        )}\r\n                    </TouchableOpacity>\r\n                    \r\n                    <View style={{marginTop: 20}}>\r\n                        <TouchableOpacity\r\n                            style={[styles.customButton, styles.buttonSecondary, {marginTop: 0}]}\r\n                            onPress={onClose}\r\n                        >\r\n                            <Text style={styles.buttonTextSecondary}>VOLVER A INGRESAR</Text>\r\n                        </TouchableOpacity>\r\n                    </View>\r\n                </ScrollView>\r\n            </SafeAreaView>\r\n        </Modal>\r\n    );\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// Funcion de Login Personalizada (Estilo PEAKFIT final)\r\n// ----------------------------------------------------------------------\r\nexport default function CustomLoginScreen({ signIn, API_URL }) {\r\n    const { colors: themeColors, isDark, toggleTheme } = useTheme(); \r\n\r\n    const [dni, setDni] = useState(''); \r\n    const [password, setPassword] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    \r\n    //  CORRECCIN: Eliminamos el uso innecesario de AuthContext en el login:\r\n    // const { getToken } = useContext(AuthContext); // Esta lnea fue eliminada\r\n    \r\n    // NOTA: Para que el login funcione en un proyecto React Native, \r\n    // debes asegurarte de que AuthContext est disponible y configurado\r\n    // correctamente en el componente principal (App.js) que envuelve a este componente.\r\n\r\n    const handleLogin = async () => {\r\n        if (!dni || !password) {\r\n            setError(\"Por favor, ingresa DNI y contrasea.\");\r\n            return;\r\n        }\r\n        \r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const response = await axios.post(`${API_URL}/login`, {\r\n                dni: dni, \r\n                password: password\r\n            });\r\n\r\n            const token = response.data.access_token;\r\n            // La funcin signIn debe manejar el guardado del token y la navegacin\r\n            await signIn(token); \r\n\r\n        } catch (e) {\r\n            console.error(\"Error de Login:\", e.response ? e.response.data : e.message);\r\n            \r\n            let errorMessage = \"DNI o contrasea incorrectos.\";\r\n            if (e.message === 'Network Error') {\r\n                errorMessage = `Error de Conexion. Asegurate de que el servidor de FastAPI y Ngrok estan activos y que la URL (${API_URL}) es la correcta.`;\r\n            } else if (e.response && e.response.status !== 401) {\r\n                errorMessage = `Error del Servidor (${e.response.status}). Intenta mas tarde.`;\r\n            }\r\n            \r\n            setError(errorMessage);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n    \r\n    const styles = getStyles(themeColors);\r\n\r\n    const [isRegisterVisible, setIsRegisterVisible] = useState(false); \r\n\r\n    return (\r\n        //  CORRECCIN DE IMAGEN: Verificacin para evitar TypeError en web\r\n        <ImageBackground \r\n            source={BACKGROUND_SOURCE ? BACKGROUND_SOURCE : null} \r\n            style={styles.backgroundImagePeakfit}\r\n            imageStyle={styles.backgroundImageStylePeakfit} \r\n        >\r\n            <SafeAreaView style={{ flex: 1, backgroundColor: 'rgba(0,0,0,0.6)' }}> \r\n                <KeyboardAvoidingView \r\n                    style={{ flex: 1 }} \r\n                    behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                >\r\n                \r\n                    <RegisterModal \r\n                        isVisible={isRegisterVisible} \r\n                        onClose={() => setIsRegisterVisible(false)} \r\n                        API_URL={API_URL} \r\n                        themeColors={themeColors}\r\n                    />\r\n\r\n                    <ScrollView contentContainerStyle={styles.contentLogin}>\r\n                        \r\n                        <View style={styles.headerPeakfit}>\r\n                            {/* Logo */}\r\n                            {/*  CORRECCIN DE IMAGEN: Renderizado condicional */}\r\n                            {LOGO_SOURCE && (\r\n                                <Image source={LOGO_SOURCE} style={styles.logoImagePeakfit} />\r\n                            )}\r\n                            {/* Lema */}\r\n                            <Text style={styles.sloganText}>Es hora de llegar muy lejos</Text>\r\n                        </View>\r\n\r\n                        {/* Ttulo en espaol */}\r\n                        <Text style={styles.titlePeakfit}>Iniciar Sesin</Text>\r\n                        \r\n                        {error && <Text style={styles.errorText}>{error}</Text>}\r\n                        \r\n                        {/* INPUT: Email o DNI */}\r\n                        <Text style={styles.inputLabelPeakfit}>Email o DNI</Text>\r\n                        <TextInput\r\n                            style={[styles.inputPeakfit, {\r\n                                backgroundColor: '#1C1C1E', \r\n                                color: 'white',\r\n                            }]}\r\n                            placeholder=\"Email o DNI\"\r\n                            placeholderTextColor={'#A9A9A9'}\r\n                            value={dni} \r\n                            onChangeText={setDni}\r\n                            keyboardType=\"email-address\"\r\n                            autoCapitalize=\"none\"\r\n                        />\r\n                        \r\n                        {/* INPUT: Contrasea */}\r\n                        <Text style={styles.inputLabelPeakfit}>Contrasea</Text>\r\n                        <View style={styles.passwordContainerPeakfit}>\r\n                            <TextInput\r\n                                style={[styles.inputPeakfit, styles.passwordInputPeakfit, {\r\n                                    backgroundColor: '#1C1C1E', \r\n                                    color: 'white',\r\n                                }]}\r\n                                placeholder=\"Contrasea\"\r\n                                placeholderTextColor={'#A9A9A9'}\r\n                                value={password}\r\n                                onChangeText={setPassword}\r\n                                secureTextEntry\r\n                            />\r\n                            <Text style={styles.passwordIconPeakfit}></Text>\r\n                        </View>\r\n\r\n                        {/*  ELIMINAMOS: utilityRowPeakfit (Mantener sesin y Olvidaste contrasea) */}\r\n                        \r\n                        {isLoading ? (\r\n                            <ActivityIndicator size=\"large\" color={'#3ABFBC'} style={{marginTop: 25}}/>\r\n                        ) : (\r\n                            <>\r\n                                {/* BOTN INICIAR SESIN */}\r\n                                <TouchableOpacity\r\n                                    style={[styles.customButtonPeakfit, styles.buttonPrimaryPeakfit, {marginTop: 30}]}\r\n                                    onPress={handleLogin}\r\n                                >\r\n                                    <Text style={styles.buttonTextPeakfit}>INICIAR SESIN</Text>\r\n                                </TouchableOpacity>\r\n                            </>\r\n                        )}\r\n                        \r\n                        {/* Enlace de registro (Sign Up) */}\r\n                        <View style={styles.signUpContainerPeakfit}>\r\n                            <Text style={styles.signUpTextPeakfit}>No tienes una cuenta? </Text>\r\n                            <TouchableOpacity onPress={() => setIsRegisterVisible(true)}>\r\n                                <Text style={styles.signUpLinkPeakfit}>Registrarse</Text>\r\n                            </TouchableOpacity>\r\n                        </View>\r\n\r\n                    </ScrollView>\r\n                </KeyboardAvoidingView>\r\n            </SafeAreaView>\r\n        </ImageBackground>\r\n    );\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// Funcion que genera los estilos del nuevo diseo \"Peakfit\"\r\n// ----------------------------------------------------------------------\r\nconst getStyles = (colors) => StyleSheet.create({\r\n    // -------------------------------------------------------------------\r\n    // ESTILOS BASE PEAKFIT \r\n    // -------------------------------------------------------------------\r\n    backgroundImagePeakfit: {\r\n        flex: 1,\r\n    },\r\n    backgroundImageStylePeakfit: {\r\n        opacity: 0.4, \r\n    },\r\n    contentLogin: {\r\n        paddingHorizontal: 25,\r\n        paddingVertical: 50, \r\n        flexGrow: 1,\r\n        justifyContent: 'center',\r\n    },\r\n\r\n    // Logo y Encabezado\r\n    headerPeakfit: {\r\n        alignItems: 'center',\r\n        marginBottom: 20,\r\n    },\r\n    logoImagePeakfit: {\r\n        width: 200, \r\n        height: 200, \r\n        resizeMode: 'contain',\r\n    },\r\n    sloganText: {\r\n        fontSize: 14,\r\n        color: '#A9A9A9',\r\n        fontStyle: 'italic',\r\n        marginTop: -20, \r\n        marginBottom: 20,\r\n    },\r\n    \r\n    // Ttulos y Subttulos\r\n    titlePeakfit: {\r\n        fontSize: 30,\r\n        fontWeight: 'bold',\r\n        color: 'white',\r\n        marginBottom: 15, \r\n    },\r\n\r\n    // Inputs\r\n    inputLabelPeakfit: {\r\n        fontSize: 14,\r\n        color: '#A9A9A9',\r\n        marginBottom: 8,\r\n    },\r\n    inputPeakfit: {\r\n        height: 50,\r\n        backgroundColor: '#1C1C1E', \r\n        color: 'white',\r\n        borderRadius: 10,\r\n        paddingHorizontal: 15,\r\n        marginBottom: 20,\r\n        fontSize: 16,\r\n        borderWidth: 0, \r\n    },\r\n\r\n    // Password con Icono \r\n    passwordContainerPeakfit: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        //  CAMBIO: Se ajusta el margen inferior para alinearse con el diseo sin utilityRow\r\n        marginBottom: 0, \r\n    },\r\n    passwordInputPeakfit: {\r\n        flex: 1,\r\n        marginBottom: 0,\r\n    },\r\n    passwordIconPeakfit: {\r\n        position: 'absolute',\r\n        right: 15,\r\n        color: '#A9A9A9',\r\n        fontSize: 18,\r\n    },\r\n\r\n    //  ELIMINAMOS: utilityRowPeakfit, checkboxContainerPeakfit, checkboxPeakfit, checkboxTextPeakfit, forgotPasswordPeakfit.\r\n\r\n    // Botones Principales\r\n    customButtonPeakfit: {\r\n        paddingVertical: 15,\r\n        borderRadius: 10,\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        shadowColor: '#3ABFBC',\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.3,\r\n        shadowRadius: 5,\r\n        elevation: 8,\r\n    },\r\n    buttonPrimaryPeakfit: {\r\n        backgroundColor: '#3ABFBC', \r\n    },\r\n    buttonTextPeakfit: {\r\n        fontSize: 18,\r\n        fontWeight: 'bold',\r\n        color: 'black', \r\n    },\r\n\r\n    // Enlace de Registro (Sign Up)\r\n    signUpContainerPeakfit: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'center',\r\n        marginTop: 40, \r\n    },\r\n    signUpTextPeakfit: {\r\n        color: '#A9A9A9',\r\n        fontSize: 14,\r\n    },\r\n    signUpLinkPeakfit: {\r\n        color: '#3ABFBC', \r\n        fontSize: 14,\r\n        fontWeight: 'bold',\r\n    },\r\n    \r\n    // Estilo de error modificado\r\n    errorText: {\r\n        marginBottom: 15,\r\n        textAlign: 'center',\r\n        padding: 10,\r\n        borderRadius: 8,\r\n        fontWeight: '600',\r\n        color: 'white', \r\n        backgroundColor: '#B91C1CAB', \r\n    },\r\n\r\n    // -------------------------------------------------------------------\r\n    // ESTILOS DEL MODAL DE REGISTRO\r\n    // -------------------------------------------------------------------\r\n    modalContainer: {\r\n        flex: 1,\r\n        paddingTop: 40,\r\n        backgroundColor: 'black', \r\n    },\r\n    modalContent: {\r\n        padding: 30,\r\n        flexGrow: 1,\r\n        justifyContent: 'center',\r\n    },\r\n    modalTitle: {\r\n        fontSize: 28,\r\n        fontWeight: 'bold',\r\n        textAlign: 'center',\r\n        marginBottom: 30,\r\n        color: 'white', \r\n    },\r\n    input: { \r\n        height: 50,\r\n        backgroundColor: '#1C1C1E', \r\n        color: 'white',\r\n        borderRadius: 10,\r\n        paddingHorizontal: 15,\r\n        marginBottom: 20,\r\n        fontSize: 16,\r\n        borderWidth: 0,\r\n    },\r\n    customButton: { \r\n        paddingVertical: 14,\r\n        paddingHorizontal: 20,\r\n        borderRadius: 10, \r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        minWidth: 100,\r\n        marginTop: 15,\r\n    },\r\n    buttonSuccess: {\r\n        backgroundColor: '#3ABFBC', \r\n    },\r\n    buttonSecondary: {\r\n        backgroundColor: '#1C1C1E', \r\n        borderColor: '#A9A9A9',\r\n        borderWidth: 1,\r\n    },\r\n    buttonText: { \r\n        fontSize: 16,\r\n        fontWeight: 'bold',\r\n        color: 'black', \r\n    },\r\n    buttonTextSecondary: { \r\n        fontSize: 16,\r\n        fontWeight: 'bold',\r\n        color: 'white', \r\n    },\r\n    successText: {\r\n        marginBottom: 15,\r\n        textAlign: 'center',\r\n        fontWeight: 'bold',\r\n        color: '#3ABFBC',\r\n    }\r\n});","import React, { useState, useEffect, useContext, useCallback } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, TextInput, Button, SafeAreaView, \r\n    ScrollView, TouchableOpacity, Alert, KeyboardAvoidingView, Platform, ActivityIndicator\r\n} from 'react-native';\r\nimport { useRoute } from '@react-navigation/native';\r\nimport axios from 'axios';\r\nimport { AuthContext } from '../App'; \r\nimport { useTheme } from '../ThemeContext'; \r\nimport { Save, XCircle, PlusCircle, Trash2, Search, Zap, Loader } from 'lucide-react-native';\r\n\r\n// ----------------------------------------------------------------------\r\n// API Configuration\r\n// ----------------------------------------------------------------------\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n\r\n// ----------------------------------------------------------------------\r\n// Dynamic Exercise Styles Generator - ESTILO PEAKFIT\r\n// ----------------------------------------------------------------------\r\nconst getExerciseStyles = (colors) => StyleSheet.create({\r\n    card: {\r\n        backgroundColor: '#1C1C1E', // PEAKFIT Card Dark Gray\r\n        borderRadius: 10, \r\n        padding: 15,\r\n        marginBottom: 15,\r\n        borderLeftWidth: 5,\r\n        borderLeftColor: '#3ABFBC', // PEAKFIT Accent Green\r\n        elevation: 4,\r\n        shadowColor: '#000',\r\n        shadowOffset: { width: 0, height: 2 },\r\n        shadowOpacity: 0.8,\r\n        shadowRadius: 5,\r\n    },\r\n    header: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        marginBottom: 10,\r\n    },\r\n    title: {\r\n        fontSize: 16,\r\n        fontWeight: '700',\r\n        color: 'white', // PEAKFIT Text White\r\n        opacity: 1, \r\n    },\r\n    deleteButton: {\r\n        padding: 5,\r\n    },\r\n    selectButton: {\r\n        backgroundColor: '#1C1C1E', // Base color dark gray \r\n        borderRadius: 8,\r\n        paddingHorizontal: 15,\r\n        paddingVertical: 12,\r\n        marginBottom: 15,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'flex-start',\r\n        borderWidth: 1,\r\n        borderColor: colors.divider, // Borde sutil\r\n    },\r\n    selectButtonText: {\r\n        color: 'white', // PEAKFIT Text White\r\n        fontSize: 17,\r\n        fontWeight: '600',\r\n        marginLeft: 10,\r\n        flexShrink: 1,\r\n    },\r\n    row: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        marginTop: 5,\r\n    },\r\n    compactLabel: {\r\n        fontSize: 12,\r\n        color: '#A9A9A9', // PEAKFIT Secondary Text Gray\r\n        marginBottom: 3,\r\n        fontWeight: 'bold',\r\n        textAlign: 'center',\r\n        textTransform: 'uppercase',\r\n    },\r\n    inputGroup: {\r\n        width: '31%', \r\n        alignItems: 'center',\r\n    },\r\n    input: {\r\n        height: 40,\r\n        backgroundColor: 'black', // PEAKFIT Darker Input\r\n        borderColor: colors.divider, \r\n        borderWidth: 1,\r\n        borderRadius: 8,\r\n        paddingHorizontal: 5,\r\n        fontSize: 14,\r\n        color: 'white', // PEAKFIT Text White\r\n        textAlign: 'center',\r\n        width: '100%',\r\n    },\r\n});\r\n\r\n// ----------------------------------------------------------------------\r\n// Exercise Item Component\r\n// ----------------------------------------------------------------------\r\nconst ExerciseItem = ({ index, exercise, updateExercise, removeExercise, toggleSelector, themeColors }) => {\r\n    \r\n    const exerciseStyles = getExerciseStyles(themeColors);\r\n\r\n    const handleChange = (field, value) => {\r\n        updateExercise(index, field, value);\r\n    };\r\n\r\n    const placeholderColor = '#A9A9A9';\r\n\r\n    // Determina el color del botn de seleccin (verde si est seleccionado, rojo si no)\r\n    const buttonColor = exercise.exercise_id ? '#3ABFBC' : themeColors.danger;\r\n    \r\n    // Fondo ms oscuro para el botn si est seleccionado, o usa el color de la tarjeta\r\n    const buttonBgColor = exercise.exercise_id ? '#1C1C1E' : '#1C1C1E'; \r\n    // El indicador visual es el color del texto/icono, no el fondo.\r\n\r\n\r\n    return (\r\n        <View style={exerciseStyles.card}>\r\n            <View style={exerciseStyles.header}>\r\n                <Text style={exerciseStyles.title}>Ejercicio #{index + 1}</Text>\r\n                <TouchableOpacity \r\n                    onPress={() => removeExercise(index)} \r\n                    style={exerciseStyles.deleteButton}\r\n                >\r\n                    <Trash2 size={20} color={themeColors.danger} />\r\n                </TouchableOpacity>\r\n            </View>\r\n\r\n            {/* Button/Display of Selected Exercise */}\r\n            <TouchableOpacity \r\n                style={[\r\n                    exerciseStyles.selectButton, \r\n                    {backgroundColor: buttonBgColor}\r\n                ]} \r\n                onPress={() => toggleSelector(index)} \r\n            >\r\n                {/* Icono usa el color determinado (verde/rojo) */}\r\n                <Zap size={20} color={buttonColor} /> \r\n                <Text \r\n                    style={[\r\n                        exerciseStyles.selectButtonText, \r\n                        // El texto es rojo si no est seleccionado\r\n                        !exercise.exercise_id && {color: themeColors.danger} \r\n                    ]}\r\n                    numberOfLines={1}\r\n                    ellipsizeMode=\"tail\" \r\n                >\r\n                    {exercise.name || \"Toca para Seleccionar Ejercicio\"}\r\n                </Text>\r\n            </TouchableOpacity>\r\n            \r\n            {/* Compact Input Row */}\r\n            <View style={exerciseStyles.row}>\r\n                {/* 1. Series Input */}\r\n                <View style={exerciseStyles.inputGroup}>\r\n                    <Text style={exerciseStyles.compactLabel}>Series</Text>\r\n                    <TextInput\r\n                        style={exerciseStyles.input}\r\n                        placeholder=\"3\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        keyboardType=\"numeric\"\r\n                        value={exercise.series}\r\n                        onChangeText={(text) => handleChange('series', text)}\r\n                    />\r\n                </View>\r\n\r\n                {/* 2. Repetitions Input */}\r\n                <View style={exerciseStyles.inputGroup}>\r\n                    <Text style={exerciseStyles.compactLabel}>Repeticiones</Text>\r\n                    <TextInput\r\n                        style={exerciseStyles.input}\r\n                        placeholder=\"10-12\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        keyboardType=\"default\" \r\n                        value={exercise.repetitions}\r\n                        onChangeText={(text) => handleChange('repetitions', text)}\r\n                    />\r\n                </View>\r\n\r\n                {/* 3. Weight Input */}\r\n                <View style={exerciseStyles.inputGroup}>\r\n                    <Text style={exerciseStyles.compactLabel}>Peso</Text>\r\n                    <TextInput\r\n                        style={exerciseStyles.input}\r\n                        placeholder=\"20 kg\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        keyboardType=\"default\" \r\n                        value={exercise.peso}\r\n                        onChangeText={(text) => handleChange('peso', text)}\r\n                    />\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\n// ----------------------------------------------------------------------\r\n// Dynamic Screen Styles Generator - ESTILO PEAKFIT\r\n// ----------------------------------------------------------------------\r\nconst getStyles = (colors) => StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: 'black', //  PEAKFIT: Fondo Negro\r\n    },\r\n    loadingContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        backgroundColor: 'black', //  PEAKFIT: Fondo Negro\r\n    },\r\n    content: {\r\n        padding: 20,\r\n        paddingBottom: 100, \r\n    },\r\n    subHeader: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between', \r\n        alignItems: 'center',\r\n        paddingHorizontal: 20,\r\n        paddingVertical: 10,\r\n        backgroundColor: 'black', //  PEAKFIT: Header Negro\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n    },\r\n    actionButton: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        paddingVertical: 10,\r\n        paddingHorizontal: 15,\r\n        borderRadius: 10, // Ms redondeado\r\n        justifyContent: 'center',\r\n        width: '48%',\r\n    },\r\n    selectorActionButton: { \r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        backgroundColor: '#3ABFBC', //  PEAKFIT: Verde Brillante\r\n        borderRadius: 10,\r\n        paddingVertical: 10,\r\n        marginHorizontal: 20,\r\n        marginTop: 10,\r\n        marginBottom: 15,\r\n    },\r\n    actionButtonText: {\r\n        color: 'black', //  PEAKFIT: Texto Negro en botones de accin\r\n        fontWeight: 'bold',\r\n        marginLeft: 8,\r\n        fontSize: 14,\r\n    },\r\n    cancelButton: {\r\n        backgroundColor: colors.danger, // Mantenemos el color de peligro\r\n    },\r\n    label: {\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        marginBottom: 5,\r\n        marginTop: 15,\r\n    },\r\n    input: {\r\n        height: 50,\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Input Dark Gray\r\n        borderColor: colors.divider,\r\n        borderWidth: 1,\r\n        borderRadius: 10, // Ms redondeado\r\n        paddingHorizontal: 15,\r\n        fontSize: 16,\r\n        marginBottom: 15,\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n    },\r\n    textArea: {\r\n        height: 80,\r\n        textAlignVertical: 'top',\r\n        paddingTop: 10,\r\n    },\r\n    sectionTitle: {\r\n        fontSize: 20,\r\n        fontWeight: 'bold',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        marginTop: 25,\r\n        marginBottom: 15,\r\n    },\r\n    floatingButton: {\r\n        position: 'absolute',\r\n        bottom: 20,\r\n        right: 20,\r\n        backgroundColor: '#3ABFBC', //  PEAKFIT: Verde Brillante\r\n        padding: 15,\r\n        borderRadius: 30,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        elevation: 8,\r\n        shadowColor: '#3ABFBC', // Sombra Verde\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.8,\r\n        shadowRadius: 5,\r\n    },\r\n    floatingButtonText: {\r\n        color: 'black', //  PEAKFIT: Texto Negro\r\n        fontWeight: 'bold',\r\n        marginLeft: 8,\r\n        fontSize: 16,\r\n    },\r\n    selectorContainer: {\r\n        flex: 1,\r\n        backgroundColor: 'black', //  PEAKFIT: Fondo Negro\r\n        paddingTop: Platform.OS === 'android' ? 40 : 0, \r\n    },\r\n    selectorHeader: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        padding: 15,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n        backgroundColor: 'black', //  PEAKFIT: Header Negro\r\n    },\r\n    selectorTitle: {\r\n        fontSize: 20,\r\n        fontWeight: 'bold',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        flex: 1, \r\n        textAlign: 'center',\r\n    },\r\n    selectorSearchInput: {\r\n        height: 45,\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Input Dark Gray\r\n        borderColor: colors.divider,\r\n        borderWidth: 1,\r\n        borderRadius: 10,\r\n        paddingHorizontal: 15,\r\n        marginHorizontal: 20,\r\n        marginTop: 10,\r\n        marginBottom: 15,\r\n        fontSize: 16,\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n    },\r\n    selectorList: {\r\n        paddingHorizontal: 0, \r\n        paddingVertical: 10,\r\n    },\r\n    selectorItem: {\r\n        paddingVertical: 15,\r\n        paddingHorizontal: 20, \r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        backgroundColor: 'black', \r\n    },\r\n    selectorItemName: {\r\n        fontSize: 17,\r\n        fontWeight: '600',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        flexShrink: 1, \r\n    },\r\n    selectorItemGroup: {\r\n        fontSize: 14,\r\n        color: '#A9A9A9', //  PEAKFIT: Secondary Text Gray\r\n        marginLeft: 10,\r\n    },\r\n    closeSelectorButton: {\r\n        padding: 5,\r\n    },\r\n    screenHeader: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'center', \r\n        paddingHorizontal: 20,\r\n        paddingVertical: 10,\r\n        backgroundColor: 'black', //  PEAKFIT: Header Negro\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n    },\r\n    screenTitle: {\r\n        fontSize: 18, \r\n        fontWeight: 'bold',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        textAlign: 'center',\r\n    },\r\n    addExerciseButtonText: {\r\n        color: 'black',\r\n        fontWeight: 'bold',\r\n        marginLeft: 8,\r\n        fontSize: 16,\r\n    }\r\n});\r\n\r\n// ----------------------------------------------------------------------\r\n// Main Routine Creation / Edition Screen\r\n// ----------------------------------------------------------------------\r\nexport default function RoutineCreationScreenV3({ navigation }) {\r\n    \r\n    const { colors: themeColors } = useTheme();\r\n    const styles = getStyles(themeColors);\r\n\r\n    // Route parameters\r\n    const route = useRoute();\r\n    const { studentId, studentName, routineId, routineMetadata } = route.params || {};\r\n    \r\n    const isEditMode = !!routineId; \r\n    \r\n    // State for multi-day routine management\r\n    const totalDays = isEditMode ? 1 : (routineMetadata?.days || 1);\r\n    const baseName = isEditMode ? '' : (routineMetadata?.nombre || 'Nueva Rutina');\r\n\r\n    const [currentDay, setCurrentDay] = useState(1);\r\n    \r\n    // Stores data for all N routines\r\n    const [allRoutinesData, setAllRoutinesData] = useState(() => \r\n        isEditMode ? [] : Array.from({ length: totalDays }, (_, i) => ({\r\n            day: i + 1,\r\n            name: `${baseName} - Da ${i + 1}`,\r\n            description: '', \r\n            exercises: [],\r\n        }))\r\n    );\r\n\r\n    // Current routine data for UI\r\n    const currentRoutine = allRoutinesData[currentDay - 1] || { exercises: [], name: '', description: '' };\r\n    \r\n    // UI and data states\r\n    const [availableExercises, setAvailableExercises] = useState([]); \r\n    const [isExerciseSelectorOpen, setIsExerciseSelectorOpen] = useState(false); \r\n    const [currentExerciseIndex, setCurrentExerciseIndex] = useState(null);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n\r\n    // Loading/Error states\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [fetchError, setFetchError] = useState(null);\r\n    \r\n    const { getToken } = useContext(AuthContext);\r\n\r\n    // ------------------------------------------------------------------\r\n    // Helper Functions\r\n    // ------------------------------------------------------------------\r\n    \r\n    const setRoutineData = (field, value) => {\r\n        setAllRoutinesData(prev => {\r\n            const newRoutines = [...prev];\r\n            if (newRoutines[currentDay - 1]) {\r\n                newRoutines[currentDay - 1][field] = value;\r\n            }\r\n            return newRoutines;\r\n        });\r\n    };\r\n\r\n    const updateExercise = (index, field, value) => {\r\n        setAllRoutinesData(prev => {\r\n            const newRoutines = [...prev];\r\n            const currentExercises = [...(newRoutines[currentDay - 1]?.exercises || [])];\r\n            \r\n            if (currentExercises[index]) {\r\n                currentExercises[index] = { ...currentExercises[index], [field]: value };\r\n            }\r\n            \r\n            if (newRoutines[currentDay - 1]) {\r\n                // En modo edicin (newRoutines.length es 1) o creacin, esto siempre apunta al da correcto\r\n                newRoutines[currentDay - 1].exercises = currentExercises; \r\n            }\r\n            return newRoutines;\r\n        });\r\n    };\r\n    \r\n    // Funcin de carga de ejercicios (Ahora envuelta en useCallback)\r\n    const fetchExercises = useCallback(async () => {\r\n        setIsLoading(true);\r\n        setFetchError(null);\r\n        try {\r\n            const token = await getToken();\r\n            const headers = { 'Authorization': `Bearer ${token}` };\r\n            \r\n            // 1. Load ALL available Exercises\r\n            const exercisesResponse = await axios.get(`${API_URL}/exercises/`, { headers });\r\n            setAvailableExercises(exercisesResponse.data);\r\n            \r\n            // 2. Load Routine Data if in Edit Mode (Solo se ejecuta si es modo edicin y no se ha cargado)\r\n            if (isEditMode && routineId && allRoutinesData.length === 0) {\r\n                const routineResponse = await axios.get(`${API_URL}/routines/${routineId}`, { headers });\r\n                const routineData = routineResponse.data;\r\n\r\n                const loadedExercises = routineData.exercise_links\r\n                    .sort((a, b) => a.order - b.order) \r\n                    .map(link => ({\r\n                        exercise_id: link.exercise_id, \r\n                        name: link.exercise?.nombre || 'Ejercicio Desconocido',\r\n                        // CORRECCIN PARA CARGA: Aseguramos que los valores sean string o cadena vaca, NO \"null\" literal.\r\n                        series: String(link.sets || ''), \r\n                        repetitions: String(link.repetitions || ''), \r\n                        peso: String(link.peso || ''), // Aseguramos que sea string\r\n                    }));\r\n                \r\n                // Aseguramos que solo haya un elemento en modo edicin\r\n                setAllRoutinesData([{\r\n                    day: 1,\r\n                    name: routineData.nombre,\r\n                    // CORRECCIN: Si la descripcin viene nula, la establecemos como cadena vaca.\r\n                    description: routineData.descripcion || '', \r\n                    exercises: loadedExercises,\r\n                }]);\r\n                \r\n            } \r\n\r\n        } catch (e) {\r\n            console.error(\"Error loading data:\", e.response ? e.response.data : e.message);\r\n            setFetchError(`Error de conexin al cargar datos. ${isEditMode ? 'Rutina no encontrada.' : ''}`); \r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [isEditMode, routineId, getToken, allRoutinesData.length]);\r\n\r\n\r\n    // ------------------------------------------------------------------\r\n    // Effectos y Handlers de Navegacin\r\n    // ------------------------------------------------------------------\r\n\r\n    // 1. Carga inicial de datos y Configuracin del encabezado\r\n    useEffect(() => {\r\n        fetchExercises();\r\n        \r\n        // CORRECCIN DE UNIFICACIN: Eliminamos el botn de regreso nativo\r\n        navigation.setOptions({ \r\n            headerLeft: () => null, // Esto elimina la flecha de volver atrs\r\n            title: isEditMode ? `Editar: ${route.params?.routineMetadata?.nombre || 'Rutina'}` : `Creacin: ${baseName}`,\r\n        });\r\n        \r\n    }, [routineId, fetchExercises]); \r\n    \r\n    // 2. RECARGA al volver de ExercisesAdd.js (por el focus)\r\n    useEffect(() => {\r\n        const unsubscribe = navigation.addListener('focus', () => {\r\n             // Siempre recargamos los ejercicios al volver de cualquier otra pantalla para refrescar el catlogo\r\n             fetchExercises();\r\n        });\r\n\r\n        return unsubscribe;\r\n    }, [navigation, fetchExercises]);\r\n\r\n\r\n    // 3. NUEVO HANDLER: Navegar a la pantalla de adicin de ejercicios\r\n    const handleNavigateToAddExercise = () => {\r\n        // Cerramos el selector si estuviera abierto y navegamos a la pantalla de adicin\r\n        setIsExerciseSelectorOpen(false); \r\n        // Esta es la navegacin que necesita la nueva pantalla en App.js!\r\n        navigation.navigate('ExercisesAdd'); \r\n    };\r\n\r\n    // Exercise management\r\n    const addExercise = () => {\r\n        const newExercises = [...currentRoutine.exercises, { \r\n            exercise_id: null, \r\n            name: '', \r\n            series: '', \r\n            repetitions: '', \r\n            peso: '', \r\n        }];\r\n        setRoutineData('exercises', newExercises);\r\n    };\r\n\r\n    const removeExercise = (index) => {\r\n        Alert.alert(\r\n            \"Confirmar Eliminacin\",\r\n            `Ests seguro de que quieres eliminar el ejercicio #${index + 1}?`,\r\n            [\r\n                { text: \"Cancelar\", style: \"cancel\" },\r\n                { \r\n                    text: \"Eliminar\", \r\n                    style: \"destructive\", \r\n                    onPress: () => {\r\n                        const newExercises = currentRoutine.exercises.filter((_, i) => i !== index);\r\n                        setRoutineData('exercises', newExercises);\r\n                    }\r\n                }\r\n            ]\r\n        );\r\n    };\r\n    \r\n    // Exercise Selector Modal Logic\r\n    const toggleExerciseSelector = (index) => {\r\n        setCurrentExerciseIndex(index);\r\n        setIsExerciseSelectorOpen(true);\r\n        setSearchQuery(''); // Limpiamos la bsqueda al abrir\r\n    };\r\n    \r\n    const handleSelectExercise = (exerciseId, exerciseName) => {\r\n        if (currentExerciseIndex !== null) {\r\n            const isDuplicate = currentRoutine.exercises.some((ex, i) => i !== currentExerciseIndex && ex.exercise_id === exerciseId);\r\n            if (isDuplicate) {\r\n                Alert.alert(\"Advertencia\", \"Este ejercicio ya est en la rutina. Puedes editar sus series/repeticiones.\"); \r\n            }\r\n            \r\n            updateExercise(currentExerciseIndex, 'exercise_id', exerciseId);\r\n            updateExercise(currentExerciseIndex, 'name', exerciseName);\r\n        }\r\n        setIsExerciseSelectorOpen(false);\r\n        setSearchQuery(''); \r\n        setCurrentExerciseIndex(null);\r\n    };\r\n    \r\n    // ------------------------------------------------------------------\r\n    // Validation and Save Logic (VALIDACIN REFORZADA)\r\n    // ------------------------------------------------------------------\r\n    const validateCurrentRoutine = () => {\r\n        if (!currentRoutine.name.trim()) {\r\n            Alert.alert(\"Error\", `El nombre de la rutina no puede estar vaco.`); \r\n            return false;\r\n        }\r\n        \r\n        if (currentRoutine.exercises.length === 0) {\r\n            Alert.alert(\"Error\", `La rutina \"${currentRoutine.name}\" debe tener al menos un ejercicio.`);\r\n            return false;\r\n        }\r\n        \r\n        const invalidExercise = currentRoutine.exercises.find(ex => {\r\n            // 1. Exercise must be selected\r\n            if (!ex.exercise_id) return true;\r\n            \r\n            // 2. Series validation: must be a positive integer\r\n            const seriesTrimmed = ex.series ? ex.series.trim() : '';\r\n            const seriesNumber = parseInt(seriesTrimmed);\r\n            \r\n            // Falla si es NaN (e.g., \"a\"), o si es <= 0, o si el string es vaco (seriesTrimmed.length === 0)\r\n            if (isNaN(seriesNumber) || seriesNumber <= 0) return true;\r\n\r\n            // 3. Repetitions validation: must be non-empty string\r\n            const repetitionsTrimmed = ex.repetitions ? ex.repetitions.trim() : '';\r\n            if (repetitionsTrimmed.length === 0) return true; \r\n\r\n            // All checks passed\r\n            return false;\r\n        });\r\n\r\n        if (invalidExercise) {\r\n            Alert.alert(\"Error de Validacin\", `En \"${currentRoutine.name}\": Todos los ejercicios deben estar seleccionados y tener Series (entero positivo) y Repeticiones no vacas.`); \r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    \r\n    const handleNextRoutineOrSaveAll = async () => {\r\n        if (!validateCurrentRoutine()) return;\r\n\r\n        if (currentDay < totalDays) {\r\n            setCurrentDay(currentDay + 1);\r\n            Alert.alert(\"Rutina Guardada Temporalmente\", `Rutina \"${currentRoutine.name}\" completada! Editando el Da ${currentDay + 1}.`, [{ text: \"OK\" }]); \r\n        } else {\r\n            // Este modo (transaccional) solo se usa en creacin\r\n            await handleSaveTransaction();\r\n        }\r\n    };\r\n\r\n    const handleSaveTransaction = async () => {\r\n        if (isSaving) return;\r\n        setIsSaving(true);\r\n        \r\n        const expirationDate = routineMetadata?.expirationDate; // YYYY-MM-DD\r\n\r\n        const payload = {\r\n            nombre: baseName, \r\n            descripcion: routineMetadata?.descripcion || null, \r\n            fecha_vencimiento: expirationDate,\r\n            student_id: studentId,\r\n            days: totalDays, \r\n            routines: allRoutinesData.map((routine, index) => ({\r\n                nombre: routine.name, \r\n                // Aseguramos que la descripcin sea string vaco si est vaca, no null (por si el backend lo requiere)\r\n                descripcion: routine.description.trim() || '', \r\n                exercises: routine.exercises.map((ex, exIndex) => ({\r\n                    exercise_id: ex.exercise_id,\r\n                    sets: parseInt(ex.series.trim()), // Aseguramos el parseo (debe ser un entero)\r\n                    repetitions: ex.repetitions.trim(), // Aseguramos que sea string\r\n                    peso: ex.peso.trim() || 'N/A', \r\n                    order: exIndex + 1\r\n                }))\r\n            }))\r\n        };\r\n\r\n        try {\r\n            const token = await getToken();\r\n            const headers = { 'Authorization': `Bearer ${token}` };\r\n\r\n            // Endpoint para la creacin transaccional de Grupo y Rutinas\r\n            await axios.post(`${API_URL}/routines-group/create-transactional`, payload, { headers });\r\n            \r\n            Alert.alert(\r\n                \"xito Total!\", \r\n                `Se cre la agrupacin \"${baseName}\" con ${totalDays} rutinas y fue asignada a ${studentName}.`\r\n            );\r\n            \r\n            navigation.goBack(); \r\n            \r\n        } catch (e) {\r\n            console.error(\"Error saving transaction (API):\", e.response ? e.response.data : e.message);\r\n            \r\n            let errorMessage = \"Fallo desconocido al guardar la transaccin.\"; \r\n            if (e.response && e.response.data && e.response.data.detail) {\r\n                if (Array.isArray(e.response.data.detail) || typeof e.response.data.detail === 'string') {\r\n                    errorMessage = `Error de FastAPI: ${JSON.stringify(e.response.data.detail)}`;\r\n                }\r\n            }\r\n            \r\n            Alert.alert(\"Error de Guardado\", errorMessage);\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n\r\n    const handleSaveSingleRoutine = async () => {\r\n        if (!validateCurrentRoutine()) return;\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            const token = await getToken();\r\n            const headers = { 'Authorization': `Bearer ${token}` };\r\n            \r\n            // En modo edicin, solo hay una rutina en allRoutinesData[0]\r\n            const routineToSave = currentRoutine; \r\n\r\n            const routineData = {\r\n                nombre: routineToSave.name.trim(),\r\n                // CORRECCIN CLAVE: Si la descripcin est vaca, enviamos \"\" en lugar de null\r\n                descripcion: routineToSave.description.trim() || '', \r\n                exercises: routineToSave.exercises.map((ex, index) => ({ \r\n                    exercise_id: ex.exercise_id, \r\n                    sets: parseInt(ex.series.trim()), // Aseguramos el parseo (debe ser un entero)\r\n                    repetitions: ex.repetitions.trim(), // Aseguramos que sea string\r\n                    peso: ex.peso.trim() || 'N/A', \r\n                    order: index + 1 \r\n                }))\r\n            };\r\n\r\n            // Usamos el endpoint PATCH /routines/{routine_id}\r\n            await axios.patch(`${API_URL}/routines/${routineId}`, routineData, { headers });\r\n            \r\n            Alert.alert(\"xito de Edicin\", `Rutina \"${routineToSave.name.trim()}\" actualizada exitosamente.`); \r\n            navigation.goBack(); \r\n            \r\n        } catch (e) {\r\n            console.error(\"Error saving routine (API):\", e.message, JSON.stringify(e.response ? e.response.data : e.message)); \r\n            \r\n            let errorMessage = \"Fallo desconocido al guardar la rutina.\";\r\n             if (e.response && e.response.data && e.response.data.detail) {\r\n                // Captura el mensaje de error detallado del backend\r\n                if (Array.isArray(e.response.data.detail) || typeof e.response.data.detail === 'string') {\r\n                    // Si el backend es el que lanza el error, mostramos su detalle\r\n                    errorMessage = `Error de FastAPI: ${JSON.stringify(e.response.data.detail)}`;\r\n                }\r\n            } else if (e.message === \"Network Error\") {\r\n                 errorMessage = \"Error de red: No se pudo conectar al servidor API.\";\r\n            }\r\n\r\n            // Aqu alertamos el error. El error de Render es provocado por esta llamada fallida.\r\n            Alert.alert(\"Error de Edicin\", errorMessage); \r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n    \r\n    const handleMainSaveAction = isEditMode ? handleSaveSingleRoutine : handleNextRoutineOrSaveAll;\r\n    \r\n    const filteredExercises = availableExercises.filter(ex => \r\n        ex.nombre.toLowerCase().includes(searchQuery.toLowerCase()) || \r\n        (ex.grupo_muscular && ex.grupo_muscular.toLowerCase().includes(searchQuery.toLowerCase()))\r\n    );\r\n\r\n    // UI Status Views\r\n    if (isLoading || (allRoutinesData.length === 0 && !isEditMode && !fetchError)) {\r\n        return (\r\n            <View style={styles.loadingContainer}>\r\n                <ActivityIndicator size=\"large\" color={'#3ABFBC'} />\r\n                <Text style={{marginTop: 10, color: themeColors.textSecondary}}>Cargando datos...</Text>\r\n            </View>\r\n        );\r\n    }\r\n    \r\n    // Placeholder color for inputs\r\n    const placeholderColor = '#A9A9A9';\r\n\r\n    // Main button texts and colors\r\n    const mainButtonText = isEditMode ? \"Guardar Cambios\" : (\r\n        currentDay < totalDays ? `Siguiente (Da ${currentDay + 1})` : \"Guardar Todo\"\r\n    );\r\n    const mainButtonColor = isEditMode ? themeColors.warning : (\r\n        currentDay < totalDays ? '#3ABFBC' : '#3ABFBC' // Siempre verde en creacin\r\n    );\r\n\r\n    // ------------------------------------------------------------------\r\n    // Exercise Selector Modal View\r\n    // ------------------------------------------------------------------\r\n    if (isExerciseSelectorOpen) {\r\n        return (\r\n            <SafeAreaView style={styles.selectorContainer}>\r\n                <View style={styles.selectorHeader}>\r\n                    <TouchableOpacity \r\n                        onPress={() => setIsExerciseSelectorOpen(false)}\r\n                        style={styles.closeSelectorButton}\r\n                    >\r\n                        <XCircle size={28} color={themeColors.danger} />\r\n                    </TouchableOpacity>\r\n                    <Text style={styles.selectorTitle}>Seleccionar Ejercicio</Text>\r\n                    <View style={{width: 28}}/> \r\n                </View>\r\n\r\n                <TextInput\r\n                    style={styles.selectorSearchInput}\r\n                    placeholder=\"Buscar (Nombre o Grupo Muscular)\"\r\n                    placeholderTextColor={placeholderColor}\r\n                    value={searchQuery}\r\n                    onChangeText={setSearchQuery}\r\n                />\r\n                \r\n                {/* --- BOTN AGREGAR NUEVO EJERCICIO --- */}\r\n                <TouchableOpacity \r\n                    onPress={handleNavigateToAddExercise} \r\n                    style={[styles.selectorActionButton, { backgroundColor: '#3ABFBC'}]} \r\n                    disabled={isSaving}\r\n                >\r\n                    <PlusCircle size={18} color={'black'} />\r\n                    <Text style={styles.addExerciseButtonText}>Agregar Nuevo Ejercicio al Catlogo</Text>\r\n                </TouchableOpacity>\r\n                {/* ------------------------------------------------------------------------- */}\r\n\r\n                <ScrollView contentContainerStyle={styles.selectorList}>\r\n                    {filteredExercises.length > 0 ? (\r\n                        filteredExercises.map((ex) => (\r\n                        <TouchableOpacity\r\n                            key={ex.id.toString()}\r\n                            style={styles.selectorItem}\r\n                            onPress={() => handleSelectExercise(ex.id, ex.nombre)}\r\n                        >\r\n                            <Text style={styles.selectorItemName}>{ex.nombre}</Text>\r\n                            <Text style={styles.selectorItemGroup}>Grupo: {ex.grupo_muscular}</Text>\r\n                        </TouchableOpacity>\r\n                        ))\r\n                    ) : (\r\n                        <Text style={{textAlign: 'center', color: themeColors.textSecondary, marginTop: 20}}>\r\n                            No se encontraron ejercicios con ese filtro.\r\n                        </Text>\r\n                    )}\r\n                </ScrollView>\r\n            </SafeAreaView>\r\n        );\r\n    }\r\n\r\n    // ------------------------------------------------------------------\r\n    // Main Screen View\r\n    // ------------------------------------------------------------------\r\n    return (\r\n        <SafeAreaView style={styles.container}>\r\n            {/* Encabezado Personalizado (Reemplaza la barra de navegacin nativa) */}\r\n            <View style={styles.screenHeader}>\r\n                <Text style={styles.screenTitle}>\r\n                    {isEditMode ? `Editar Rutina: ${currentRoutine.name}` : `Creacin: ${currentRoutine.name}`}\r\n                </Text>\r\n            </View>\r\n            \r\n            {/* Top Action Bar (Guardar/Cancelar) */}\r\n            <View style={styles.subHeader}>\r\n                {/* BOTN CANCELAR (Ahora es el nico botn de navegacin de salida) */}\r\n                <TouchableOpacity \r\n                    onPress={() => navigation.goBack()}\r\n                    style={[styles.actionButton, styles.cancelButton]}\r\n                    disabled={isSaving}\r\n                >\r\n                    <XCircle size={18} color={'black'} />\r\n                    <Text style={styles.actionButtonText}>Cancelar</Text>\r\n                </TouchableOpacity>\r\n\r\n                {/* BOTN PRINCIPAL DE ACCIN (Siguiente/Guardar) */}\r\n                <TouchableOpacity \r\n                    onPress={handleMainSaveAction}\r\n                    style={[styles.actionButton, {backgroundColor: mainButtonColor}]}\r\n                    disabled={isSaving || !currentRoutine.name.trim() || currentRoutine.exercises.length === 0}\r\n                >\r\n                    {isSaving ? (\r\n                        <ActivityIndicator size=\"small\" color={'black'} />\r\n                    ) : (\r\n                        <Save size={18} color={'black'} />\r\n                    )}\r\n                    <Text style={styles.actionButtonText}>\r\n                        {isSaving ? \"Guardando...\" : mainButtonText}\r\n                    </Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n\r\n            <KeyboardAvoidingView \r\n                style={{flex: 1}} \r\n                behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                keyboardVerticalOffset={Platform.OS === \"ios\" ? 0 : 20}\r\n            >\r\n                <ScrollView contentContainerStyle={styles.content}>\r\n                    \r\n                    {/* Routine Name Input */}\r\n                    <Text style={styles.label}>Nombre de la Rutina (Da {currentDay}):</Text>\r\n                    <TextInput\r\n                        style={styles.input} \r\n                        placeholder=\"Ej: Rutina Hipertrofia Da A\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        value={currentRoutine.name}\r\n                        onChangeText={(text) => setRoutineData('name', text)}\r\n                        editable={!isSaving}\r\n                    />\r\n                    \r\n                    {/* Description Input */}\r\n                    <Text style={styles.label}>Descripcin (Opcional):</Text>\r\n                    <TextInput\r\n                        style={[styles.input, styles.textArea]}\r\n                        placeholder=\"Ej: Fase de volumen 4 semanas\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        value={currentRoutine.description}\r\n                        onChangeText={(text) => setRoutineData('description', text)}\r\n                        multiline\r\n                        editable={!isSaving}\r\n                    />\r\n                    \r\n                    {/* Exercise List Section */}\r\n                    <Text style={styles.sectionTitle}>\r\n                        Ejercicios ({currentRoutine.exercises.length}):\r\n                    </Text>\r\n                    \r\n                    {/* Aqu ahora va directamente la lista de ejercicios: */}\r\n                    <View>\r\n                        {currentRoutine.exercises.map((exercise, index) => (\r\n                            <ExerciseItem \r\n                                key={index.toString()}\r\n                                index={index}\r\n                                exercise={exercise}\r\n                                updateExercise={updateExercise}\r\n                                removeExercise={removeExercise}\r\n                                toggleSelector={toggleExerciseSelector}\r\n                                themeColors={themeColors}\r\n                            />\r\n                        ))}\r\n                    </View>\r\n                \r\n                </ScrollView>\r\n            </KeyboardAvoidingView>\r\n\r\n            {/* FAB: Floating Action Button to Add Exercise ITEM to the current routine */}\r\n            <TouchableOpacity \r\n                onPress={addExercise} \r\n                style={styles.floatingButton} \r\n                disabled={isSaving || fetchError || availableExercises.length === 0}\r\n            >\r\n                <PlusCircle size={24} color={'black'} />\r\n                <Text style={styles.floatingButtonText}>Aadir Ejercicio</Text>\r\n            </TouchableOpacity>\r\n        </SafeAreaView>\r\n    );\r\n}","import React, { useState, useContext } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, TextInput, TouchableOpacity, \r\n    ScrollView, SafeAreaView, Alert, ActivityIndicator \r\n} from 'react-native';\r\nimport axios from 'axios';\r\nimport { AuthContext } from '../App'; \r\n// Importamos useTheme\r\nimport { useTheme } from '../ThemeContext'; \r\n\r\n//  Asegurate de que esta URL sea la misma que en App.js\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n\r\n// ----------------------------------------------------------------------\r\n// GENERADOR DE ESTILOS DINMICOS - ESTILO PEAKFIT\r\n// ----------------------------------------------------------------------\r\nconst getStyles = (colors) => StyleSheet.create({\r\n    safeArea: {\r\n        flex: 1,\r\n        // Fondo principal negro\r\n        backgroundColor: 'black',\r\n    },\r\n    container: {\r\n        padding: 20,\r\n        alignItems: 'center',\r\n    },\r\n    title: {\r\n        fontSize: 28,\r\n        fontWeight: 'bold',\r\n        // Ttulo blanco\r\n        color: 'white',\r\n        marginBottom: 30,\r\n        marginTop: 20,\r\n    },\r\n    input: {\r\n        width: '100%',\r\n        height: 50,\r\n        // Fondo de input oscuro\r\n        backgroundColor: '#1C1C1E',\r\n        // Eliminamos el borde visible\r\n        borderColor: 'transparent',\r\n        borderWidth: 1,\r\n        borderRadius: 10, // Ms redondeado\r\n        paddingHorizontal: 15,\r\n        marginBottom: 15,\r\n        fontSize: 16,\r\n        // Color del texto: Blanco\r\n        color: 'white',\r\n    },\r\n    button: {\r\n        width: '100%',\r\n        // Botn principal: Verde brillante\r\n        backgroundColor: '#3ABFBC',\r\n        padding: 15,\r\n        borderRadius: 10, // Ms redondeado\r\n        alignItems: 'center',\r\n        marginTop: 20,\r\n        // Sombra del botn (ajustada para el verde)\r\n        shadowColor: '#3ABFBC',\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.6,\r\n        shadowRadius: 5,\r\n        elevation: 6,\r\n    },\r\n    buttonText: {\r\n        // Texto del botn: Negro para alto contraste\r\n        color: 'black',\r\n        fontSize: 18,\r\n        fontWeight: 'bold',\r\n    }\r\n});\r\n\r\nexport default function ChangePasswordScreen({ navigation }) {\r\n    \r\n    const { colors: themeColors, isDark } = useTheme();\r\n    const styles = getStyles(themeColors); // Obtenemos estilos dinmicos\r\n\r\n    const [oldPassword, setOldPassword] = useState('');\r\n    const [newPassword, setNewPassword] = useState('');\r\n    const [confirmPassword, setConfirmPassword] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const { getToken, signOut } = useContext(AuthContext);\r\n\r\n    const handleChangePassword = async () => {\r\n        if (newPassword !== confirmPassword) {\r\n            Alert.alert(\"Error\", \"La nueva contrasea y la confirmacin no coinciden.\"); \r\n            return;\r\n        }\r\n\r\n        if (newPassword.length < 6) {\r\n            Alert.alert(\"Error\", \"La nueva contrasea debe tener al menos 6 caracteres.\"); \r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            const token = await getToken();\r\n            \r\n            if (!token) {\r\n                signOut();\r\n                return;\r\n            }\r\n\r\n            //  RUTA DE LA API que crearemos en main.py\r\n            const response = await axios.post(`${API_URL}/users/change-password`, {\r\n                old_password: oldPassword,\r\n                new_password: newPassword\r\n            }, {\r\n                headers: { 'Authorization': `Bearer ${token}` }\r\n            });\r\n\r\n            Alert.alert(\"xito\", \"Tu contrasea ha sido actualizada. Por favor, vuelve a iniciar sesin.\", [ \r\n                { \r\n                    text: \"OK\", \r\n                    onPress: () => signOut() // Forzamos el cierre para que use el nuevo hash\r\n                }\r\n            ]);\r\n\r\n        } catch (e) {\r\n            console.error(\"Error al cambiar contrasea:\", e.response ? e.response.data : e.message); \r\n            const errorDetail = e.response?.data?.detail || \"Fallo desconocido al cambiar la contrasea.\";\r\n            Alert.alert(\"Error\", errorDetail);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <SafeAreaView style={styles.safeArea}>\r\n            <ScrollView contentContainerStyle={styles.container}>\r\n                <Text style={styles.title}>Cambiar Contrasea</Text>\r\n\r\n                <TextInput\r\n                    style={styles.input}\r\n                    placeholder=\"Contrasea Antigua\"\r\n                    // Placeholder gris claro\r\n                    placeholderTextColor={'#A9A9A9'}\r\n                    secureTextEntry={true}\r\n                    value={oldPassword}\r\n                    onChangeText={setOldPassword}\r\n                    editable={!isLoading}\r\n                />\r\n\r\n                <TextInput\r\n                    style={styles.input}\r\n                    placeholder=\"Nueva Contrasea (mnimo 6 caracteres)\" \r\n                    // Placeholder gris claro\r\n                    placeholderTextColor={'#A9A9A9'}\r\n                    secureTextEntry={true}\r\n                    value={newPassword}\r\n                    onChangeText={setNewPassword}\r\n                    editable={!isLoading}\r\n                />\r\n\r\n                <TextInput\r\n                    style={styles.input}\r\n                    placeholder=\"Confirmar Nueva Contrasea\"\r\n                    // Placeholder gris claro\r\n                    placeholderTextColor={'#A9A9A9'}\r\n                    secureTextEntry={true}\r\n                    value={confirmPassword}\r\n                    onChangeText={setConfirmPassword}\r\n                    editable={!isLoading}\r\n                />\r\n                \r\n                {isLoading ? (\r\n                    <ActivityIndicator \r\n                        size=\"large\" \r\n                        color={'#3ABFBC'} // Color principal del tema\r\n                        style={{marginTop: 20}} \r\n                    />\r\n                ) : (\r\n                    <TouchableOpacity style={styles.button} onPress={handleChangePassword}>\r\n                        <Text style={styles.buttonText}>Actualizar Contrasea</Text>\r\n                    </TouchableOpacity>\r\n                )}\r\n\r\n                <TouchableOpacity \r\n                    onPress={() => navigation.goBack()}\r\n                    style={{marginTop: 30, padding: 10}}\r\n                >\r\n                    <Text style={{color: '#3ABFBC', fontSize: 16, fontWeight: 'bold'}}>\r\n                        Cancelar y Volver\r\n                    </Text>\r\n                </TouchableOpacity>\r\n                \r\n            </ScrollView>\r\n        </SafeAreaView>\r\n    );\r\n}","import React, { useState, useContext } from 'react';\r\nimport { StyleSheet, Text, View, SafeAreaView, ScrollView, Button, TextInput, Alert, ActivityIndicator, TouchableOpacity } from 'react-native';\r\nimport { useRoute } from '@react-navigation/native';\r\nimport axios from 'axios';\r\nimport { useTheme } from '../ThemeContext'; \r\nimport { AuthContext } from '../App'; // Asumiendo que AuthContext esta disponible en '../App'\r\nimport { ArrowLeft } from 'lucide-react-native'; // Icono para volver\r\n\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\";\r\n\r\nexport default function StudentDetailsScreen({ navigation }) {\r\n    \r\n    const route = useRoute();\r\n    const { student } = route.params;\r\n    const { colors: themeColors } = useTheme();\r\n    const { getToken } = useContext(AuthContext);\r\n\r\n    //  1. ESTADOS EDITABLES\r\n    const [nombre, setNombre] = useState(student.nombre || '');\r\n    const [email, setEmail] = useState(student.email || '');\r\n    const [dni, setDni] = useState(student.dni || '');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    \r\n    // El ID interno (student.id) NO es editable.\r\n    const hasChanges = nombre !== student.nombre || email !== student.email || dni !== student.dni;\r\n\r\n    // ----------------------------------------------------------------\r\n    //  2. FUNCIoN DE GUARDADO (PATCH a la API)\r\n    // ----------------------------------------------------------------\r\n    const handleSave = async () => {\r\n        if (!hasChanges) {\r\n            Alert.alert(\"Atencion\", \"No hay cambios para guardar.\");\r\n            return;\r\n        }\r\n\r\n        if (!nombre.trim() || !email.trim() || !dni.trim()) {\r\n            Alert.alert(\"Error\", \"Todos los campos deben estar completos.\");\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            const token = await getToken();\r\n            const headers = { 'Authorization': `Bearer ${token}` };\r\n            \r\n            const updatePayload = {\r\n                nombre: nombre.trim(),\r\n                email: email.trim(),\r\n                dni: dni.trim(),\r\n            };\r\n            \r\n            // Envia la solicitud PATCH al nuevo endpoint\r\n            await axios.patch(`${API_URL}/users/student/${student.id}`, updatePayload, { headers });\r\n\r\n            Alert.alert(\"xito\", `Los datos de ${nombre} se actualizaron correctamente.`);\r\n            \r\n            // 3. Opcional: Volver al profesor screen y forzar recarga de la lista\r\n            navigation.navigate('ProfessorPanel', { reload: true }); \r\n\r\n        } catch (e) {\r\n            console.error(\"Error al guardar datos del alumno:\", e.response ? e.response.data : e.message);\r\n            let errorMessage = \"Fallo al actualizar. Verifica la conexin o el DNI/Email ya estn en uso.\";\r\n            if (e.response && e.response.data && e.response.data.detail) {\r\n                // Muestra un error mas especifico si viene del backend\r\n                errorMessage = e.response.data.detail;\r\n            }\r\n            Alert.alert(\"Error\", errorMessage);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n    \r\n    // ----------------------------------------------------------------\r\n    // 3. ESTILOS PEAKFIT (Uso de useTheme)\r\n    // ----------------------------------------------------------------\r\n    const styles = StyleSheet.create({\r\n        container: {\r\n            flex: 1,\r\n            backgroundColor: 'black', //  PEAKFIT: Fondo Negro\r\n        },\r\n        header: {\r\n            flexDirection: 'row',\r\n            alignItems: 'center',\r\n            padding: 15,\r\n            paddingTop: Platform.OS === 'android' ? 40 : 15,\r\n            backgroundColor: 'black',\r\n            borderBottomWidth: 1,\r\n            borderBottomColor: '#1C1C1E', // Lnea de separacin sutil\r\n        },\r\n        scrollContent: {\r\n            padding: 20,\r\n        },\r\n        title: {\r\n            fontSize: 26,\r\n            fontWeight: 'bold',\r\n            color: 'white', //  PEAKFIT: Ttulo Blanco\r\n            marginBottom: 20,\r\n            borderBottomWidth: 2,\r\n            borderBottomColor: '#3ABFBC', //  PEAKFIT: Lnea divisoria verde\r\n            paddingBottom: 5,\r\n        },\r\n        detailCard: {\r\n            backgroundColor: '#1C1C1E', //  PEAKFIT: Fondo de tarjeta Dark Gray\r\n            padding: 15,\r\n            borderRadius: 10,\r\n            marginBottom: 15,\r\n            borderLeftWidth: 5,\r\n            borderLeftColor: '#3ABFBC', //  PEAKFIT: Borde verde\r\n        },\r\n        detailLabel: {\r\n            fontSize: 14,\r\n            color: '#A9A9A9', //  PEAKFIT: Texto Secundario Gris\r\n            fontWeight: '600',\r\n            marginTop: 15,\r\n            marginBottom: 5,\r\n        },\r\n        inputField: {\r\n            fontSize: 18,\r\n            color: 'white', //  PEAKFIT: Texto Blanco\r\n            fontWeight: 'bold',\r\n            paddingVertical: 10,\r\n            borderBottomWidth: 1,\r\n            borderBottomColor: '#A9A9A9', //  PEAKFIT: Borde sutil gris\r\n            backgroundColor: 'black', //  PEAKFIT: Fondo de Input ms oscuro\r\n            borderRadius: 6,\r\n            paddingHorizontal: 10,\r\n            marginBottom: 10,\r\n        },\r\n        detailValueStatic: {\r\n            fontSize: 18,\r\n            color: 'white', //  PEAKFIT: Texto Blanco para valores\r\n            fontWeight: 'bold',\r\n        },\r\n        buttonContainer: {\r\n            marginTop: 30,\r\n            gap: 10,\r\n        },\r\n        customButton: {\r\n            paddingVertical: 12,\r\n            paddingHorizontal: 20,\r\n            borderRadius: 10,\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            minWidth: '100%',\r\n        },\r\n        buttonText: {\r\n            fontSize: 16,\r\n            fontWeight: 'bold',\r\n            color: 'black', // Texto negro en verde\r\n        },\r\n        buttonSuccess: {\r\n            backgroundColor: '#3ABFBC',\r\n        },\r\n        buttonSecondary: {\r\n            backgroundColor: '#1C1C1E',\r\n        },\r\n        buttonTextSecondary: {\r\n            color: 'white',\r\n        }\r\n    });\r\n\r\n    // Funcin para renderizar el botn de guardado (Personalizado)\r\n    const renderSaveButton = () => (\r\n        <TouchableOpacity\r\n            style={[\r\n                styles.customButton, \r\n                styles.buttonSuccess, \r\n                { opacity: !hasChanges || isLoading ? 0.5 : 1 }\r\n            ]}\r\n            onPress={handleSave}\r\n            disabled={!hasChanges || isLoading}\r\n        >\r\n            <Text style={styles.buttonText}>\r\n                {isLoading ? \"Guardando...\" : (hasChanges ? \"GUARDAR CAMBIOS\" : \"Sin Cambios\")}\r\n            </Text>\r\n        </TouchableOpacity>\r\n    );\r\n\r\n    // Funcin para renderizar el botn de Volver (Personalizado)\r\n    const renderBackButton = () => (\r\n        <TouchableOpacity\r\n            style={[styles.customButton, styles.buttonSecondary, {marginTop: 10}]}\r\n            onPress={() => navigation.goBack()}\r\n        >\r\n            <Text style={styles.buttonTextSecondary}>Volver sin Guardar</Text>\r\n        </TouchableOpacity>\r\n    );\r\n\r\n    // ----------------------------------------------------------------\r\n    // 4. RENDERIZADO\r\n    // ----------------------------------------------------------------\r\n    return (\r\n        <SafeAreaView style={styles.container}>\r\n            <View style={styles.header}>\r\n                <TouchableOpacity onPress={() => navigation.goBack()}>\r\n                    <ArrowLeft size={24} color={'white'} />\r\n                </TouchableOpacity>\r\n                <Text style={[styles.title, {flex: 1, textAlign: 'center', borderBottomWidth: 0, marginHorizontal: 10, marginBottom: 0}]}>\r\n                    Editar Alumno\r\n                </Text>\r\n                <View style={{width: 24}}/>\r\n            </View>\r\n            \r\n            <ScrollView contentContainerStyle={styles.scrollContent}>\r\n                <Text style={styles.title}>Detalles de: {student.nombre}</Text>\r\n\r\n                <View style={styles.detailCard}>\r\n                    \r\n                    {/* CAMPO EDITABLE: Nombre Completo */}\r\n                    <Text style={styles.detailLabel}>Nombre Completo:</Text>\r\n                    <TextInput\r\n                        style={styles.inputField}\r\n                        value={nombre}\r\n                        onChangeText={setNombre}\r\n                        placeholder=\"Nombre\"\r\n                        placeholderTextColor={'#A9A9A9'}\r\n                        editable={!isLoading}\r\n                    />\r\n\r\n                    {/* CAMPO EDITABLE: Email */}\r\n                    <Text style={styles.detailLabel}>Email:</Text>\r\n                    <TextInput\r\n                        style={styles.inputField}\r\n                        value={email}\r\n                        onChangeText={setEmail}\r\n                        placeholder=\"Email\"\r\n                        placeholderTextColor={'#A9A9A9'}\r\n                        keyboardType=\"email-address\"\r\n                        editable={!isLoading}\r\n                    />\r\n\r\n                    {/* CAMPO EDITABLE: DNI */}\r\n                    <Text style={styles.detailLabel}>DNI:</Text>\r\n                    <TextInput\r\n                        style={styles.inputField}\r\n                        value={dni}\r\n                        onChangeText={setDni}\r\n                        placeholder=\"DNI\"\r\n                        placeholderTextColor={'#A9A9A9'}\r\n                        keyboardType=\"numeric\"\r\n                        editable={!isLoading}\r\n                    />\r\n\r\n                    {/* CAMPO ESTaTICO: ID Interno (No editable) */}\r\n                    <Text style={styles.detailLabel}>ID Interno (Estatico):</Text>\r\n                    <Text style={styles.detailValueStatic}>{student.id}</Text>\r\n                    \r\n                </View>\r\n                \r\n                <View style={styles.buttonContainer}>\r\n                    {isLoading ? (\r\n                        <ActivityIndicator size=\"large\" color={'#3ABFBC'} />\r\n                    ) : (\r\n                        <>\r\n                            {renderSaveButton()}\r\n                            {renderBackButton()}\r\n                        </>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </SafeAreaView>\r\n    );\r\n}","import React, { useState, useContext } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, TextInput, Button, SafeAreaView, \r\n    ScrollView, TouchableOpacity, Alert, KeyboardAvoidingView, \r\n    Platform, ActivityIndicator\r\n} from 'react-native';\r\nimport axios from 'axios';\r\nimport { AuthContext } from '../App'; \r\nimport { useTheme } from '../ThemeContext'; \r\n// Importamos los iconos\r\nimport { User, Mail, Lock, CheckCircle, ArrowLeft, CreditCard } from 'lucide-react-native'; \r\n\r\n// ----------------------------------------------------------------------\r\n// URL de la API (DEBE COINCIDIR con la de App.js y ProfessorScreen.js)\r\n// ----------------------------------------------------------------------\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n// ----------------------------------------------------------------------\r\n\r\n// Esquema de estilos dinmico - ESTILO PEAKFIT\r\nconst getStyles = (colors) => StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: 'black', // Fondo negro\r\n    },\r\n    scrollContainer: {\r\n        flexGrow: 1,\r\n        padding: 20,\r\n        alignItems: 'center',\r\n    },\r\n    header: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'flex-start',\r\n        alignItems: 'center',\r\n        padding: 15,\r\n        backgroundColor: '#1C1C1E', // Fondo de tarjeta oscuro\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n    },\r\n    backButton: {\r\n        padding: 8,\r\n        borderRadius: 8,\r\n        marginRight: 10,\r\n    },\r\n    title: {\r\n        fontSize: 24,\r\n        fontWeight: 'bold',\r\n        color: '#3ABFBC', // Ttulo Verde\r\n    },\r\n    inputContainer: {\r\n        width: '100%',\r\n        marginBottom: 20,\r\n        marginTop: 10,\r\n    },\r\n    label: {\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n        color: 'white', // Texto de label blanco\r\n        marginBottom: 8,\r\n    },\r\n    inputWrapper: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        backgroundColor: '#1C1C1E', // Fondo de input oscuro\r\n        borderRadius: 10,\r\n        borderWidth: 1,\r\n        borderColor: 'transparent', // Sin borde visible\r\n        paddingHorizontal: 15,\r\n    },\r\n    input: {\r\n        flex: 1,\r\n        height: 50,\r\n        fontSize: 16,\r\n        color: 'white', // Texto de input blanco\r\n        marginLeft: 10,\r\n    },\r\n    buttonContainer: {\r\n        width: '100%',\r\n        marginTop: 30,\r\n        alignItems: 'center',\r\n    },\r\n    loadingText: {\r\n        marginTop: 10,\r\n        color: '#A9A9A9', // Gris claro\r\n    },\r\n    successMessage: {\r\n        fontSize: 18,\r\n        fontWeight: 'bold',\r\n        color: '#3ABFBC', // Verde\r\n        textAlign: 'center',\r\n        marginTop: 40,\r\n    },\r\n    icon: {\r\n        // Los iconos usan color secundario para los inputs\r\n        marginRight: 5,\r\n    },\r\n    \r\n    // ------------------------------------------------\r\n    // --- ESTILOS DE BOTONES PEAKFIT ---\r\n    // ------------------------------------------------\r\n    customButton: {\r\n        paddingVertical: 12,\r\n        paddingHorizontal: 20,\r\n        borderRadius: 10, \r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        minWidth: '100%', \r\n        shadowColor: \"#000\",\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.6,\r\n        shadowRadius: 5,\r\n        elevation: 6,\r\n    },\r\n    buttonPrimary: {\r\n        // Usamos el color verde brillante\r\n        backgroundColor: '#3ABFBC', \r\n    },\r\n    buttonText: {\r\n        fontSize: 16,\r\n        fontWeight: 'bold',\r\n        color: 'black', // Texto negro\r\n    },\r\n});\r\n\r\n/**\r\n * Pantalla para que el Profesor d de alta un nuevo Alumno.\r\n */\r\nexport default function AddStudentScreen({ navigation }) {\r\n    const { colors: themeColors } = useTheme();\r\n    const styles = getStyles(themeColors);\r\n\r\n    const [nombre, setNombre] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [dni, setDni] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [isSuccess, setIsSuccess] = useState(false);\r\n\r\n    // Placeholder Color (Gris Claro)\r\n    const placeholderColor = '#A9A9A9';\r\n    // Icon Color (Gris Claro)\r\n    const iconColor = '#A9A9A9';\r\n    \r\n    // Reinicia el formulario y el estado\r\n    const resetForm = () => {\r\n        setNombre('');\r\n        setEmail('');\r\n        setDni('');\r\n        setPassword('');\r\n        setIsSuccess(false);\r\n        setIsLoading(false);\r\n    };\r\n\r\n    const handleRegisterStudent = async () => {\r\n        // --- VALIDACIONES (Se mantienen) ---\r\n        if (!nombre.trim() || !email.trim() || !dni.trim() || !password.trim()) {\r\n            Alert.alert(\"Error\", \"Todos los campos son obligatorios.\");\r\n            return;\r\n        }\r\n\r\n        if (password.length < 6) {\r\n            Alert.alert(\"Error\", \"La contrasea debe tener al menos 6 caracteres.\");\r\n            return;\r\n        }\r\n\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (!emailRegex.test(email.trim())) {\r\n            Alert.alert(\"Error\", \"El formato del correo electrnico es invlido.\");\r\n            return;\r\n        }\r\n        \r\n        if (!/^\\d+$/.test(dni.trim())) {\r\n            Alert.alert(\"Error\", \"El DNI solo debe contener nmeros.\");\r\n            return;\r\n        }\r\n        // --- FIN VALIDACIONES ---\r\n\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            // Se usa el endpoint de registro pblico.\r\n            const response = await axios.post(\r\n                `${API_URL}/register/student`,\r\n                {\r\n                    nombre: nombre.trim(),\r\n                    email: email.trim(),\r\n                    dni: dni.trim(),\r\n                    password: password.trim(),\r\n                    rol: \"Alumno\" // <--- CRTICO: Aadido para que coincida con el payload del RegisterModal.\r\n                }\r\n            );\r\n\r\n            // Si el registro es exitoso\r\n            setIsSuccess(true);\r\n            \r\n            // Opcional: Volver al panel despus de 3 segundos\r\n            setTimeout(() => {\r\n                navigation.goBack(); \r\n            }, 3000);\r\n\r\n        } catch (e) {\r\n            console.error(\"Error al registrar alumno:\", e.response ? e.response.data : e.message);\r\n            const detail = e.response?.data?.detail;\r\n            \r\n            let msg = detail && typeof detail === 'string' ? detail : \"Fallo desconocido en el servidor.\";\r\n\r\n            if (msg.includes(\"DNI ya esta registrado\")) {\r\n                msg = \"El DNI proporcionado ya se encuentra registrado.\";\r\n            } else if (msg.includes(\"El email ya esta registrado\")) {\r\n                msg = \"El Email proporcionado ya se encuentra registrado.\";\r\n            } else if (e.message === 'Network Error') {\r\n                msg = `Error de Conexin. Asegrate de que el servidor de FastAPI est activo.`;\r\n            }\r\n            \r\n            Alert.alert(\"Error de Registro\", `Fallo al dar de alta el alumno. Detalle: ${msg}`);\r\n\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleGoBack = () => {\r\n        navigation.goBack();\r\n    };\r\n\r\n\r\n    return (\r\n        <SafeAreaView style={styles.container}>\r\n            <View style={styles.header}>\r\n                <TouchableOpacity onPress={handleGoBack} style={styles.backButton} disabled={isLoading}>\r\n                    <ArrowLeft size={24} color={'white'} />\r\n                </TouchableOpacity>\r\n                <Text style={styles.title}>Alta de Nuevo Alumno</Text>\r\n            </View>\r\n\r\n            <KeyboardAvoidingView \r\n                style={{ flex: 1 }}\r\n                behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                keyboardVerticalOffset={Platform.OS === \"ios\" ? 0 : 20}\r\n            >\r\n                <ScrollView contentContainerStyle={styles.scrollContainer} keyboardShouldPersistTaps=\"handled\">\r\n                    \r\n                    {isSuccess ? (\r\n                        <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\r\n                            <CheckCircle size={80} color={'#3ABFBC'} />\r\n                            <Text style={styles.successMessage}>\r\n                                Alumno '{nombre}' dado de alta con xito!\r\n                            </Text>\r\n                            <Text style={styles.loadingText}>Volviendo al panel...</Text>\r\n                        </View>\r\n                    ) : (\r\n                        <>\r\n                            <View style={styles.inputContainer}>\r\n                                <Text style={styles.label}>Nombre Completo:</Text>\r\n                                <View style={styles.inputWrapper}>\r\n                                    <User size={20} color={iconColor} style={styles.icon} />\r\n                                    <TextInput\r\n                                        style={styles.input}\r\n                                        placeholder=\"Nombre y apellido del alumno\"\r\n                                        placeholderTextColor={placeholderColor}\r\n                                        value={nombre}\r\n                                        onChangeText={setNombre}\r\n                                        keyboardType=\"default\"\r\n                                        autoCapitalize=\"words\"\r\n                                        editable={!isLoading}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n\r\n                            <View style={styles.inputContainer}>\r\n                                <Text style={styles.label}>Correo Electrnico (Email):</Text>\r\n                                <View style={styles.inputWrapper}>\r\n                                    <Mail size={20} color={iconColor} style={styles.icon} />\r\n                                    <TextInput\r\n                                        style={styles.input}\r\n                                        placeholder=\"ejemplo@correo.com\"\r\n                                        placeholderTextColor={placeholderColor}\r\n                                        value={email}\r\n                                        onChangeText={setEmail}\r\n                                        keyboardType=\"email-address\"\r\n                                        autoCapitalize=\"none\"\r\n                                        editable={!isLoading}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n                            \r\n                            {/* CAMPO DNI */}\r\n                            <View style={styles.inputContainer}>\r\n                                <Text style={styles.label}>DNI (Documento Nacional de Identidad):</Text>\r\n                                <View style={styles.inputWrapper}>\r\n                                    <CreditCard size={20} color={iconColor} style={styles.icon} />\r\n                                    <TextInput\r\n                                        style={styles.input}\r\n                                        placeholder=\"Solo nmeros\"\r\n                                        placeholderTextColor={placeholderColor}\r\n                                        value={dni}\r\n                                        onChangeText={setDni}\r\n                                        keyboardType=\"numeric\"\r\n                                        editable={!isLoading}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n                            {/* FIN CAMPO DNI */}\r\n\r\n                            <View style={styles.inputContainer}>\r\n                                <Text style={styles.label}>Contrasea Inicial:</Text>\r\n                                <View style={styles.inputWrapper}>\r\n                                    <Lock size={20} color={iconColor} style={styles.icon} />\r\n                                    <TextInput\r\n                                        style={styles.input}\r\n                                        placeholder=\"Mnimo 6 caracteres\"\r\n                                        placeholderTextColor={placeholderColor}\r\n                                        value={password}\r\n                                        onChangeText={setPassword}\r\n                                        secureTextEntry\r\n                                        editable={!isLoading}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n\r\n                            {/* BOTN REGISTRAR ALUMNO */}\r\n                            <View style={styles.buttonContainer}>\r\n\t\t\t\t\t\t\t\t<TouchableOpacity\r\n\t\t\t\t\t\t\t\t\tstyle={[\r\n\t\t\t\t\t\t\t\t\t\tstyles.customButton,\r\n\t\t\t\t\t\t\t\t\t\tstyles.buttonPrimary,\r\n\t\t\t\t\t\t\t\t\t\t{ opacity: (isLoading || !nombre.trim() || !email.trim() || !dni.trim() || !password.trim()) ? 0.5 : 1 }\r\n\t\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t\t\tonPress={handleRegisterStudent}\r\n\t\t\t\t\t\t\t\t\tdisabled={isLoading || !nombre.trim() || !email.trim() || !dni.trim() || !password.trim()}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<Text style={styles.buttonText}>{isLoading ? \"Registrando...\" : \"Registrar Alumno\"}</Text>\r\n\t\t\t\t\t\t\t\t</TouchableOpacity>\r\n\t\t\t\t\t\t\t\t{isLoading && <ActivityIndicator size=\"small\" color={'#3ABFBC'} style={{ marginTop: 15 }} />}\r\n\t\t\t\t\t\t\t</View>\r\n                        </>\r\n                    )}\r\n                </ScrollView>\r\n            </KeyboardAvoidingView>\r\n        </SafeAreaView>\r\n    );\r\n}","import React, { useState, useContext } from 'react';\r\nimport { \r\n    View, Text, TextInput, StyleSheet, Alert, ScrollView, \r\n    SafeAreaView, TouchableOpacity, ActivityIndicator, Platform \r\n} from 'react-native';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport { Picker } from '@react-native-picker/picker';\r\nimport { ArrowLeft, Save } from 'lucide-react-native';\r\nimport axios from 'axios'; // <--- LNEA FALTANTE CRTICA!\r\n\r\n// IMPORTACIONES CRTICAS:\r\nimport { AuthContext } from '../App'; // Ruta al contexto de autenticacin\r\nimport { useTheme } from '../ThemeContext'; // Usamos el hook de tema para los colores\r\n\r\n// ----------------------------------------------------------------------\r\n// Configuracin\r\n// ----------------------------------------------------------------------\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n\r\n// Asegrate de que esta lista de grupos musculares coincida con el Enum en tu FastAPI\r\nconst MUSCLE_GROUPS = [\r\n    { label: 'Seleccionar Grupo', value: '' },\r\n    { label: 'Pectoral', value: 'Pectoral' },\r\n    { label: 'Espalda', value: 'Espalda' },\r\n    { label: 'Piernas', value: 'Piernas' },\r\n    { label: 'Hombro', value: 'Hombro' },\r\n    { label: 'Brazos', value: 'Brazos' },\r\n    { label: 'Abdomen', value: 'Abdomen' },\r\n    { label: 'Gluteos', value: 'Gluteos' },\r\n    { label: 'Cardio', value: 'Cardio' },\r\n];\r\n\r\n// ----------------------------------------------------------------------\r\n// GENERADOR DE ESTILOS DINMICOS - ESTILO PEAKFIT\r\n// ----------------------------------------------------------------------\r\nconst getStyles = (colors) => StyleSheet.create({\r\n    fullContainer: {\r\n        flex: 1,\r\n        backgroundColor: 'black', //  PEAKFIT: Fondo Negro\r\n    },\r\n    header: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'space-between',\r\n        padding: 15,\r\n        backgroundColor: 'black', //  PEAKFIT: Encabezado Negro\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider, // Separador sutil\r\n        paddingTop: Platform.OS === 'android' ? 40 : 15, \r\n    },\r\n    backButton: {\r\n        padding: 5,\r\n    },\r\n    container: {\r\n        padding: 20,\r\n    },\r\n    card: {\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Fondo de tarjeta/Formulario Oscuro\r\n        borderRadius: 10,\r\n        padding: 20, // Aumentar padding para un look ms premium\r\n        shadowColor: '#000', // Sombra oscura\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.8, // Sombra ms pronunciada\r\n        shadowRadius: 5,\r\n        elevation: 8,\r\n    },\r\n    title: {\r\n        fontSize: 22,\r\n        fontWeight: 'bold',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        flex: 1,\r\n        textAlign: 'center',\r\n    },\r\n    label: {\r\n        fontSize: 16,\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        fontWeight: '600',\r\n        marginTop: 15,\r\n        marginBottom: 8, // Aumentar margen\r\n    },\r\n    input: {\r\n        // Unificamos el estilo de input para el look PEAKFIT\r\n        backgroundColor: '#1C1C1E', // Mismo color que la tarjeta para un look flotante minimalista\r\n        borderRadius: 10,\r\n        padding: 12, // Aumentar padding\r\n        fontSize: 16,\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        borderWidth: 1,\r\n        borderColor: colors.divider, // Borde sutil\r\n    },\r\n    textArea: {\r\n        minHeight: 100,\r\n        textAlignVertical: 'top',\r\n    },\r\n    pickerContainer: {\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Fondo oscuro\r\n        borderRadius: 10, // Redondeado\r\n        borderWidth: 1,\r\n        borderColor: colors.divider,\r\n        overflow: 'hidden',\r\n        marginBottom: 10,\r\n    },\r\n    picker: {\r\n        width: '100%',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n    },\r\n    saveButton: {\r\n        backgroundColor: '#3ABFBC', //  PEAKFIT: Verde Brillante\r\n        borderRadius: 10,\r\n        padding: 15,\r\n        alignItems: 'center',\r\n        flexDirection: 'row',\r\n        justifyContent: 'center',\r\n        marginTop: 30, // Aumentar margen\r\n        // Sombra de botn PEAKFIT\r\n        shadowColor: '#3ABFBC',\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.8,\r\n        shadowRadius: 5,\r\n        elevation: 6,\r\n    },\r\n    saveButtonText: {\r\n        color: 'black', //  PEAKFIT: Texto Negro en botn verde\r\n        fontSize: 18,\r\n        fontWeight: 'bold',\r\n        marginLeft: 10,\r\n    },\r\n    disabledButton: {\r\n        backgroundColor: colors.divider,\r\n        opacity: 0.6,\r\n        shadowColor: 'transparent',\r\n    }\r\n});\r\n// ----------------------------------------------------------------------\r\n\r\nconst ExercisesAdd = () => {\r\n    const navigation = useNavigation();\r\n    //  OBTENEMOS LOS COLORES DEL TEMA\r\n    const { colors: themeColors } = useTheme(); \r\n    const styles = getStyles(themeColors); // Generamos estilos\r\n\r\n    // Usamos el contexto de Auth\r\n    const { getToken } = useContext(AuthContext); \r\n    \r\n    // Estado del formulario\r\n    const [nombre, setNombre] = useState('');\r\n    const [descripcion, setDescripcion] = useState('');\r\n    const [grupoMuscular, setGrupoMuscular] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Color del placeholder dinmico PEAKFIT\r\n    const placeholderColor = '#A9A9A9'; // Gris claro\r\n\r\n\r\n    // Funcin para manejar la creacin del ejercicio\r\n    const handleAddExercise = async () => {\r\n        if (!nombre.trim() || !grupoMuscular.trim()) {\r\n            Alert.alert('Error', 'El Nombre y el Grupo Muscular son obligatorios.');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        const token = await getToken();\r\n\r\n        const exerciseData = [\r\n            {\r\n                nombre: nombre.trim(),\r\n                descripcion: descripcion.trim() || 'Sin descripcin.',\r\n                grupo_muscular: grupoMuscular, \r\n            }\r\n        ];\r\n\r\n        try {\r\n            // Usamos axios para manejar mejor los errores\r\n            const response = await axios.post(`${API_URL}/exercises/`, exerciseData, {\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                }\r\n            });\r\n\r\n            setLoading(false);\r\n            \r\n            Alert.alert('xito', `Ejercicio \"${response.data[0].nombre}\" creado correctamente!`);\r\n            \r\n            // Volver a RoutineCreationScreen y RECARGAR la lista de ejercicios disponibles\r\n            navigation.goBack(); \r\n            \r\n\r\n        } catch (error) {\r\n            setLoading(false);\r\n            const detail = error.response?.data?.detail || error.message || 'Fallo en la conexin o la API.';\r\n            Alert.alert('Error al crear ejercicio', detail);\r\n            console.error('Error al agregar ejercicio:', error.response?.data || error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <SafeAreaView style={styles.fullContainer}>\r\n            {/* Encabezado */}\r\n            <View style={styles.header}>\r\n                <TouchableOpacity onPress={() => navigation.goBack()} style={styles.backButton} disabled={loading}>\r\n                    <ArrowLeft size={24} color={'white'} />\r\n                </TouchableOpacity>\r\n                <Text style={styles.title}>Crear Nuevo Ejercicio</Text>\r\n                <View style={{ width: 24 }} />\r\n            </View>\r\n\r\n            <ScrollView contentContainerStyle={styles.container}>\r\n                <View style={styles.card}>\r\n                    \r\n                    {/* Nombre del Ejercicio */}\r\n                    <Text style={styles.label}>Nombre:</Text>\r\n                    <TextInput\r\n                        style={styles.input}\r\n                        placeholder=\"Ej: Hip Thrust con Barra\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        value={nombre}\r\n                        onChangeText={setNombre}\r\n                        editable={!loading}\r\n                    />\r\n\r\n                    {/* Descripcin (Opcional) */}\r\n                    <Text style={styles.label}>Descripcin (Opcional):</Text>\r\n                    <TextInput\r\n                        style={[styles.input, styles.textArea]}\r\n                        placeholder=\"Ej: Desarrollo del glteo mayor.\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        value={descripcion}\r\n                        onChangeText={setDescripcion}\r\n                        multiline\r\n                        numberOfLines={4}\r\n                        editable={!loading}\r\n                    />\r\n\r\n                    {/* Selector de Grupo Muscular */}\r\n                    <Text style={styles.label}>Grupo Muscular:</Text>\r\n                    <View style={styles.pickerContainer}>\r\n                        <Picker\r\n                            selectedValue={grupoMuscular}\r\n                            onValueChange={(itemValue) => setGrupoMuscular(itemValue)}\r\n                            style={styles.picker}\r\n                            enabled={!loading}\r\n                        >\r\n                            {MUSCLE_GROUPS.map((group) => (\r\n                                <Picker.Item \r\n                                    key={group.value} \r\n                                    label={group.label} \r\n                                    value={group.value} \r\n                                    // Aseguramos que el texto del Picker se vea bien\r\n                                    // Usamos blanco si tiene valor, gris claro si es el placeholder (valor vaco)\r\n                                    color={group.value === '' ? placeholderColor : 'white'}\r\n                                />\r\n                            ))}\r\n                        </Picker>\r\n                    </View>\r\n\r\n                    {/* Botn de Guardar */}\r\n                    <TouchableOpacity\r\n                        onPress={handleAddExercise}\r\n                        disabled={loading || !nombre.trim() || !grupoMuscular.trim()}\r\n                        style={[styles.saveButton, (loading || !nombre.trim() || !grupoMuscular.trim()) && styles.disabledButton]}\r\n                    >\r\n                        {loading ? (\r\n                            <ActivityIndicator size=\"small\" color={'black'} />\r\n                        ) : (\r\n                            <Save size={20} color={'black'} />\r\n                        )}\r\n                        <Text style={styles.saveButtonText}>{loading ? 'Creando...' : 'Crear Ejercicio'}</Text>\r\n                    </TouchableOpacity>\r\n\r\n                </View>\r\n            </ScrollView>\r\n        </SafeAreaView>\r\n    );\r\n};\r\n\r\nexport default ExercisesAdd;","import React, { useState, useEffect, useContext } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, TextInput, SafeAreaView, \r\n    ScrollView, TouchableOpacity, Alert, KeyboardAvoidingView, Platform, ActivityIndicator\r\n} from 'react-native';\r\nimport { useRoute } from '@react-navigation/native';\r\nimport axios from 'axios';\r\nimport { AuthContext } from '../App'; \r\nimport { useTheme } from '../ThemeContext'; \r\nimport { Save, XCircle, PlusCircle, Trash2, Zap, ArrowLeft } from 'lucide-react-native'; // Aadimos ArrowLeft por si acaso\r\n\r\n// ----------------------------------------------------------------------\r\n// API Configuration (Must match App.js)\r\n// ----------------------------------------------------------------------\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n\r\n// ----------------------------------------------------------------------\r\n// Dynamic Exercise Styles Generator\r\n// ----------------------------------------------------------------------\r\nconst getExerciseStyles = (colors) => StyleSheet.create({\r\n    card: {\r\n        backgroundColor: colors.card,\r\n        borderRadius: 12,\r\n        padding: 15,\r\n        marginBottom: 15,\r\n        borderLeftWidth: 5,\r\n        borderLeftColor: colors.primary,\r\n        elevation: 4,\r\n        shadowColor: colors.isDark ? '#000' : '#444',\r\n        shadowOffset: { width: 0, height: 2 },\r\n        shadowOpacity: colors.isDark ? 0.3 : 0.1,\r\n        shadowRadius: 3,\r\n    },\r\n    header: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        marginBottom: 10,\r\n    },\r\n    title: {\r\n        fontSize: 16,\r\n        fontWeight: '700',\r\n        color: colors.textPrimary,\r\n        opacity: 0.7,\r\n    },\r\n    deleteButton: {\r\n        padding: 5,\r\n    },\r\n    selectButton: {\r\n        backgroundColor: colors.highlight,\r\n        borderRadius: 8,\r\n        paddingHorizontal: 15,\r\n        paddingVertical: 12,\r\n        marginBottom: 15,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'flex-start',\r\n    },\r\n    selectButtonText: {\r\n        color: colors.textPrimary, \r\n        fontSize: 17,\r\n        fontWeight: '600',\r\n        marginLeft: 10,\r\n        flexShrink: 1,\r\n    },\r\n    row: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        marginTop: 5,\r\n    },\r\n    compactLabel: {\r\n        fontSize: 12,\r\n        color: colors.textSecondary,\r\n        marginBottom: 3,\r\n        fontWeight: 'bold',\r\n        textAlign: 'center',\r\n        textTransform: 'uppercase',\r\n    },\r\n    inputGroup: {\r\n        width: '31%', \r\n        alignItems: 'center',\r\n    },\r\n    input: {\r\n        height: 40,\r\n        backgroundColor: colors.background,\r\n        borderColor: colors.divider, \r\n        borderWidth: 1,\r\n        borderRadius: 6,\r\n        paddingHorizontal: 5,\r\n        fontSize: 14,\r\n        color: colors.textPrimary,\r\n        textAlign: 'center',\r\n        width: '100%',\r\n    },\r\n});\r\n\r\n// ----------------------------------------------------------------------\r\n// Exercise Item Component\r\n// ----------------------------------------------------------------------\r\nconst ExerciseItem = ({ index, exercise, updateExercise, removeExercise, toggleSelector, themeColors }) => {\r\n    \r\n    const exerciseStyles = getExerciseStyles(themeColors);\r\n\r\n    const handleChange = (field, value) => {\r\n        updateExercise(index, field, value);\r\n    };\r\n\r\n    const placeholderColor = themeColors.isDark ? themeColors.textSecondary : '#A0A0A0';\r\n    // Determina el color del botn de seleccin (rojo si no hay exercise_id)\r\n    const buttonColor = exercise.exercise_id ? themeColors.primary : themeColors.danger;\r\n    const buttonBgColor = exercise.exercise_id ? themeColors.highlight : (themeColors.isDark ? '#2D2D2D' : '#FEECEC');\r\n\r\n\r\n    return (\r\n        <View style={exerciseStyles.card}>\r\n            <View style={exerciseStyles.header}>\r\n                <Text style={exerciseStyles.title}>Ejercicio #{index + 1}</Text>\r\n                <TouchableOpacity \r\n                    onPress={() => removeExercise(index)} \r\n                    style={exerciseStyles.deleteButton}\r\n                >\r\n                    <Trash2 size={20} color={themeColors.danger} />\r\n                </TouchableOpacity>\r\n            </View>\r\n\r\n            {/* Button/Display of Selected Exercise */}\r\n            <TouchableOpacity \r\n                style={[\r\n                    exerciseStyles.selectButton, \r\n                    // Si no est seleccionado, forzamos un borde y fondo de advertencia.\r\n                    !exercise.exercise_id && {borderColor: themeColors.danger, backgroundColor: buttonBgColor},\r\n                ]} \r\n                onPress={() => toggleSelector(index)} \r\n            >\r\n                {/* Usamos el color determinado */}\r\n                <Zap size={20} color={buttonColor} /> \r\n                <Text \r\n                    style={[\r\n                        exerciseStyles.selectButtonText, \r\n                        // El texto es rojo si no est seleccionado\r\n                        !exercise.exercise_id && {color: themeColors.danger} \r\n                    ]}\r\n                    numberOfLines={1}\r\n                    ellipsizeMode=\"tail\" \r\n                >\r\n                    {exercise.name || \"Toca para Seleccionar Ejercicio\"}\r\n                </Text>\r\n            </TouchableOpacity>\r\n            \r\n            {/* Compact Input Row */}\r\n            <View style={exerciseStyles.row}>\r\n                {/* 1. Series Input */}\r\n                <View style={exerciseStyles.inputGroup}>\r\n                    <Text style={exerciseStyles.compactLabel}>Series</Text>\r\n                    <TextInput\r\n                        style={exerciseStyles.input}\r\n                        placeholder=\"3\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        keyboardType=\"numeric\"\r\n                        value={exercise.series}\r\n                        onChangeText={(text) => handleChange('series', text)}\r\n                    />\r\n                </View>\r\n\r\n                {/* 2. Repetitions Input */}\r\n                <View style={exerciseStyles.inputGroup}>\r\n                    <Text style={exerciseStyles.compactLabel}>Repeticiones</Text>\r\n                    <TextInput\r\n                        style={exerciseStyles.input}\r\n                        placeholder=\"10-12\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        keyboardType=\"default\" \r\n                        value={exercise.repetitions}\r\n                        onChangeText={(text) => handleChange('repetitions', text)}\r\n                    />\r\n                </View>\r\n\r\n                {/* 3. Weight Input */}\r\n                <View style={exerciseStyles.inputGroup}>\r\n                    <Text style={exerciseStyles.compactLabel}>Peso</Text>\r\n                    <TextInput\r\n                        style={exerciseStyles.input}\r\n                        placeholder=\"20 kg\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        keyboardType=\"default\" \r\n                        value={exercise.peso}\r\n                        onChangeText={(text) => handleChange('peso', text)}\r\n                    />\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\n// ----------------------------------------------------------------------\r\n// Dynamic Screen Styles Generator\r\n// ----------------------------------------------------------------------\r\nconst getStyles = (colors) => StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: colors.background,\r\n    },\r\n    loadingContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        backgroundColor: colors.background,\r\n    },\r\n    content: {\r\n        padding: 20,\r\n        paddingBottom: 100, // Space for FAB\r\n    },\r\n    subHeader: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        paddingHorizontal: 20,\r\n        paddingVertical: 10,\r\n        backgroundColor: colors.card,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n    },\r\n    actionButton: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        paddingVertical: 10,\r\n        paddingHorizontal: 15,\r\n        borderRadius: 8,\r\n        justifyContent: 'center',\r\n        width: '48%', \r\n    },\r\n    actionButtonText: {\r\n        color: colors.card,\r\n        fontWeight: 'bold',\r\n        marginLeft: 8,\r\n        fontSize: 14,\r\n    },\r\n    // Estilo para el botn de Agregar dentro del modal\r\n    selectorActionButton: { \r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        backgroundColor: colors.success, // Usamos success para el botn de adicin\r\n        borderRadius: 8,\r\n        paddingVertical: 10,\r\n        marginHorizontal: 20,\r\n        marginTop: 10,\r\n        marginBottom: 15,\r\n    },\r\n    cancelButton: {\r\n        backgroundColor: colors.danger,\r\n    },\r\n    label: {\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n        color: colors.textPrimary,\r\n        marginBottom: 5,\r\n        marginTop: 15,\r\n    },\r\n    input: {\r\n        height: 50,\r\n        backgroundColor: colors.highlight, \r\n        borderColor: colors.divider,\r\n        borderWidth: 1,\r\n        borderRadius: 8,\r\n        paddingHorizontal: 15,\r\n        fontSize: 16,\r\n        marginBottom: 15,\r\n        color: colors.textPrimary,\r\n    },\r\n    textArea: {\r\n        height: 80,\r\n        textAlignVertical: 'top',\r\n        paddingTop: 10,\r\n    },\r\n    sectionTitle: {\r\n        fontSize: 20,\r\n        fontWeight: 'bold',\r\n        color: colors.textPrimary,\r\n        marginTop: 25,\r\n        marginBottom: 15,\r\n    },\r\n    floatingButton: {\r\n        position: 'absolute',\r\n        bottom: 20,\r\n        right: 20,\r\n        backgroundColor: colors.success,\r\n        padding: 15,\r\n        borderRadius: 50,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        elevation: 6,\r\n        shadowColor: colors.success,\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.3,\r\n        shadowRadius: 4,\r\n    },\r\n    floatingButtonText: {\r\n        color: colors.card,\r\n        fontWeight: 'bold',\r\n        marginLeft: 8,\r\n        fontSize: 16,\r\n    },\r\n    selectorContainer: {\r\n        flex: 1,\r\n        backgroundColor: colors.background,\r\n        paddingTop: Platform.OS === 'android' ? 40 : 0, \r\n    },\r\n    selectorHeader: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        padding: 15,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n        backgroundColor: colors.card,\r\n    },\r\n    selectorTitle: {\r\n        fontSize: 20,\r\n        fontWeight: 'bold',\r\n        color: colors.textPrimary,\r\n        flex: 1, \r\n        textAlign: 'center',\r\n    },\r\n    selectorSearchInput: {\r\n        height: 45,\r\n        backgroundColor: colors.highlight,\r\n        borderColor: colors.divider,\r\n        borderWidth: 1,\r\n        borderRadius: 25,\r\n        paddingHorizontal: 20,\r\n        marginHorizontal: 20,\r\n        marginTop: 10,\r\n        marginBottom: 15,\r\n        fontSize: 16,\r\n        color: colors.textPrimary,\r\n    },\r\n    selectorList: {\r\n        paddingHorizontal: 0, \r\n        paddingVertical: 10,\r\n    },\r\n    selectorItem: {\r\n        paddingVertical: 15,\r\n        paddingHorizontal: 20, \r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n    },\r\n    selectorItemName: {\r\n        fontSize: 17,\r\n        fontWeight: '600',\r\n        color: colors.textPrimary,\r\n        flexShrink: 1, \r\n    },\r\n    selectorItemGroup: {\r\n        fontSize: 14,\r\n        color: colors.textSecondary,\r\n        marginLeft: 10,\r\n    },\r\n    closeSelectorButton: {\r\n        padding: 5,\r\n    },\r\n    screenHeader: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        paddingHorizontal: 20,\r\n        paddingVertical: 10,\r\n        backgroundColor: colors.card,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n    },\r\n    screenTitle: {\r\n        fontSize: 18, \r\n        fontWeight: 'bold',\r\n        color: colors.textPrimary, \r\n        textAlign: 'center',\r\n    },\r\n});\r\n\r\n// ----------------------------------------------------------------------\r\n// Main Routine EDIT Screen\r\n// ----------------------------------------------------------------------\r\nexport default function RoutineEditScreen({ navigation }) {\r\n    \r\n    const { colors: themeColors } = useTheme();\r\n    const styles = getStyles(themeColors);\r\n\r\n    // Route parameters: ONLY routineId is required here\r\n    const route = useRoute();\r\n    const { routineId } = route.params || {};\r\n    \r\n    // In this dedicated screen, isEditMode is ALWAYS TRUE\r\n    const isEditMode = true; \r\n    \r\n    const [routine, setRoutine] = useState({ name: '', description: '', exercises: [] });\r\n    \r\n    // UI and data states\r\n    const [availableExercises, setAvailableExercises] = useState([]); \r\n    const [isExerciseSelectorOpen, setIsExerciseSelectorOpen] = useState(false); \r\n    const [currentExerciseIndex, setCurrentExerciseIndex] = useState(null);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n\r\n    // Loading/Error states\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [fetchError, setFetchError] = useState(null);\r\n    \r\n    const { getToken } = useContext(AuthContext);\r\n\r\n    // ------------------------------------------------------------------\r\n    // Helper Functions\r\n    // ------------------------------------------------------------------\r\n    \r\n    const updateRoutineData = (field, value) => {\r\n        setRoutine(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const updateExercise = (index, field, value) => {\r\n        setRoutine(prev => {\r\n            const currentExercises = [...prev.exercises];\r\n            \r\n            if (currentExercises[index]) {\r\n                currentExercises[index] = { ...currentExercises[index], [field]: value };\r\n            }\r\n            \r\n            return { ...prev, exercises: currentExercises };\r\n        });\r\n    };\r\n    \r\n    const fetchData = async () => {\r\n        if (!routineId) {\r\n            setFetchError(\"Error: ID de rutina no proporcionado para edicin.\");\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setFetchError(null);\r\n        try {\r\n            const token = await getToken();\r\n            const headers = { 'Authorization': `Bearer ${token}` };\r\n            \r\n            // 1. Load ALL available Exercises\r\n            const exercisesResponse = await axios.get(`${API_URL}/exercises/`, { headers });\r\n            setAvailableExercises(exercisesResponse.data);\r\n            \r\n            // 2. Load Routine Data \r\n            const routineResponse = await axios.get(`${API_URL}/routines/${routineId}`, { headers });\r\n            const routineData = routineResponse.data;\r\n\r\n            const loadedExercises = routineData.exercise_links\r\n                .sort((a, b) => a.order - b.order) \r\n                .map(link => ({\r\n                    exercise_id: link.exercise_id, \r\n                    name: link.exercise?.nombre || 'Ejercicio Desconocido',\r\n                    // CORRECCIN CLAVE: Aseguramos que los valores sean string o cadena vaca, NO \"null\" literal.\r\n                    series: String(link.sets || ''), \r\n                    repetitions: String(link.repetitions || ''), \r\n                    peso: link.peso || '', \r\n                }));\r\n            \r\n            // Set single routine data\r\n            setRoutine({\r\n                name: routineData.nombre,\r\n                description: routineData.descripcion || '', // Handle null/undefined description\r\n                exercises: loadedExercises,\r\n            });\r\n            \r\n        } catch (e) {\r\n            console.error(\"Error loading data:\", e.response ? e.response.data : e.message);\r\n            setFetchError(`Error de conexin al cargar datos. Rutina con ID ${routineId} no encontrada.`); \r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n        // Remove native back button\r\n        navigation.setOptions({ headerLeft: () => null });\r\n    }, [routineId]); \r\n\r\n    // Exercise management\r\n    const addExercise = () => {\r\n        const newExercises = [...routine.exercises, { \r\n            exercise_id: null, \r\n            name: '', \r\n            series: '', \r\n            repetitions: '', \r\n            peso: '', \r\n        }];\r\n        updateRoutineData('exercises', newExercises);\r\n    };\r\n\r\n    const removeExercise = (index) => {\r\n        Alert.alert(\r\n            \"Confirmar Eliminacin\",\r\n            `Ests seguro de que quieres eliminar el ejercicio #${index + 1}?`,\r\n            [\r\n                { text: \"Cancelar\", style: \"cancel\" },\r\n                { \r\n                    text: \"Eliminar\", \r\n                    style: \"destructive\", \r\n                    onPress: () => {\r\n                        const newExercises = routine.exercises.filter((_, i) => i !== index);\r\n                        updateRoutineData('exercises', newExercises);\r\n                    }\r\n                }\r\n            ]\r\n        );\r\n    };\r\n    \r\n    // Exercise Selector Modal Logic\r\n    const toggleExerciseSelector = (index) => {\r\n        setCurrentExerciseIndex(index);\r\n        setIsExerciseSelectorOpen(true);\r\n    };\r\n    \r\n    const handleSelectExercise = (exerciseId, exerciseName) => {\r\n        if (currentExerciseIndex !== null) {\r\n            const isDuplicate = routine.exercises.some((ex, i) => i !== currentExerciseIndex && ex.exercise_id === exerciseId);\r\n            if (isDuplicate) {\r\n                Alert.alert(\"Advertencia\", \"Este ejercicio ya est en la rutina. Puedes editar sus series/repeticiones.\"); \r\n            }\r\n            \r\n            updateExercise(currentExerciseIndex, 'exercise_id', exerciseId);\r\n            updateExercise(currentExerciseIndex, 'name', exerciseName);\r\n        }\r\n        setIsExerciseSelectorOpen(false);\r\n        setSearchQuery(''); \r\n        setCurrentExerciseIndex(null);\r\n    };\r\n\r\n    //  NUEVO HANDLER: Navegar a la pantalla de adicin de ejercicios\r\n    const handleNavigateToAddExercise = () => {\r\n        setIsExerciseSelectorOpen(false); \r\n        navigation.navigate('ExercisesAdd'); \r\n    };\r\n    \r\n    // ------------------------------------------------------------------\r\n    // Validation and Save Logic \r\n    // ------------------------------------------------------------------\r\n    const validateCurrentRoutine = () => {\r\n        if (!routine.name.trim()) {\r\n            Alert.alert(\"Error\", `El nombre de la rutina no puede estar vaco.`); \r\n            return false;\r\n        }\r\n        \r\n        if (routine.exercises.length === 0) {\r\n            Alert.alert(\"Error\", `La rutina \"${routine.name}\" debe tener al menos un ejercicio.`);\r\n            return false;\r\n        }\r\n        \r\n        const invalidExercise = routine.exercises.find(ex => {\r\n            // 1. Exercise must be selected\r\n            if (!ex.exercise_id) return true;\r\n            \r\n            // 2. Series validation: must be a positive integer\r\n            const seriesTrimmed = ex.series ? ex.series.trim() : '';\r\n            const seriesNumber = parseInt(seriesTrimmed);\r\n            \r\n            if (isNaN(seriesNumber) || seriesNumber <= 0) return true;\r\n\r\n            // 3. Repetitions validation: must be non-empty string\r\n            const repetitionsTrimmed = ex.repetitions ? ex.repetitions.trim() : '';\r\n            if (repetitionsTrimmed.length === 0) return true; \r\n\r\n            // All checks passed\r\n            return false;\r\n        });\r\n\r\n        if (invalidExercise) {\r\n            Alert.alert(\"Error de Validacin\", `En \"${routine.name}\": Todos los ejercicios deben estar seleccionados y tener Series (entero positivo) y Repeticiones no vacas.`); \r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    \r\n    const handleSaveSingleRoutine = async () => {\r\n        if (!validateCurrentRoutine()) return;\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            const token = await getToken();\r\n            const headers = { 'Authorization': `Bearer ${token}` };\r\n            \r\n            const routineData = {\r\n                nombre: routine.name.trim(),\r\n                descripcion: routine.description.trim() || '', \r\n                exercises: routine.exercises.map((ex, index) => ({ \r\n                    exercise_id: ex.exercise_id, \r\n                    sets: parseInt(ex.series.trim()),\r\n                    repetitions: ex.repetitions.trim(), \r\n                    peso: ex.peso.trim() || 'N/A', \r\n                    order: index + 1 \r\n                }))\r\n            };\r\n\r\n            await axios.patch(`${API_URL}/routines/${routineId}`, routineData, { headers });\r\n            \r\n            Alert.alert(\"xito de Edicin\", `Rutina \"${routine.name.trim()}\" actualizada exitosamente.`); \r\n            navigation.goBack(); \r\n            \r\n        } catch (e) {\r\n            console.error(\"Error saving routine (API):\", e.message, JSON.stringify(e.response ? e.response.data : e.message)); \r\n            \r\n            let errorMessage = \"Fallo desconocido al guardar la rutina.\";\r\n             if (e.response && e.response.data && e.response.data.detail) {\r\n                if (Array.isArray(e.response.data.detail) || typeof e.response.data.detail === 'string') {\r\n                    errorMessage = `Error de FastAPI: ${JSON.stringify(e.response.data.detail)}`;\r\n                }\r\n            } else if (e.message === \"Network Error\") {\r\n                 errorMessage = \"Error de red: No se pudo conectar al servidor API.\";\r\n            }\r\n\r\n            Alert.alert(\"Error de Edicin\", errorMessage); \r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n    \r\n    const filteredExercises = availableExercises.filter(ex => \r\n        ex.nombre.toLowerCase().includes(searchQuery.toLowerCase()) || \r\n        (ex.grupo_muscular && ex.grupo_muscular.toLowerCase().includes(searchQuery.toLowerCase()))\r\n    );\r\n\r\n    // UI Status Views\r\n    if (isLoading) {\r\n        return (\r\n            <View style={styles.loadingContainer}>\r\n                <ActivityIndicator size=\"large\" color={themeColors.primary} />\r\n                <Text style={{marginTop: 10, color: themeColors.textSecondary}}>Cargando datos de edicin...</Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (fetchError) {\r\n        return (\r\n            <View style={styles.loadingContainer}>\r\n                <Text style={{color: themeColors.danger, textAlign: 'center', margin: 20}}>\r\n                    {fetchError}\r\n                </Text>\r\n                <TouchableOpacity \r\n                    onPress={() => navigation.goBack()}\r\n                    style={[styles.actionButton, styles.cancelButton, {backgroundColor: themeColors.primary, width: 150}]}\r\n                >\r\n                    <Text style={styles.actionButtonText}>Volver</Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n        );\r\n    }\r\n    \r\n    const placeholderColor = themeColors.isDark ? themeColors.textSecondary : '#A0A0A0';\r\n\r\n    // ------------------------------------------------------------------\r\n    // Exercise Selector Modal View\r\n    // ------------------------------------------------------------------\r\n    if (isExerciseSelectorOpen) {\r\n        return (\r\n            <SafeAreaView style={styles.selectorContainer}>\r\n                <View style={styles.selectorHeader}>\r\n                    <TouchableOpacity \r\n                        onPress={() => setIsExerciseSelectorOpen(false)}\r\n                        style={styles.closeSelectorButton}\r\n                    >\r\n                        <XCircle size={28} color={themeColors.danger} />\r\n                    </TouchableOpacity>\r\n                    <Text style={styles.selectorTitle}>Seleccionar Ejercicio</Text>\r\n                    <View style={{width: 28}}/> \r\n                </View>\r\n\r\n                <TextInput\r\n                    style={styles.selectorSearchInput}\r\n                    placeholder=\"Buscar (Nombre o Grupo Muscular)\"\r\n                    placeholderTextColor={themeColors.textSecondary}\r\n                    value={searchQuery}\r\n                    onChangeText={setSearchQuery}\r\n                />\r\n               \r\n                {/*  BOTN AGREGAR NUEVO EJERCICIO (Igual que en RoutineCreationScreen) */}\r\n                <TouchableOpacity \r\n                    onPress={handleNavigateToAddExercise} \r\n                    style={[styles.selectorActionButton, { backgroundColor: themeColors.success}]}\r\n                    disabled={isSaving}\r\n                >\r\n                    <PlusCircle size={18} color={themeColors.card} />\r\n                    <Text style={styles.actionButtonText}>Agregar Nuevo Ejercicio al Catlogo</Text>\r\n                </TouchableOpacity>\r\n                {/* ------------------------------------------------------------------------- */}\r\n\r\n\r\n                <ScrollView contentContainerStyle={styles.selectorList}>\r\n                    {filteredExercises.length > 0 ? (\r\n                        filteredExercises.map((ex) => (\r\n                        <TouchableOpacity\r\n                            key={ex.id.toString()}\r\n                            style={styles.selectorItem}\r\n                            onPress={() => handleSelectExercise(ex.id, ex.nombre)}\r\n                        >\r\n                            <Text style={styles.selectorItemName}>{ex.nombre}</Text>\r\n                            <Text style={styles.selectorItemGroup}>Grupo: {ex.grupo_muscular}</Text>\r\n                        </TouchableOpacity>\r\n                        ))\r\n                    ) : (\r\n                        <Text style={{textAlign: 'center', color: themeColors.textSecondary, marginTop: 20}}>\r\n                            No se encontraron ejercicios con ese filtro.\r\n                        </Text>\r\n                    )}\r\n                </ScrollView>\r\n            </SafeAreaView>\r\n        );\r\n    }\r\n\r\n    // ------------------------------------------------------------------\r\n    // Main Screen View\r\n    // ------------------------------------------------------------------\r\n    return (\r\n        <SafeAreaView style={styles.container}>\r\n            {/* Encabezado Personalizado (Reemplaza la barra de navegacin nativa) */}\r\n            <View style={styles.screenHeader}>\r\n                <Text style={styles.screenTitle}>\r\n                    Editar Rutina: {routine.name}\r\n                </Text>\r\n            </View>\r\n            \r\n            {/* Top Action Bar (Guardar/Cancelar) */}\r\n            <View style={styles.subHeader}>\r\n                {/* BOTN CANCELAR (nica forma de salir) */}\r\n                <TouchableOpacity \r\n                    onPress={() => navigation.goBack()}\r\n                    style={[styles.actionButton, styles.cancelButton]}\r\n                    disabled={isSaving}\r\n                >\r\n                    <XCircle size={18} color={themeColors.card} />\r\n                    <Text style={styles.actionButtonText}>Cancelar</Text>\r\n                </TouchableOpacity>\r\n\r\n                {/* BOTN GUARDAR CAMBIOS */}\r\n                <TouchableOpacity \r\n                    onPress={handleSaveSingleRoutine}\r\n                    style={[styles.actionButton, {backgroundColor: themeColors.warning}]}\r\n                    disabled={isSaving || !routine.name.trim() || routine.exercises.length === 0}\r\n                >\r\n                    {isSaving ? (\r\n                        <ActivityIndicator size=\"small\" color={themeColors.card} />\r\n                    ) : (\r\n                        <Save size={18} color={themeColors.card} />\r\n                    )}\r\n                    <Text style={styles.actionButtonText}>\r\n                        {isSaving ? \"Guardando...\" : \"Guardar Cambios\"}\r\n                    </Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n\r\n            <KeyboardAvoidingView \r\n                style={{flex: 1}} \r\n                behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                keyboardVerticalOffset={Platform.OS === \"ios\" ? 0 : 20}\r\n            >\r\n                <ScrollView contentContainerStyle={styles.content}>\r\n                    \r\n                    {/* Routine Name Input */}\r\n                    <Text style={styles.label}>Nombre de la Rutina:</Text>\r\n                    <TextInput\r\n                        style={styles.input} \r\n                        placeholder=\"Ej: Rutina Hipertrofia Da A\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        value={routine.name}\r\n                        onChangeText={(text) => updateRoutineData('name', text)}\r\n                        editable={!isSaving}\r\n                    />\r\n                    \r\n                    {/* Description Input */}\r\n                    <Text style={styles.label}>Descripcin (Opcional):</Text>\r\n                    <TextInput\r\n                        style={[styles.input, styles.textArea]}\r\n                        placeholder=\"Ej: Fase de volumen 4 semanas\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        value={routine.description}\r\n                        onChangeText={(text) => updateRoutineData('description', text)}\r\n                        multiline\r\n                        editable={!isSaving}\r\n                    />\r\n                    \r\n                    {/* Exercise List Section */}\r\n                    <Text style={styles.sectionTitle}>\r\n                        Ejercicios ({routine.exercises.length}):\r\n                    </Text>\r\n\r\n                    <View>\r\n                        {routine.exercises.map((exercise, index) => (\r\n                            <ExerciseItem \r\n                                key={index.toString()}\r\n                                index={index}\r\n                                exercise={exercise}\r\n                                updateExercise={updateExercise}\r\n                                removeExercise={removeExercise}\r\n                                toggleSelector={toggleExerciseSelector}\r\n                                themeColors={themeColors}\r\n                            />\r\n                        ))}\r\n                    </View>\r\n                \r\n                </ScrollView>\r\n            </KeyboardAvoidingView>\r\n\r\n            {/* FAB: Floating Action Button to Add Exercise */}\r\n            <TouchableOpacity \r\n                onPress={addExercise} \r\n                style={styles.floatingButton} \r\n                disabled={isSaving || fetchError || availableExercises.length === 0}\r\n            >\r\n                <PlusCircle size={24} color={themeColors.card} />\r\n                <Text style={styles.floatingButtonText}>Aadir Ejercicio</Text>\r\n            </TouchableOpacity>\r\n        </SafeAreaView>\r\n    );\r\n}","import React, { useState, useEffect, useContext, useMemo } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, ScrollView, SafeAreaView, Button, \r\n    ActivityIndicator, FlatList, TouchableOpacity, Alert, Modal,\r\n    TextInput, Platform //  ADDED Platform for Android header fix\r\n} from 'react-native';\r\nimport axios from 'axios';\r\nimport { AuthContext } from '../App'; \r\nimport { useTheme } from '../ThemeContext'; \r\n// Iconos actualizados para Menu\r\nimport { Trash2, Edit, RefreshCcw, Settings, Key, LogOut, Menu, ChevronDown, ChevronUp } from 'lucide-react-native'; \r\n\r\n// URL de la API (Asegrate que esta URL coincida con la de tu App.js/Backend)\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n\r\n// ----------------------------------------------------------------------\r\n// COMPONENTE: MEN LATERAL (DRAWER) DE AJUSTES Y CUENTA\r\n// ----------------------------------------------------------------------\r\nconst AccountSettingsModal = ({ isVisible, onClose, navigation, signOut, themeColors, styles }) => {\r\n    // Los estilos ya vienen pre-generados y adaptados para el drawer\r\n\r\n    const handleChangePassword = () => {\r\n        onClose();\r\n        navigation.navigate('ChangePassword');\r\n    };\r\n\r\n    const handleLogout = () => {\r\n        Alert.alert(\r\n            \"Cerrar Sesin\",\r\n            \"Ests seguro que quieres cerrar sesin?\",\r\n            [\r\n                { text: \"Cancelar\", style: \"cancel\" },\r\n                { text: \"Cerrar\", onPress: signOut, style: \"destructive\" },\r\n            ]\r\n        );\r\n    };\r\n\r\n    return (\r\n        <Modal\r\n            animationType=\"fade\" // Usamos fade o none para evitar animaciones extraas en la superposicin\r\n            transparent={true}\r\n            visible={isVisible}\r\n            onRequestClose={onClose}\r\n        >\r\n            <TouchableOpacity \r\n                style={styles.modalOverlay} \r\n                activeOpacity={1} \r\n                onPressOut={onClose} // Cierra al tocar el fondo\r\n            >\r\n                {/*  Contenedor del Drawer (posicionado a la izquierda) */}\r\n                <View style={styles.menuContainer}>\r\n                    {/*  SafeAreaView para respetar la barra de estado del celular */}\r\n                    <SafeAreaView style={{ flex: 1, backgroundColor: '#1C1C1E' }}> {/*  PEAKFIT: Fondo oscuro */}\r\n                        <ScrollView contentContainerStyle={styles.menuScroll}>\r\n                            \r\n                            <Text style={[styles.menuTitle, {color: '#3ABFBC', borderBottomColor: themeColors.divider}]}> {/*  PEAKFIT: Ttulo Verde */}\r\n                                Men de Alumno\r\n                            </Text>\r\n                            \r\n                            {/* Opcion 1: Cambiar Contrasea */}\r\n                            <TouchableOpacity \r\n                                style={[styles.menuItem, {borderBottomColor: themeColors.divider}]} \r\n                                onPress={handleChangePassword}\r\n                            >\r\n                                <Key size={18} color={'white'} /> {/*  PEAKFIT: Icono Blanco */}\r\n                                <Text style={[styles.menuItemText, {color: 'white'}]}>Cambiar Contrasea</Text> {/*  PEAKFIT: Texto Blanco */}\r\n                            </TouchableOpacity>\r\n                            \r\n                            {/* Opcion 2: Cerrar Sesion */}\r\n                            <TouchableOpacity \r\n                                style={[styles.menuItem, {borderBottomColor: themeColors.divider}]} \r\n                                onPress={handleLogout}\r\n                            >\r\n                                <LogOut size={18} color={themeColors.danger} />\r\n                                <Text style={[styles.menuItemTextLogout, {color: themeColors.danger}]}>Cerrar Sesin</Text>\r\n                            </TouchableOpacity>\r\n                            \r\n                        </ScrollView>\r\n                    </SafeAreaView>\r\n                    \r\n                    {/* Botn de Cerrar (Fijo en la parte inferior del Drawer) */}\r\n                    <TouchableOpacity \r\n                        style={[styles.menuItemClose, {backgroundColor: themeColors.divider}]} \r\n                        onPress={onClose}\r\n                    >\r\n                        <Text style={styles.menuItemTextClose}>Cerrar Men</Text>\r\n                    </TouchableOpacity>\r\n\r\n                </View>\r\n            </TouchableOpacity>\r\n        </Modal>\r\n    );\r\n};\r\n\r\n\r\n// ----------------------------------------------------------------------\r\n// COMPONENTE: Tarjeta Colapsable de Rutina (Alumno)\r\n// ----------------------------------------------------------------------\r\nconst CollapsibleRoutineCard = ({ assignment, styles, themeColors }) => {\r\n    \r\n    // Inicializa isExpanded con false para que las tarjetas estn cerradas por defecto\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const routine = assignment.routine;\r\n    const linkCount = routine?.exercise_links ? routine.exercise_links.length : 0;\r\n    \r\n    // Logica de Estado (Barra Lateral)\r\n    const statusColor = assignment.is_active ? '#3ABFBC' : themeColors.warning; //  PEAKFIT Success Green\r\n    const statusText = assignment.is_active ? 'ACTIVA' : 'INACTIVA';\r\n\r\n    // Formateo de fecha\r\n    const formattedExpiryDate = routine?.routine_group?.fecha_vencimiento \r\n        ? `Vence: ${new Date(routine.routine_group.fecha_vencimiento).toLocaleDateString('es-AR')}` \r\n        : 'Vencimiento: N/A';\r\n\r\n    //  Lgica para obtener el nombre limpio de la rutina\r\n    const groupName = routine?.routine_group?.nombre;\r\n    let displayRoutineName = routine?.nombre ?? 'Rutina Sin Titulo';\r\n    \r\n    if (groupName && displayRoutineName.startsWith(groupName)) {\r\n        displayRoutineName = displayRoutineName.substring(groupName.length).trim();\r\n        if (displayRoutineName.startsWith('-')) {\r\n            displayRoutineName = displayRoutineName.substring(1).trim();\r\n        }\r\n        if (displayRoutineName === '') {\r\n             displayRoutineName = routine?.descripcion?.match(/Da (\\d+)/)?.[0] || 'Da de Entrenamiento';\r\n        }\r\n    }\r\n    //  FIN LGICA DE TTULO\r\n\r\n    const renderExercises = () => (\r\n        <View style={styles.exerciseListContainer}>\r\n            <Text style={{ fontSize: 13, fontWeight: 'bold', color: 'white', marginBottom: 10 }}>Detalle de Ejercicios:</Text>\r\n            {routine.exercise_links\r\n                .sort((a, b) => a.order - b.order)\r\n                .map((link, exIndex) => (\r\n                    // El estilo exerciseItem ya tiene el fondo oscuro corregido\r\n                    <View key={link.id || exIndex} style={styles.exerciseItem}>\r\n                        <Text style={styles.exerciseName}>\r\n                            {link.order}. {link.exercise?.nombre ?? 'Ejercicio Desconocido'}\r\n                        </Text>\r\n                        \r\n                        <View style={styles.detailsRow}>\r\n                            {/* Sets */}\r\n                            <View style={styles.detailItem}>\r\n                                <Text style={styles.detailLabel}>Sets:</Text>\r\n                                <Text style={[styles.detailValue, {color: '#3ABFBC'}]}>{link.sets}</Text>\r\n                            </View>\r\n\r\n                            {/* Reps */}\r\n                            <View style={styles.detailItem}>\r\n                                <Text style={styles.detailLabel}>Reps:</Text>\r\n                                <Text style={[styles.detailValue, {color: '#3ABFBC'}]}>{link.repetitions}</Text>\r\n                            </View>\r\n\r\n                            {/* Peso */}\r\n                            <View style={styles.detailItem}>\r\n                                <Text style={styles.detailLabel}>Peso:</Text>\r\n                                <Text style={[styles.detailValue, {color: '#3ABFBC'}]}>{link.peso || '-'}</Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n                ))}\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={styles.routineCardContainer}>\r\n            \r\n            {/* 1. BARRA LATERAL DE ESTADO */}\r\n            <View style={[styles.statusBar, { backgroundColor: statusColor }]}>\r\n                {/*  StatusText Color: Negro si el fondo es claro (warning), blanco si es oscuro (success/danger) */}\r\n                <Text style={[styles.statusText, {color: statusColor === themeColors.warning ? 'black' : 'white'}]}>{statusText}</Text>\r\n            </View>\r\n\r\n            {/*  2. CONTENIDO PRINCIPAL Y COLAPSABLE: Ahora es el rea de toque */}\r\n            <TouchableOpacity \r\n                style={styles.assignmentContent}\r\n                onPress={() => setIsExpanded(!isExpanded)} // <--- Toggle moved here\r\n                activeOpacity={0.8}\r\n            >\r\n                \r\n                {/* CABECERA (Contiene todos los detalles y el icono de flecha) */}\r\n                <View style={styles.cardHeader}>\r\n                    <View style={{flex: 1}}>\r\n                        \r\n                        {/* Nombre de la Rutina Limpio (ES EL NICO TTULO DENTRO DE LA TARJETA) */}\r\n                        <Text style={styles.routineTitle}>\r\n                            {displayRoutineName}\r\n                        </Text>\r\n                        \r\n                        {/* Vencimiento */}\r\n                        <Text style={styles.routineGroup}>{formattedExpiryDate}</Text>\r\n                        \r\n                        {/* Indicador de Profesor */}\r\n                        <Text style={styles.assignedBy}>\r\n                            Profesor: {assignment.professor?.nombre ?? 'Desconocido'}\r\n                        </Text>\r\n                        \r\n                        {/* Indicador de cantidad de ejercicios (TEXTO SIN FLECHAS) */}\r\n                        <Text style={{ marginTop: 5, color: '#A9A9A9', fontSize: 13, fontWeight: '500'}}>\r\n                            {linkCount} EJERCICIOS\r\n                        </Text>\r\n                    </View>\r\n                    \r\n                    {/*  ICONO DE EXPANSION */}\r\n                    {isExpanded ? \r\n                        <ChevronUp size={24} color={'#3ABFBC'} /> : \r\n                        <ChevronDown size={24} color={'#3ABFBC'} />\r\n                    }\r\n                </View>\r\n\r\n                {/* Contenido Colapsable */}\r\n                {isExpanded && renderExercises()}\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// PANTALLA DE RUTINA (ALUMNO) PRINCIPAL\r\n// ----------------------------------------------------------------------\r\nexport default function StudentRoutineScreen({ navigation }) {\r\n    \r\n    const { colors: themeColors } = useTheme();\r\n    const styles = getStudentStyles(themeColors);\r\n    \r\n    const { signOut, getToken, userProfile } = useContext(AuthContext);\r\n\r\n    const [activeAssignments, setActiveAssignments] = useState([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [isMenuVisible, setIsMenuVisible] = useState(false); // Estado del Modal\r\n\r\n    const fetchRoutine = async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n            const token = await getToken();\r\n            if (!token) {\r\n                signOut();\r\n                return;\r\n            }\r\n\r\n            const response = await axios.get(`${API_URL}/students/me/routine`, {\r\n                headers: { 'Authorization': `Bearer ${token}` }\r\n            });\r\n\r\n            const assignments = response.data; \r\n\r\n            if (assignments && assignments.length > 0) {\r\n                const validAssignments = assignments.filter(a => a.routine !== null);\r\n                \r\n                // Ordenamos por el ID de la rutina para asegurar el orden (Dia 1, Dia 2, etc.)\r\n                validAssignments.sort((a, b) => a.routine.id - b.routine.id);\r\n\r\n                setActiveAssignments(validAssignments);\r\n                if (validAssignments.length === 0) {\r\n                     setError(\"No tienes ninguna rutina activa asignada.\");\r\n                }\r\n            } else {\r\n                setActiveAssignments([]);\r\n                setError(\"No tienes ninguna rutina activa asignada.\"); \r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(\"Error al cargar la rutina del alumno:\", e.response ? e.response.data : e.message);\r\n            \r\n            if (e.response && (e.response.status === 404 || e.response.data?.detail === \"No tienes ninguna rutina activa asignada.\")) {\r\n                setError(\"No tienes ninguna rutina activa asignada.\");\r\n            } else {\r\n                Alert.alert(\"Error de Conexin\", \"Fallo al cargar la rutina. Verifica tu conexin o backend.\");\r\n                setError(\"Error al cargar la rutina. Revisa tu conexin.\");\r\n            }\r\n        } finally {\r\n            setTimeout(() => setIsLoading(false), 300); \r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Recarga la rutina al enfocarse la pantalla\r\n        const unsubscribeFocus = navigation.addListener('focus', () => {\r\n             fetchRoutine();\r\n        });\r\n        fetchRoutine();\r\n        return unsubscribeFocus;\r\n    }, []);\r\n\r\n    const handleRefresh = () => {\r\n        fetchRoutine();\r\n    };\r\n    \r\n    //  PASO 1: Agrupar asignaciones por grupo (routine_group.id)\r\n    const groupedAssignments = useMemo(() => {\r\n        const groups = {};\r\n        activeAssignments.forEach(assignment => {\r\n            const routine = assignment.routine;\r\n            const groupId = routine?.routine_group?.id || 'NoGroup';\r\n            const groupName = routine?.routine_group?.nombre || 'Rutinas Individuales';\r\n            \r\n            if (!groups[groupId]) {\r\n                groups[groupId] = {\r\n                    groupName: groupName,\r\n                    assignments: []\r\n                };\r\n            }\r\n            groups[groupId].assignments.push(assignment);\r\n        });\r\n        return groups;\r\n    }, [activeAssignments]);\r\n\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <SafeAreaView style={styles.loadingContainer}>\r\n                <ActivityIndicator size=\"large\" color={'#3ABFBC'} />\r\n                <Text style={{ marginTop: 10, color: themeColors.textSecondary }}>Cargando tus rutinas...</Text>\r\n            </SafeAreaView>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <SafeAreaView style={styles.container}>\r\n            \r\n            {/*  MODAL DE OPCIONES DE USUARIO (REIMPLEMENTADO COMO DRAWER) */}\r\n            <AccountSettingsModal \r\n                isVisible={isMenuVisible}\r\n                onClose={() => setIsMenuVisible(false)}\r\n                navigation={navigation}\r\n                signOut={signOut} \r\n                themeColors={themeColors}\r\n                styles={styles} // Pasamos los estilos para consistencia\r\n            />\r\n            \r\n            {/* CABECERA ESTILIZADA con botones */}\r\n            <View style={styles.header}>\r\n                {/*  Boton de Menu/Drawer (Izquierda) */}\r\n                <TouchableOpacity \r\n                    onPress={() => setIsMenuVisible(true)} \r\n                    style={styles.iconButton}\r\n                >\r\n                    <Menu size={24} color={'white'} /> \r\n                </TouchableOpacity>\r\n\r\n                {/* TITULO DINAMICO */}\r\n                <Text style={styles.headerTitle}>\r\n                    Bienvenido/a {userProfile?.nombre?.split(' ')[0] || 'Alumno/a'}\r\n                </Text>\r\n\r\n                <View style={styles.headerButtons}>\r\n                    {/* Boton Refrescar (Se mantiene a la derecha) */}\r\n                    <TouchableOpacity \r\n                        onPress={handleRefresh} \r\n                        style={styles.iconButton}\r\n                        disabled={isLoading}\r\n                    >\r\n                        <RefreshCcw size={24} color={'#3ABFBC'} /> \r\n                    </TouchableOpacity>\r\n                    {/* Boton de Ajustes ELIMINADO */}\r\n                </View>\r\n            </View>\r\n            \r\n            <ScrollView contentContainerStyle={styles.content}>\r\n                \r\n                <View style={styles.mainContentHeader}>\r\n                    <Text style={styles.mainTitle}>Mi Plan de Entrenamiento</Text>\r\n                    <Text style={{color: '#A9A9A9'}}>Rutinas Activas ({activeAssignments.length})</Text>\r\n                    {error && error !== \"No tienes ninguna rutina activa asignada.\" && <Text style={styles.errorText}>{error}</Text>}\r\n                </View>\r\n\r\n                {activeAssignments.length > 0 ? (\r\n                    //  PASO 2: Iterar sobre los grupos\r\n                    Object.entries(groupedAssignments).map(([groupId, groupData]) => (\r\n                        <View key={groupId}>\r\n                            {/* TTULO DEL GRUPO (UNA SOLA VEZ, GRANDE) */}\r\n                            <Text style={styles.groupHeaderTitle}>\r\n                                {groupData.groupName} ({groupData.assignments.length} Rutinas)\r\n                            </Text>\r\n                            \r\n                            {/* Rutinas dentro del grupo */}\r\n                            {groupData.assignments.map((assignment, assignmentIndex) => (\r\n                                <CollapsibleRoutineCard \r\n                                    key={assignment.id?.toString() ?? assignmentIndex.toString()} \r\n                                    assignment={assignment}\r\n                                    styles={styles}\r\n                                    themeColors={themeColors}\r\n                                />\r\n                            ))}\r\n                        </View>\r\n                    ))\r\n                ) : (\r\n                    // Mensaje cuando no hay rutina activa\r\n                    <View style={styles.noRoutineContainer}>\r\n                        <Text style={styles.noRoutineText}>Libre de Rutinas!</Text>\r\n                        <Text style={styles.noRoutineSubText}>Pdele a tu profesor que te asigne un nuevo plan.</Text>\r\n                    </View>\r\n                )}\r\n            </ScrollView>\r\n        </SafeAreaView>\r\n    );\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// GENERADOR DE ESTILOS DINMICOS (PEAKFIT)\r\n// ----------------------------------------------------------------------\r\nconst getStudentStyles = (colors) => StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: 'black', //  PEAKFIT: Fondo Negro\r\n    },\r\n    loadingContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        backgroundColor: 'black', //  PEAKFIT: Fondo Negro\r\n    },\r\n    // --- Cabecera ---\r\n    header: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        padding: 15,\r\n        paddingTop: Platform.OS === 'android' ? 40 : 15,\r\n        backgroundColor: 'black', //  PEAKFIT: Header Negro\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n        elevation: 0, // Quitamos sombra en fondo oscuro\r\n    },\r\n    headerTitle: {\r\n        fontSize: 18, \r\n        fontWeight: 'bold',\r\n        color: 'white', //  PEAKFIT: Ttulo Blanco\r\n        flex: 1, \r\n        textAlign: 'center',\r\n        paddingHorizontal: 10,\r\n    },\r\n    headerButtons: {\r\n        flexDirection: 'row',\r\n        gap: 15,\r\n    },\r\n    iconButton: {\r\n        padding: 8,\r\n        borderRadius: 8,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Botn Dark Gray\r\n    },\r\n    content: {\r\n        flexGrow: 1, \r\n        padding: 20,\r\n    },\r\n    mainContentHeader: {\r\n        marginBottom: 10,\r\n    },\r\n    mainTitle: {\r\n        fontSize: 24,\r\n        fontWeight: 'bold',\r\n        color: 'white', //  PEAKFIT: Ttulo Blanco\r\n        marginBottom: 5,\r\n    },\r\n    groupHeaderTitle: {\r\n        fontSize: 22,\r\n        fontWeight: 'bold',\r\n        color: '#3ABFBC', //  PEAKFIT: Ttulo Verde\r\n        marginTop: 20,\r\n        marginBottom: 10,\r\n        borderBottomWidth: 1, \r\n        borderBottomColor: colors.divider,\r\n        paddingBottom: 5,\r\n    },\r\n    errorText: {\r\n        color: colors.danger,\r\n        fontWeight: '600',\r\n        marginTop: 10,\r\n        textAlign: 'center',\r\n        backgroundColor: colors.danger + '30',\r\n        padding: 10,\r\n        borderRadius: 8,\r\n        marginBottom: 20,\r\n    },\r\n    noRoutineContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        padding: 40,\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Card Dark Gray\r\n        borderRadius: 10,\r\n        marginTop: 50,\r\n        borderWidth: 1,\r\n        borderColor: colors.warning,\r\n    },\r\n    noRoutineText: {\r\n        fontSize: 22,\r\n        fontWeight: 'bold',\r\n        color: colors.warning,\r\n        marginBottom: 10,\r\n        textAlign: 'center',\r\n    },\r\n    noRoutineSubText: {\r\n        fontSize: 16,\r\n        color: '#A9A9A9',\r\n        textAlign: 'center',\r\n    },\r\n    // --- Estilos de la Tarjeta Colapsable ---\r\n    routineCardContainer: {\r\n        flexDirection: 'row',\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Card Dark Gray\r\n        borderRadius: 10,\r\n        marginBottom: 15,\r\n        shadowColor: '#000',\r\n        shadowOffset: { width: 0, height: 2 },\r\n        shadowOpacity: 0.8,\r\n        shadowRadius: 5,\r\n        elevation: 5,\r\n        overflow: 'hidden',\r\n    },\r\n    statusBar: {\r\n        width: 30, \r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        paddingVertical: 10,\r\n    },\r\n    statusText: {\r\n        fontSize: 14,\r\n        fontWeight: 'bold',\r\n        color: 'white', // Color que se ajusta en el componente\r\n        transform: [{ rotate: '-90deg' }], \r\n        width: 100, \r\n        textAlign: 'center',\r\n    },\r\n    assignmentContent: {\r\n        flex: 1,\r\n    },\r\n    cardHeader: {\r\n        padding: 15,\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        flex: 1,\r\n    },\r\n    routineTitle: {\r\n        fontSize: 18, \r\n        fontWeight: 'bold',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n        marginBottom: 5,\r\n    },\r\n    routineGroup: {\r\n        fontSize: 13, \r\n        color: '#A9A9A9', //  PEAKFIT: Texto Secundario Gris\r\n        marginBottom: 2,\r\n    },\r\n    assignedBy: {\r\n        fontSize: 12,\r\n        color: '#A9A9A9',\r\n        fontStyle: 'italic',\r\n        marginTop: 5,\r\n    },\r\n    exerciseListContainer: {\r\n        paddingTop: 15,\r\n        paddingHorizontal: 15,\r\n        paddingBottom: 15,\r\n        borderTopWidth: 1,\r\n        borderTopColor: colors.divider,\r\n        backgroundColor: 'black', //  PEAKFIT: Contenido Interno Negro\r\n    },\r\n    exerciseItem: {\r\n        paddingLeft: 10,\r\n        paddingVertical: 8,\r\n        borderLeftWidth: 2,\r\n        borderLeftColor: '#3ABFBC', //  PEAKFIT: Lnea de acento verde\r\n        marginBottom: 8,\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Fondo de tem (ms claro que el fondo)\r\n        borderRadius: 5, \r\n    },\r\n    exerciseName: {\r\n        fontSize: 16,\r\n        fontWeight: '700',\r\n        color: 'white',\r\n        marginBottom: 5,\r\n    },\r\n    detailsRow: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'flex-start',\r\n        gap: 15,\r\n        marginTop: 5,\r\n    },\r\n    detailItem: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        backgroundColor: 'black', //  PEAKFIT: Fondo del detalle ms oscuro\r\n        borderRadius: 6,\r\n        paddingHorizontal: 8,\r\n        paddingVertical: 4,\r\n    },\r\n    detailLabel: {\r\n        fontSize: 12,\r\n        color: '#A9A9A9', \r\n        marginRight: 4,\r\n        fontWeight: '500',\r\n    },\r\n    detailValue: {\r\n        fontSize: 14,\r\n        fontWeight: 'bold',\r\n        color: '#3ABFBC', //  PEAKFIT: Valor verde\r\n    },\r\n    // --- ESTILOS DEL DRAWER ---\r\n    modalOverlay: {\r\n        flex: 1,\r\n        backgroundColor: 'rgba(0, 0, 0, 0.7)', // Ms oscuro\r\n        justifyContent: 'flex-start', \r\n        alignItems: 'flex-start', \r\n    },\r\n    menuContainer: {\r\n        width: 280, \r\n        height: '100%', \r\n        backgroundColor: '#1C1C1E', //  PEAKFIT: Drawer Dark Gray\r\n        position: 'absolute', \r\n        left: 0,              \r\n        top: 0,               \r\n        shadowColor: '#000',\r\n        shadowOffset: { width: 2, height: 0 }, \r\n        shadowOpacity: 1, // Sombra ms fuerte para contraste\r\n        shadowRadius: 5,\r\n        elevation: 10,\r\n    },\r\n    menuScroll: {\r\n        paddingBottom: 70, \r\n    },\r\n    menuTitle: {\r\n        fontSize: 18, \r\n        fontWeight: 'bold',\r\n        paddingVertical: 10,\r\n        marginBottom: 10,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n        color: '#3ABFBC', //  PEAKFIT: Ttulo Verde\r\n        paddingHorizontal: 15,\r\n    },\r\n    menuItem: {\r\n        paddingVertical: 12,\r\n        paddingHorizontal: 15, \r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.divider,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        gap: 10, \r\n    },\r\n    menuItemClose: {\r\n        position: 'absolute',\r\n        bottom: 0,\r\n        left: 0,\r\n        right: 0,\r\n        padding: 15,\r\n        backgroundColor: colors.divider,\r\n        alignItems: 'center',\r\n    },\r\n    menuItemText: {\r\n        fontSize: 15,\r\n        fontWeight: '600',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n    },\r\n    menuItemTextLogout: {\r\n        fontSize: 15,\r\n        fontWeight: '600',\r\n        color: colors.danger,\r\n    },\r\n    menuItemTextClose: {\r\n        fontSize: 15,\r\n        fontWeight: '600',\r\n        color: 'white', //  PEAKFIT: Texto Blanco\r\n    },\r\n});","import React, { useState } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, TextInput, TouchableOpacity, \r\n    ScrollView, SafeAreaView, Alert, ActivityIndicator \r\n} from 'react-native';\r\nimport axios from 'axios';\r\nimport { useTheme } from '../ThemeContext'; // Importamos useTheme\r\nimport { ArrowLeft, Mail, User } from 'lucide-react-native';\r\n\r\n//  Asegrate de que esta URL sea la misma que en App.js\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n\r\n// ----------------------------------------------------------------------\r\n// GENERADOR DE ESTILOS DINMICOS - ESTILO PEAKFIT\r\n// ----------------------------------------------------------------------\r\nconst getStyles = (colors) => StyleSheet.create({\r\n    safeArea: {\r\n        flex: 1,\r\n        // Fondo principal negro\r\n        backgroundColor: 'black', //  PEAKFIT\r\n    },\r\n    container: {\r\n        padding: 25,\r\n        alignItems: 'center',\r\n        flexGrow: 1,\r\n        justifyContent: 'center',\r\n    },\r\n    title: {\r\n        fontSize: 28,\r\n        fontWeight: 'bold',\r\n        // Ttulo blanco\r\n        color: 'white', //  PEAKFIT\r\n        marginBottom: 10,\r\n        textAlign: 'center',\r\n    },\r\n    subtitle: {\r\n        fontSize: 16,\r\n        color: '#A9A9A9', // Gris claro para el subttulo\r\n        marginBottom: 40,\r\n        textAlign: 'center',\r\n    },\r\n    inputWrapper: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        width: '100%',\r\n        height: 50,\r\n        // Fondo de input oscuro\r\n        backgroundColor: '#1C1C1E', //  PEAKFIT\r\n        borderRadius: 10, // Ms redondeado\r\n        paddingHorizontal: 15,\r\n        marginBottom: 20,\r\n        borderWidth: 1,\r\n        borderColor: 'transparent', \r\n    },\r\n    input: {\r\n        flex: 1,\r\n        fontSize: 16,\r\n        // Color del texto: Blanco\r\n        color: 'white', //  PEAKFIT\r\n        marginLeft: 10, \r\n    },\r\n    button: {\r\n        width: '100%',\r\n        // Botn principal: Verde brillante\r\n        backgroundColor: '#3ABFBC', //  PEAKFIT\r\n        padding: 15,\r\n        borderRadius: 10,\r\n        alignItems: 'center',\r\n        marginTop: 20,\r\n        // Sombra del botn (ajustada para el verde)\r\n        shadowColor: '#3ABFBC', //  PEAKFIT\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.8,\r\n        shadowRadius: 5,\r\n        elevation: 6,\r\n    },\r\n    buttonText: {\r\n        // Texto del botn: Negro para alto contraste\r\n        color: 'black', //  PEAKFIT\r\n        fontSize: 18,\r\n        fontWeight: 'bold',\r\n    },\r\n    backButton: {\r\n        marginTop: 30,\r\n        padding: 10,\r\n    },\r\n    backButtonText: {\r\n        color: '#A9A9A9', // Gris claro para el enlace de volver\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n    }\r\n});\r\n\r\nexport default function ForgotPasswordScreen({ navigation }) {\r\n    \r\n    const { colors: themeColors } = useTheme();\r\n    const styles = getStyles(themeColors);\r\n\r\n    const [identifier, setIdentifier] = useState(''); // Puede ser DNI o Email\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    \r\n    // Color para los iconos y placeholder\r\n    const iconColor = '#A9A9A9'; \r\n    const placeholderColor = '#A9A9A9';\r\n\r\n    const handleResetPassword = async () => {\r\n        if (!identifier.trim()) {\r\n            Alert.alert(\"Error\", \"Por favor, ingresa tu DNI o Email.\");\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        //  NOTA: Este es un placeholder, ya que la lgica real del backend \r\n        // para \"olvid mi contrasea\" (enviar un token/link) no est implementada.\r\n        try {\r\n            // ---------------------------------------------------------\r\n            //  AQU IRA LA LLAMADA A TU ENDPOINT DE PASSWORD RESET\r\n            // ---------------------------------------------------------\r\n            \r\n            // Ejemplo de llamada (asume un endpoint que pide el identificador)\r\n            /*\r\n            await axios.post(`${API_URL}/password/forgot`, {\r\n                identifier: identifier.trim()\r\n            });\r\n            */\r\n            \r\n            // Simulacin de xito (reemplazar con la lgica real)\r\n            await new Promise(resolve => setTimeout(resolve, 1500)); \r\n\r\n            Alert.alert(\r\n                \"Solicitud Enviada!\", \r\n                \"Si el DNI/Email es correcto, recibirs un correo con instrucciones para restablecer tu contrasea.\"\r\n            );\r\n            \r\n            // Opcional: Navegar de vuelta al login despus del xito\r\n            navigation.goBack(); \r\n\r\n        } catch (e) {\r\n            console.error(\"Error al solicitar restablecimiento:\", e.response ? e.response.data : e.message);\r\n            \r\n            // Mensaje genrico para no revelar si el DNI/Email existe\r\n            const errorMessage = \"No se pudo procesar la solicitud. Por favor, verifica el identificador e intntalo de nuevo ms tarde.\";\r\n\r\n            Alert.alert(\"Error\", errorMessage);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <SafeAreaView style={styles.safeArea}>\r\n            <ScrollView contentContainerStyle={styles.container}>\r\n                \r\n                <Text style={styles.title}>Olvidaste tu Contrasea?</Text>\r\n                <Text style={styles.subtitle}>\r\n                    Ingresa tu DNI o Email para que podamos enviarte instrucciones para restablecerla.\r\n                </Text>\r\n\r\n                <View style={styles.inputWrapper}>\r\n                    <User size={20} color={iconColor} />\r\n                    <TextInput\r\n                        style={styles.input}\r\n                        placeholder=\"DNI o Email\"\r\n                        placeholderTextColor={placeholderColor}\r\n                        value={identifier}\r\n                        onChangeText={setIdentifier}\r\n                        keyboardType=\"email-address\"\r\n                        autoCapitalize=\"none\"\r\n                        editable={!isLoading}\r\n                    />\r\n                </View>\r\n                \r\n                {isLoading ? (\r\n                    <ActivityIndicator \r\n                        size=\"large\" \r\n                        color={'#3ABFBC'} \r\n                        style={{marginTop: 20}} \r\n                    />\r\n                ) : (\r\n                    <TouchableOpacity \r\n                        style={styles.button} \r\n                        onPress={handleResetPassword}\r\n                        disabled={!identifier.trim()}\r\n                    >\r\n                        <Text style={styles.buttonText}>Restablecer Contrasea</Text>\r\n                    </TouchableOpacity>\r\n                )}\r\n\r\n                <TouchableOpacity \r\n                    onPress={() => navigation.goBack()}\r\n                    style={styles.backButton}\r\n                >\r\n                    <Text style={styles.backButtonText}>\r\n                        <ArrowLeft size={14} color={iconColor} style={{marginRight: 5}}/> Volver al Inicio de Sesin\r\n                    </Text>\r\n                </TouchableOpacity>\r\n                \r\n            </ScrollView>\r\n        </SafeAreaView>\r\n    );\r\n}","import React, { useState, useEffect, createContext, useContext, useMemo } from 'react';\r\nimport { \r\n    StyleSheet, Text, View, ActivityIndicator, \r\n    SafeAreaView, ScrollView, StatusBar, TouchableOpacity, Modal, \r\n    useColorScheme, // Importacin clave: Para detectar el modo del sistema\r\n    Button\r\n} from 'react-native';\r\nimport { NavigationContainer } from '@react-navigation/native';\r\nimport { createNativeStackNavigator } from '@react-navigation/native-stack';\r\nimport axios from 'axios';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nimport ProfessorScreen from './screens/ProfessorScreen'; \r\nimport CustomLoginScreen from './screens/CustomLoginScreen';\r\nimport RoutineCreationScreen from './screens/RoutineCreationScreen';\r\nimport ChangePasswordScreen from './screens/ChangePasswordScreen'; \r\nimport StudentDetailsScreen from './screens/StudentDetailsScreen';\r\n// Rutas de Profesor\r\nimport AddStudentScreen from './screens/AddStudentScreen'; \r\nimport ExercisesAdd from './screens/ExercisesAdd';\r\nimport RoutineEditScreen from './screens/RoutineEditScreen'; \r\n// Rutas de Alumno\r\nimport StudentRoutineScreen from './screens/StudentRoutineScreen'; \r\n// Importacin clave: Importamos el ThemeProvider y el hook \r\nimport { ThemeProvider, useTheme } from './ThemeContext'; \r\n\r\n//  NUEVA IMPORTACIN: Pantalla de recuperacin de contrasea\r\nimport ForgotPasswordScreen from './screens/ForgotPasswordScreen'; \r\n\r\n\r\n// ----------------------------------------------------------------------\r\n// Funcin para decodificar el token y obtener el rol\r\nconst decodeToken = (token) => {\r\n    try {\r\n        const decoded = jwtDecode(token);\r\n        // Si el token tiene el nombre, podemos devolverlo tambin para el contexto\r\n        return { rol: decoded.rol, nombre: decoded.nombre };\r\n    } catch (e) {\r\n        console.error(\"Error decodificando token:\", e);\r\n        return { rol: null, nombre: null };\r\n    }\r\n}\r\n// ----------------------------------------------------------------------\r\n// URL pblica del backend\r\n// ----------------------------------------------------------------------\r\nconst API_URL = \"https://gym-app-backend-e9bn.onrender.com\"; \r\n// ----------------------------------------------------------------------\r\n\r\n// 1. Creamos un Contexto de Autenticacin\r\nexport const AuthContext = createContext();\r\n\r\n// --- PANTALLA DE LOGIN (Llama al componente personalizado) ---\r\nfunction LoginScreen() {\r\n    // El useTheme no es necesario aqu si solo se usa en CustomLoginScreen\r\n    const { signIn } = useContext(AuthContext); \r\n    \r\n    return (\r\n        <CustomLoginScreen signIn={signIn} API_URL={API_URL} />\r\n    );\r\n}\r\n\r\n// --- NAVEGADOR PRINCIPAL ---\r\nconst Stack = createNativeStackNavigator();\r\n\r\nexport default function App() {\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [userToken, setUserToken] = useState(null);\r\n    const [userRole, setUserRole] = useState(null);\r\n    const [userProfile, setUserProfile] = useState(null); // Nuevo estado para perfil\r\n\r\n    // Hook para determinar el esquema de color y ajustar el color del Header/Loader\r\n    const colorScheme = useColorScheme();\r\n    const isDark = colorScheme === 'dark';\r\n    // Colores del tema base para el cargador inicial\r\n    const primaryColor = isDark ? '#60A5FA' : '#007AFF';\r\n    const cardColor = isDark ? '#1F2937' : '#FFFFFF';\r\n    const backgroundColor = isDark ? '#121212' : '#F0F4F8';\r\n\r\n\r\n    const authContext = useMemo(() => ({\r\n        signIn: async (token) => {\r\n            try {\r\n                await AsyncStorage.setItem('user_token', token);\r\n                const { rol, nombre } = decodeToken(token);\r\n                setUserRole(rol);\r\n                setUserProfile({ nombre: nombre });\r\n                setUserToken(token);\r\n            } catch (e) {\r\n                console.error(\"Error guardando token o decodificando:\", e);\r\n            }\r\n        },\r\n        signOut: async () => {\r\n            try {\r\n                await AsyncStorage.removeItem('user_token');\r\n                setUserToken(null);\r\n                setUserRole(null);\r\n                setUserProfile(null);\r\n            } catch (e) {\r\n                console.error(\"Error borrando token\", e);\r\n            }\r\n        },\r\n        getToken: async () => {\r\n            try {\r\n                return await AsyncStorage.getItem('user_token');\r\n            } catch (e) {\r\n                console.error(\"Error obteniendo token\", e);\r\n                return null;\r\n            }\r\n        },\r\n        userProfile: userProfile, // Exportar el perfil\r\n    }), [userToken, userProfile]);\r\n\r\n    useEffect(() => {\r\n        const checkToken = async () => {\r\n            let token = null;\r\n            try {\r\n                token = await AsyncStorage.getItem('user_token');\r\n            } catch (e) {\r\n                console.error(\"Error leyendo token\", e);\r\n            }\r\n            \r\n            if (token) {\r\n                const { rol, nombre } = decodeToken(token);\r\n                setUserRole(rol);\r\n                setUserProfile({ nombre: nombre });\r\n            }\r\n            setUserToken(token);\r\n            setIsLoading(false);\r\n        };\r\n        checkToken();\r\n    }, []);\r\n\r\n    if (isLoading) {\r\n        return (\r\n            // Usamos colores dinmicos para el cargador inicial\r\n            <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center', backgroundColor: backgroundColor }}>\r\n                <ActivityIndicator size=\"large\" color={primaryColor} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    // Lgica de navegacin basada en roles\r\n    const initialRouteName = userToken == null ? \"Login\" : (userRole === \"Profesor\" ? \"ProfessorPanel\" : \"StudentRoutine\");\r\n\r\n    // El cerebro de la navegacin\r\n    return (\r\n        <AuthContext.Provider value={authContext}>\r\n            {/* ENVOLVEMOS EL NAVEGADOR CON EL CONTEXTO DE TEMA */}\r\n            <ThemeProvider> \r\n                <NavigationContainer>\r\n                    {/* Usamos colores dinmicos para el header global */}\r\n                    <Stack.Navigator screenOptions={{ \r\n                        headerShown: true, \r\n                        headerTintColor: primaryColor, // Color del texto y flecha\r\n                        headerStyle: { backgroundColor: cardColor }, // Fondo del header\r\n                        headerTitleStyle: { color: primaryColor }\r\n                    }} \r\n                    initialRouteName={initialRouteName}>\r\n                        {userToken == null ? (\r\n                            <>\r\n                                <Stack.Screen \r\n                                    name=\"Login\" \r\n                                    component={LoginScreen} \r\n                                    options={{ title: 'Ingresar', headerShown: false }}\r\n                                />\r\n                                {/*  RUTA AGREGADA: Olvidaste Contrasea */}\r\n                                <Stack.Screen \r\n                                    name=\"ForgotPassword\" \r\n                                    component={ForgotPasswordScreen} \r\n                                    options={{ title: 'Olvid mi Contrasea', headerShown: false }}\r\n                                />\r\n                            </>\r\n                        ) : userRole === \"Profesor\" ? (\r\n                            <>\r\n                                <Stack.Screen \r\n                                    name=\"ProfessorPanel\" \r\n                                    component={ProfessorScreen} \r\n                                    options={{ title: 'Panel Profesor', headerShown: false }} \r\n                                />\r\n                                <Stack.Screen \r\n                                    name=\"RoutineCreation\" \r\n                                    component={RoutineCreationScreen} \r\n                                    options={{ title: 'Crear Rutina' }}\r\n                                />\r\n                                <Stack.Screen \r\n                                    name=\"StudentDetails\" \r\n                                    component={StudentDetailsScreen} \r\n                                    options={{ title: 'Detalles del Alumno' }}\r\n                                />\r\n                                <Stack.Screen \r\n                                    name=\"ChangePassword\" \r\n                                    component={ChangePasswordScreen} \r\n                                    options={{ title: 'Cambiar Contrasea' }}\r\n                                />\r\n                                <Stack.Screen \r\n                                    name=\"AddStudent\" \r\n                                    component={AddStudentScreen} \r\n                                    options={{ title: 'Registrar Alumno', headerShown: false }} // Usamos el header interno\r\n                                />\r\n                                <Stack.Screen \r\n                                    name=\"ExercisesAdd\" \r\n                                    component={ExercisesAdd} \r\n                                    options={{ title: 'Aadir Ejercicio', headerShown: false }} // Usamos el header interno del componente\r\n                                />\r\n                                {/* <--- RUTA DE EDICIN DE RUTINA AADIDA! ---> */}\r\n                                <Stack.Screen \r\n                                    name=\"RoutineEditScreen\" \r\n                                    component={RoutineEditScreen} \r\n                                    // Esta pantalla probablemente usa los mismos parmetros de creacin para editar\r\n                                    options={{ title: 'Editar Rutina', headerShown: false }} \r\n                                />\r\n                            </>\r\n                        ) : (\r\n                            // Rutas del Alumno\r\n                            <>\r\n                                <Stack.Screen \r\n                                    name=\"StudentRoutine\" \r\n                                    component={StudentRoutineScreen} \r\n                                    options={{ title: 'Mi Rutina', headerShown: false }} // Usamos el header interno\r\n                                />\r\n                                <Stack.Screen \r\n                                    name=\"ChangePassword\" \r\n                                    component={ChangePasswordScreen} \r\n                                    options={{ title: 'Cambiar Contrasea' }}\r\n                                />\r\n                            </>\r\n                        )}\r\n                    </Stack.Navigator>\r\n                </NavigationContainer>\r\n            </ThemeProvider>\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// Estilos vacos. La lgica de estilo del alumno ahora est en StudentRoutineScreen.js\r\n// ----------------------------------------------------------------------\r\nconst styles = StyleSheet.create({});","import { registerRootComponent } from 'expo';\n\nimport App from './App';\n\n// registerRootComponent calls AppRegistry.registerComponent('main', () => App);\n// It also ensures that whether you load the app in Expo Go or in a native build,\n// the environment is set up appropriately\nregisterRootComponent(App);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"./\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t792: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkweb\"] = self[\"webpackChunkweb\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [177], () => (__webpack_require__(4180)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["LightTheme","isDark","colors","background","card","textPrimary","textSecondary","inputBackground","inputBorder","primary","primaryDark","success","danger","warning","divider","highlight","DarkTheme","ThemeContext","createContext","Object","assign","toggleTheme","useTheme","useContext","ThemeProvider","children","systemScheme","useColorScheme","manualScheme","setManualScheme","useState","activeTheme","prevScheme","contextValue","useMemo","React","Provider","value","API_URL","parseDateToJS","require","dateString","parts","split","length","year","month","day","Date","parseInt","formatDisplayDate","dateInput","date","isNaN","getTime","Intl","DateTimeFormat","format","formatAPIDate","getFullYear","String","getMonth","padStart","getDate","CollapsibleAssignmentCard","assignment","assignmentStyles","themeColors","handleEditAssignment","isExpanded","setIsExpanded","linkCount","routine","exercise_links","statusColor","statusText","routine_group","fecha_vencimiento","is_active","View","style","assignmentCard","statusBar","backgroundColor","Text","color","assignmentContent","assignmentHeader","assignmentDetails","routineName","nombre","marginTop","fontSize","fontWeight","assignmentActions","TouchableOpacity","editButton","marginRight","onPress","routine_id","Edit","size","ChevronUp","ChevronDown","exerciseListContainer","marginBottom","sort","a","b","order","map","link","exIndex","exercise","key","id","exerciseItem","exerciseName","detailsRow","detailItem","detailLabel","detailValue","sets","repetitions","peso","EditGroupWizard","groupData","onComplete","onCancel","fetchCurrentAssignments","styles","getMainScreenStyles","wizardLabelStyle","label","getToken","AuthContext","firstRoutine","assignments","initialExpiryDate","expiryDate","groupName","setGroupName","routinesCount","setRoutinesCount","expirationDateInput","setExpirationDateInput","isLoading","setIsLoading","placeholderColor","SafeAreaView","container","headerSelection","wizardTitle","customButton","buttonDanger","minWidth","buttonText","ScrollView","contentContainerStyle","wizardContainer","stepText","TextInput","wizardInput","placeholder","placeholderTextColor","onChangeText","warningTextCenter","routineCounter","counterButton","prev","Math","max","disabled","Minus","counterCountText","min","Plus","keyboardType","editable","wizardActions","justifyContent","buttonPrimary","opacity","async","trim","Alert","alert","test","apiFormattedDate","expiry","today","setHours","headers","routineGroupId","currentCount","axios","patch","routinesToAdd","i","newDayNumber","post","student_id","descripcion","routinesToDeleteCount","routinesSortedByDay","aMatch","match","bMatch","aDay","deletionPromises","routineToDelete","push","delete","Promise","all","e","console","error","response","data","message","detail","AssignmentView","student","routines","onAssignmentComplete","navigation","StyleSheet","create","scrollContainer","flex","padding","alignItems","title","width","textAlign","subtitle","borderBottomWidth","borderBottomColor","paddingBottom","routineListContainer","backButtonTop","currentAssignmentList","groupHeaderContainer","groupHeader","groupDetails","groupActions","flexDirection","gap","flexWrap","groupActionButtonText","marginLeft","toggleGroupButton","paddingVertical","paddingHorizontal","borderRadius","shadowColor","shadowOffset","height","shadowOpacity","shadowRadius","elevation","overflow","transform","rotate","paddingRight","deleteButton","paddingTop","borderTopWidth","borderTopColor","paddingLeft","borderLeftWidth","borderLeftColor","buttonSecondary","borderColor","borderWidth","buttonTextSecondary","groupSeparator","borderStyle","editingGroup","setEditingGroup","currentAssignments","setCurrentAssignments","isAssignmentsLoading","setIsAssignmentsLoading","get","sortedAssignments","Array","isArray","status","routineId","navigate","useEffect","addListener","groupedAssignments","getGroupedAssignments","groups","groupExpiryDate","groupCreationDate","created_at","professorCreatorName","professor","groupIdKey","creationDate","ActivityIndicator","keys","index","groupAssignments","isGroupActive","some","finalGroupIdForActions","groupStyle","isGroupCurrentlyActive","newStatus","handleToggleGroupActive","XCircle","CheckCircle","handleDeleteRoutineGroup","text","token","Trash2","toString","loadingContainer","searchInput","marginHorizontal","header","headerTitle","titleSelection","headerButtons","iconButton","actionSection","listTitle","studentCard","studentName","studentEmail","studentCardActions","actionButton","actionButtonText","fab","position","right","bottom","fabIcon","errorView","errorTitle","errorDetail","modalOverlay","menuContainer","left","top","menuTitle","menuItem","menuItemClose","menuItemText","menuItemTextLogout","menuItemTextClose","flexGrow","progressContainer","progressStep","progressConnectorBackground","zIndex","progressConnectorActive","progressCircle","progressCircleActive","progressCircleDone","progressText","dateInputContainer","dateText","modalContent","alignSelf","datePickerInputGroup","datePickerInput","ProgressIndicator","currentStep","totalSteps","stepNames","steps","from","_","stepNum","isActive","isDone","circleStyle","isLastStep","DatePickerModal","isVisible","initialDate","onClose","onDateSelect","initialDay","initialMonth","initialYear","display","setDay","setMonth","setYear","monthRef","useRef","yearRef","Modal","animationType","transparent","visible","onRequestClose","activeOpacity","onPressOut","onStartShouldSetResponder","maxLength","replace","current","focus","ref","handleConfirm","d","m","y","CreationWizardSimplified","students","step","setStep","setRoutineName","routineDescription","setRoutineDescription","expirationDateObject","setExpirationDateObject","showDatePicker","setShowDatePicker","searchTerm","setSearchTerm","filteredStudents","lowerCaseSearch","toLowerCase","filter","includes","email","handleSelectStudent","studentId","patchPromises","log","deactivateExistingAssignments","routineMetadata","days","expirationDate","handleDateSelect","selectedDate","formatDateDisplay","isStepTwoValid","renderStep","autoFocus","textAlignVertical","multiline","Calendar","maxHeight","item","nextStep","ProfessorScreen","setStudents","selectedStudent","setSelectedStudent","creatingForStudent","setCreatingForStudent","dataError","setDataError","isMenuVisible","setIsMenuVisible","signOut","userProfile","menuAnim","Animated","Value","animateOut","callback","timing","toValue","duration","useNativeDriver","start","fetchData","studentsResponse","errorMsg","unsubscribe","handleAssignmentComplete","animateIn","Menu","RefreshCcw","handleEditStudent","studentData","Weight","translateX","handleViewProfile","User","handleChangePassword","Key","handleAddStudent","UserPlus","handleLogout","LogOut","Button","LOGO_SOURCE","BACKGROUND_SOURCE","RegisterModal","setNombre","setEmail","dni","setDni","password","setPassword","setError","setSuccess","getStyles","modalContainer","modalTitle","errorText","successText","input","autoCapitalize","secureTextEntry","buttonSuccess","rol","msg","CustomLoginScreen","signIn","isRegisterVisible","setIsRegisterVisible","ImageBackground","source","backgroundImagePeakfit","imageStyle","backgroundImageStylePeakfit","KeyboardAvoidingView","behavior","contentLogin","headerPeakfit","Image","logoImagePeakfit","sloganText","titlePeakfit","inputLabelPeakfit","inputPeakfit","passwordContainerPeakfit","passwordInputPeakfit","passwordIconPeakfit","customButtonPeakfit","buttonPrimaryPeakfit","access_token","errorMessage","buttonTextPeakfit","signUpContainerPeakfit","signUpTextPeakfit","signUpLinkPeakfit","resizeMode","fontStyle","ExerciseItem","updateExercise","removeExercise","toggleSelector","exerciseStyles","selectButton","selectButtonText","flexShrink","row","compactLabel","textTransform","inputGroup","handleChange","field","buttonColor","exercise_id","buttonBgColor","Zap","numberOfLines","ellipsizeMode","name","series","RoutineCreationScreenV3","content","subHeader","selectorActionButton","cancelButton","textArea","sectionTitle","floatingButton","floatingButtonText","selectorContainer","selectorHeader","selectorTitle","selectorSearchInput","selectorList","selectorItem","selectorItemName","selectorItemGroup","closeSelectorButton","screenHeader","screenTitle","addExerciseButtonText","route","useRoute","params","isEditMode","totalDays","baseName","currentDay","setCurrentDay","allRoutinesData","setAllRoutinesData","description","exercises","currentRoutine","availableExercises","setAvailableExercises","isExerciseSelectorOpen","setIsExerciseSelectorOpen","currentExerciseIndex","setCurrentExerciseIndex","searchQuery","setSearchQuery","isSaving","setIsSaving","fetchError","setFetchError","setRoutineData","newRoutines","currentExercises","fetchExercises","useCallback","exercisesResponse","routineData","loadedExercises","setOptions","headerLeft","handleNavigateToAddExercise","newExercises","toggleExerciseSelector","validateCurrentRoutine","find","ex","seriesTrimmed","seriesNumber","handleSaveTransaction","payload","goBack","JSON","stringify","handleMainSaveAction","routineToSave","filteredExercises","grupo_muscular","mainButtonText","mainButtonColor","PlusCircle","handleSelectExercise","exerciseId","Save","keyboardVerticalOffset","addExercise","ChangePasswordScreen","safeArea","button","oldPassword","setOldPassword","newPassword","setNewPassword","confirmPassword","setConfirmPassword","old_password","new_password","StudentDetailsScreen","hasChanges","handleSave","updatePayload","reload","scrollContent","detailCard","inputField","detailValueStatic","buttonContainer","ArrowLeft","AddStudentScreen","backButton","inputContainer","inputWrapper","loadingText","successMessage","icon","isSuccess","setIsSuccess","iconColor","handleGoBack","keyboardShouldPersistTaps","Mail","CreditCard","Lock","setTimeout","MUSCLE_GROUPS","ExercisesAdd","useNavigation","fullContainer","minHeight","pickerContainer","picker","saveButton","saveButtonText","disabledButton","setDescripcion","grupoMuscular","setGrupoMuscular","loading","setLoading","Picker","selectedValue","onValueChange","itemValue","enabled","group","Item","exerciseData","RoutineEditScreen","setRoutine","updateRoutineData","margin","AccountSettingsModal","menuScroll","CollapsibleRoutineCard","formattedExpiryDate","toLocaleDateString","displayRoutineName","startsWith","substring","routineCardContainer","cardHeader","routineTitle","routineGroup","assignedBy","StudentRoutineScreen","getStudentStyles","activeAssignments","setActiveAssignments","fetchRoutine","validAssignments","unsubscribeFocus","forEach","groupId","handleRefresh","mainContentHeader","mainTitle","entries","groupHeaderTitle","assignmentIndex","noRoutineContainer","noRoutineText","noRoutineSubText","ForgotPasswordScreen","backButtonText","identifier","setIdentifier","resolve","decodeToken","decoded","jwtDecode","LoginScreen","Stack","createNativeStackNavigator","registerRootComponent","userToken","setUserToken","userRole","setUserRole","setUserProfile","primaryColor","cardColor","authContext","AsyncStorage","setItem","removeItem","getItem","checkToken","initialRouteName","NavigationContainer","Navigator","screenOptions","headerShown","headerTintColor","headerStyle","headerTitleStyle","Screen","component","options","RoutineCreationScreen","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call","deferred","O","result","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","every","splice","r","n","getter","__esModule","definition","o","defineProperty","enumerable","g","globalThis","this","Function","window","obj","prop","prototype","hasOwnProperty","Symbol","toStringTag","p","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","self","bind","__webpack_exports__"],"ignoreList":[],"sourceRoot":""}